var Bg=Object.defineProperty;var Rg=(oe,Dt,Vt)=>Dt in oe?Bg(oe,Dt,{enumerable:!0,configurable:!0,writable:!0,value:Vt}):oe[Dt]=Vt;var vt=(oe,Dt,Vt)=>Rg(oe,typeof Dt!="symbol"?Dt+"":Dt,Vt);import{U as Pg,R as $t,m as Re,n as El,o as zg,p as Bl,q as Rl,r as Fg,t as li,v as $g,w as Vg,S as Kn,H as Pl,g as Y,y as Lg,z as jg,A as Wg,C as Jg,D as zl,E as qg,l as Hg,F as Ug,G as Kg,h as te,i as ci,x as ee,I as Gg,J as Gn,u as Xn,K as Xg,L as Qg}from"./notes-client.D5p1SwbK.js";import{_ as ht}from"./tslib.es6.kHcLnhpD.js";import{S as Fl}from"./signal-watcher.B8nWLdb2.js";import{g as Yg}from"./isIterateeCall.DmV5WHBc.js";import{n as $l,s as Vl,a as I,c as Qn,t as di}from"./property.D-Bq6jHL.js";import{a as Zg,w as Ll,b as tm,e as dn,c as hi,S as jl,_ as N,r as Yn,d as ui,f as Zn,g as pi,s as Wl,H as Jl,L as ql,i as Hl,j as Ul,k as Kl,n as Gl,o as Xl,p as fi,q as em,m as hn,t as nm,h as om,l as im}from"./chunk.3LWOA5DF.LMXLNl8H.js";import{e as rm}from"./provide.BzU9KVEG.js";import{n as sm}from"./context.Bpr8pzml.js";import"./range.DepzZoUv.js";import"./toFinite.CaWsV0a4.js";import"./isSymbol.DYPLY1nq.js";let ne,am=(async()=>{function oe(o){const t=document.createElement("div");return t.textContent=o,t.innerHTML}function Dt(o,t="primary",e=Zg,n=3e3){const i=Object.assign(document.createElement("sl-alert"),{variant:t,closable:!0,duration:n,innerHTML:`
        <sl-icon src="${Ll(e)}" slot="icon"></sl-icon>
        ${oe(o)}
      `});return document.body.append(i),i.toast()}function Vt(o){return Dt(o,"danger",tm)}const Yl="/notes-zome/assets/automerge_wasm_bg.B_JtgnFP.wasm",Zl=async(o={},t)=>{let e;if(t.startsWith("data:")){const n=t.replace(/^data:.*?base64,/,"");let i;if(typeof Buffer=="function"&&typeof Buffer.from=="function")i=Buffer.from(n,"base64");else if(typeof atob=="function"){const r=atob(n);i=new Uint8Array(r.length);for(let s=0;s<r.length;s++)i[s]=r.charCodeAt(s)}else throw new Error("Cannot decode base64-encoded data URL");e=await WebAssembly.instantiate(i,o)}else{const n=await fetch(t),i=n.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&i.startsWith("application/wasm"))e=await WebAssembly.instantiateStreaming(n,o);else{const r=await n.arrayBuffer();e=await WebAssembly.instantiate(r,o)}}return e.instance.exports};let u;function gi(o){u=o}const It=new Array(128).fill(void 0);It.push(void 0,null,!0,!1);function C(o){return It[o]}let ut=0,un=null;function Pe(){return(un===null||un.byteLength===0)&&(un=new Uint8Array(u.memory.buffer)),un}const tc=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let pn=new tc("utf-8");const ec=typeof pn.encodeInto=="function"?function(o,t){return pn.encodeInto(o,t)}:function(o,t){const e=pn.encode(o);return t.set(e),{read:o.length,written:e.length}};function kt(o,t,e){if(e===void 0){const a=pn.encode(o),l=t(a.length,1)>>>0;return Pe().subarray(l,l+a.length).set(a),ut=a.length,l}let n=o.length,i=t(n,1)>>>0;const r=Pe();let s=0;for(;s<n;s++){const a=o.charCodeAt(s);if(a>127)break;r[i+s]=a}if(s!==n){s!==0&&(o=o.slice(s)),i=e(i,n,n=s+o.length*3,1)>>>0;const a=Pe().subarray(i+s,i+n),l=ec(o,a);s+=l.written,i=e(i,n,s,1)>>>0}return ut=s,i}let we=null;function m(){return(we===null||we.buffer.detached===!0||we.buffer.detached===void 0&&we.buffer!==u.memory.buffer)&&(we=new DataView(u.memory.buffer)),we}let ze=It.length;function _(o){ze===It.length&&It.push(It.length+1);const t=ze;return ze=It[t],It[t]=o,t}function Tt(o,t){try{return o.apply(this,t)}catch(e){u.__wbindgen_exn_store(_(e))}}const nc=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let mi=new nc("utf-8",{ignoreBOM:!0,fatal:!0});mi.decode();function pt(o,t){return o=o>>>0,mi.decode(Pe().subarray(o,o+t))}function oc(o,t){return o=o>>>0,Pe().subarray(o/1,o/1+t)}function ic(o){o<132||(It[o]=ze,ze=o)}function w(o){const t=C(o);return ic(o),t}function to(o){const t=typeof o;if(t=="number"||t=="boolean"||o==null)return`${o}`;if(t=="string")return`"${o}"`;if(t=="symbol"){const i=o.description;return i==null?"Symbol":`Symbol(${i})`}if(t=="function"){const i=o.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(o)){const i=o.length;let r="[";i>0&&(r+=to(o[0]));for(let s=1;s<i;s++)r+=", "+to(o[s]);return r+="]",r}const e=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(e&&e.length>1)n=e[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function F(o){return o==null}function ie(o,t){if(!(o instanceof t))throw new Error(`expected instance of ${t.name}`)}function rc(o){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.create(i,_(o));var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return xt.__wrap(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function sc(o,t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.load(r,_(o),_(t));var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return xt.__wrap(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function ac(o){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.encodeChange(i,_(o));var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return w(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function lc(o){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.decodeChange(i,_(o));var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return w(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function cc(){const o=u.initSyncState();return ft.__wrap(o)}function dc(o){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.importSyncState(i,_(o));var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return ft.__wrap(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function hc(o){ie(o,ft);const t=u.exportSyncState(o.__wbg_ptr);return w(t)}function uc(o){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.encodeSyncMessage(i,_(o));var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return w(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function pc(o){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.decodeSyncMessage(i,_(o));var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return w(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function fc(o){ie(o,ft);const t=u.encodeSyncState(o.__wbg_ptr);return w(t)}function gc(o){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.decodeSyncState(i,_(o));var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return ft.__wrap(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}const mc=Object.freeze({Array:0,0:"Array",String:1,1:"String"}),bi=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(o=>u.__wbg_automerge_free(o>>>0,1));class xt{static __wrap(t){t=t>>>0;const e=Object.create(xt.prototype);return e.__wbg_ptr=t,bi.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,bi.unregister(this),t}free(){const t=this.__destroy_into_raw();u.__wbg_automerge_free(t,0)}static new(t,e){try{const l=u.__wbindgen_add_to_stack_pointer(-16);var n=F(t)?0:kt(t,u.__wbindgen_malloc,u.__wbindgen_realloc),i=ut;u.automerge_new(l,n,i,e);var r=m().getInt32(l+4*0,!0),s=m().getInt32(l+4*1,!0),a=m().getInt32(l+4*2,!0);if(a)throw w(s);return xt.__wrap(r)}finally{u.__wbindgen_add_to_stack_pointer(16)}}clone(t){try{const a=u.__wbindgen_add_to_stack_pointer(-16);var e=F(t)?0:kt(t,u.__wbindgen_malloc,u.__wbindgen_realloc),n=ut;u.automerge_clone(a,this.__wbg_ptr,e,n);var i=m().getInt32(a+4*0,!0),r=m().getInt32(a+4*1,!0),s=m().getInt32(a+4*2,!0);if(s)throw w(r);return xt.__wrap(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}fork(t,e){try{const l=u.__wbindgen_add_to_stack_pointer(-16);var n=F(t)?0:kt(t,u.__wbindgen_malloc,u.__wbindgen_realloc),i=ut;u.automerge_fork(l,this.__wbg_ptr,n,i,_(e));var r=m().getInt32(l+4*0,!0),s=m().getInt32(l+4*1,!0),a=m().getInt32(l+4*2,!0);if(a)throw w(s);return xt.__wrap(r)}finally{u.__wbindgen_add_to_stack_pointer(16)}}pendingOps(){const t=u.automerge_pendingOps(this.__wbg_ptr);return w(t)}commit(t,e){var n=F(t)?0:kt(t,u.__wbindgen_malloc,u.__wbindgen_realloc),i=ut;const r=u.automerge_commit(this.__wbg_ptr,n,i,!F(e),F(e)?0:e);return w(r)}merge(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);ie(t,xt),u.automerge_merge(r,this.__wbg_ptr,t.__wbg_ptr);var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}rollback(){return u.automerge_rollback(this.__wbg_ptr)}keys(t,e){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_keys(s,this.__wbg_ptr,_(t),F(e)?0:_(e));var n=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),r=m().getInt32(s+4*2,!0);if(r)throw w(i);return w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}text(t,e){let n,i;try{const h=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_text(h,this.__wbg_ptr,_(t),F(e)?0:_(e));var r=m().getInt32(h+4*0,!0),s=m().getInt32(h+4*1,!0),a=m().getInt32(h+4*2,!0),l=m().getInt32(h+4*3,!0),c=r,d=s;if(l)throw c=0,d=0,w(a);return n=c,i=d,pt(c,d)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(n,i,1)}}spans(t,e){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_spans(s,this.__wbg_ptr,_(t),F(e)?0:_(e));var n=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),r=m().getInt32(s+4*2,!0);if(r)throw w(i);return w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}splice(t,e,n,i){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_splice(a,this.__wbg_ptr,_(t),e,n,_(i));var r=m().getInt32(a+4*0,!0),s=m().getInt32(a+4*1,!0);if(s)throw w(r)}finally{u.__wbindgen_add_to_stack_pointer(16)}}updateText(t,e){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_updateText(r,this.__wbg_ptr,_(t),_(e));var n=m().getInt32(r+4*0,!0),i=m().getInt32(r+4*1,!0);if(i)throw w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}updateSpans(t,e){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_updateSpans(r,this.__wbg_ptr,_(t),_(e));var n=m().getInt32(r+4*0,!0),i=m().getInt32(r+4*1,!0);if(i)throw w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}push(t,e,n){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_push(s,this.__wbg_ptr,_(t),_(e),_(n));var i=m().getInt32(s+4*0,!0),r=m().getInt32(s+4*1,!0);if(r)throw w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}pushObject(t,e){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_pushObject(a,this.__wbg_ptr,_(t),_(e));var n=m().getInt32(a+4*0,!0),i=m().getInt32(a+4*1,!0),r=m().getInt32(a+4*2,!0),s=m().getInt32(a+4*3,!0);if(s)throw w(r);let l;return n!==0&&(l=pt(n,i).slice(),u.__wbindgen_free(n,i*1,1)),l}finally{u.__wbindgen_add_to_stack_pointer(16)}}insert(t,e,n,i){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_insert(a,this.__wbg_ptr,_(t),e,_(n),_(i));var r=m().getInt32(a+4*0,!0),s=m().getInt32(a+4*1,!0);if(s)throw w(r)}finally{u.__wbindgen_add_to_stack_pointer(16)}}splitBlock(t,e,n){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_splitBlock(s,this.__wbg_ptr,_(t),e,_(n));var i=m().getInt32(s+4*0,!0),r=m().getInt32(s+4*1,!0);if(r)throw w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}joinBlock(t,e){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_joinBlock(r,this.__wbg_ptr,_(t),e);var n=m().getInt32(r+4*0,!0),i=m().getInt32(r+4*1,!0);if(i)throw w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}updateBlock(t,e,n){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_updateBlock(s,this.__wbg_ptr,_(t),e,_(n));var i=m().getInt32(s+4*0,!0),r=m().getInt32(s+4*1,!0);if(r)throw w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}getBlock(t,e,n){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getBlock(a,this.__wbg_ptr,_(t),e,F(n)?0:_(n));var i=m().getInt32(a+4*0,!0),r=m().getInt32(a+4*1,!0),s=m().getInt32(a+4*2,!0);if(s)throw w(r);return w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}insertObject(t,e,n){try{const l=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_insertObject(l,this.__wbg_ptr,_(t),e,_(n));var i=m().getInt32(l+4*0,!0),r=m().getInt32(l+4*1,!0),s=m().getInt32(l+4*2,!0),a=m().getInt32(l+4*3,!0);if(a)throw w(s);let c;return i!==0&&(c=pt(i,r).slice(),u.__wbindgen_free(i,r*1,1)),c}finally{u.__wbindgen_add_to_stack_pointer(16)}}put(t,e,n,i){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_put(a,this.__wbg_ptr,_(t),_(e),_(n),_(i));var r=m().getInt32(a+4*0,!0),s=m().getInt32(a+4*1,!0);if(s)throw w(r)}finally{u.__wbindgen_add_to_stack_pointer(16)}}putObject(t,e,n){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_putObject(a,this.__wbg_ptr,_(t),_(e),_(n));var i=m().getInt32(a+4*0,!0),r=m().getInt32(a+4*1,!0),s=m().getInt32(a+4*2,!0);if(s)throw w(r);return w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}increment(t,e,n){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_increment(s,this.__wbg_ptr,_(t),_(e),_(n));var i=m().getInt32(s+4*0,!0),r=m().getInt32(s+4*1,!0);if(r)throw w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}get(t,e,n){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_get(a,this.__wbg_ptr,_(t),_(e),F(n)?0:_(n));var i=m().getInt32(a+4*0,!0),r=m().getInt32(a+4*1,!0),s=m().getInt32(a+4*2,!0);if(s)throw w(r);return w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}getWithType(t,e,n){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getWithType(a,this.__wbg_ptr,_(t),_(e),F(n)?0:_(n));var i=m().getInt32(a+4*0,!0),r=m().getInt32(a+4*1,!0),s=m().getInt32(a+4*2,!0);if(s)throw w(r);return w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}objInfo(t,e){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_objInfo(s,this.__wbg_ptr,_(t),F(e)?0:_(e));var n=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),r=m().getInt32(s+4*2,!0);if(r)throw w(i);return w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}getAll(t,e,n){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getAll(a,this.__wbg_ptr,_(t),_(e),F(n)?0:_(n));var i=m().getInt32(a+4*0,!0),r=m().getInt32(a+4*1,!0),s=m().getInt32(a+4*2,!0);if(s)throw w(r);return w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}enableFreeze(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_enableFreeze(r,this.__wbg_ptr,_(t));var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}registerDatatype(t,e,n){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_registerDatatype(s,this.__wbg_ptr,_(t),_(e),_(n));var i=m().getInt32(s+4*0,!0),r=m().getInt32(s+4*1,!0);if(r)throw w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}applyPatches(t,e){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_applyPatches(s,this.__wbg_ptr,_(t),_(e));var n=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),r=m().getInt32(s+4*2,!0);if(r)throw w(i);return w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}applyAndReturnPatches(t,e){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_applyAndReturnPatches(s,this.__wbg_ptr,_(t),_(e));var n=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),r=m().getInt32(s+4*2,!0);if(r)throw w(i);return w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}diffIncremental(){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_diffIncremental(i,this.__wbg_ptr);var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return w(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}updateDiffCursor(){u.automerge_updateDiffCursor(this.__wbg_ptr)}resetDiffCursor(){u.automerge_resetDiffCursor(this.__wbg_ptr)}diff(t,e){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_diff(s,this.__wbg_ptr,_(t),_(e));var n=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),r=m().getInt32(s+4*2,!0);if(r)throw w(i);return w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}isolate(t){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_isolate(i,this.__wbg_ptr,_(t));var e=m().getInt32(i+4*0,!0),n=m().getInt32(i+4*1,!0);if(n)throw w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}integrate(){u.automerge_integrate(this.__wbg_ptr)}length(t,e){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_length(s,this.__wbg_ptr,_(t),F(e)?0:_(e));var n=m().getFloat64(s+8*0,!0),i=m().getInt32(s+4*2,!0),r=m().getInt32(s+4*3,!0);if(r)throw w(i);return n}finally{u.__wbindgen_add_to_stack_pointer(16)}}delete(t,e){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_delete(r,this.__wbg_ptr,_(t),_(e));var n=m().getInt32(r+4*0,!0),i=m().getInt32(r+4*1,!0);if(i)throw w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}save(){const t=u.automerge_save(this.__wbg_ptr);return w(t)}saveIncremental(){const t=u.automerge_saveIncremental(this.__wbg_ptr);return w(t)}saveSince(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_saveSince(r,this.__wbg_ptr,_(t));var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}saveNoCompress(){const t=u.automerge_saveNoCompress(this.__wbg_ptr);return w(t)}saveAndVerify(){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_saveAndVerify(i,this.__wbg_ptr);var t=m().getInt32(i+4*0,!0),e=m().getInt32(i+4*1,!0),n=m().getInt32(i+4*2,!0);if(n)throw w(e);return w(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}loadIncremental(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_loadIncremental(r,this.__wbg_ptr,_(t));var e=m().getFloat64(r+8*0,!0),n=m().getInt32(r+4*2,!0),i=m().getInt32(r+4*3,!0);if(i)throw w(n);return e}finally{u.__wbindgen_add_to_stack_pointer(16)}}applyChanges(t){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_applyChanges(i,this.__wbg_ptr,_(t));var e=m().getInt32(i+4*0,!0),n=m().getInt32(i+4*1,!0);if(n)throw w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}getChanges(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getChanges(r,this.__wbg_ptr,_(t));var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}getChangeByHash(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getChangeByHash(r,this.__wbg_ptr,_(t));var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}getDecodedChangeByHash(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getDecodedChangeByHash(r,this.__wbg_ptr,_(t));var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}getChangesAdded(t){ie(t,xt);const e=u.automerge_getChangesAdded(this.__wbg_ptr,t.__wbg_ptr);return w(e)}getHeads(){const t=u.automerge_getHeads(this.__wbg_ptr);return w(t)}getActorId(){let t,e;try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getActorId(r,this.__wbg_ptr);var n=m().getInt32(r+4*0,!0),i=m().getInt32(r+4*1,!0);return t=n,e=i,pt(n,i)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(t,e,1)}}getLastLocalChange(){const t=u.automerge_getLastLocalChange(this.__wbg_ptr);return w(t)}dump(){u.automerge_dump(this.__wbg_ptr)}getMissingDeps(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getMissingDeps(r,this.__wbg_ptr,F(t)?0:_(t));var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}receiveSyncMessage(t,e){try{const r=u.__wbindgen_add_to_stack_pointer(-16);ie(t,ft),u.automerge_receiveSyncMessage(r,this.__wbg_ptr,t.__wbg_ptr,_(e));var n=m().getInt32(r+4*0,!0),i=m().getInt32(r+4*1,!0);if(i)throw w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}generateSyncMessage(t){ie(t,ft);const e=u.automerge_generateSyncMessage(this.__wbg_ptr,t.__wbg_ptr);return w(e)}toJS(t){try{const r=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_toJS(r,this.__wbg_ptr,_(t));var e=m().getInt32(r+4*0,!0),n=m().getInt32(r+4*1,!0),i=m().getInt32(r+4*2,!0);if(i)throw w(n);return w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}materialize(t,e,n){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_materialize(a,this.__wbg_ptr,_(t),F(e)?0:_(e),_(n));var i=m().getInt32(a+4*0,!0),r=m().getInt32(a+4*1,!0),s=m().getInt32(a+4*2,!0);if(s)throw w(r);return w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}getCursor(t,e,n,i){let r,s;try{const g=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getCursor(g,this.__wbg_ptr,_(t),_(e),F(n)?0:_(n),_(i));var a=m().getInt32(g+4*0,!0),l=m().getInt32(g+4*1,!0),c=m().getInt32(g+4*2,!0),d=m().getInt32(g+4*3,!0),h=a,f=l;if(d)throw h=0,f=0,w(c);return r=h,s=f,pt(h,f)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(r,s,1)}}getCursorPosition(t,e,n){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_getCursorPosition(a,this.__wbg_ptr,_(t),_(e),F(n)?0:_(n));var i=m().getFloat64(a+8*0,!0),r=m().getInt32(a+4*2,!0),s=m().getInt32(a+4*3,!0);if(s)throw w(r);return i}finally{u.__wbindgen_add_to_stack_pointer(16)}}emptyChange(t,e){var n=F(t)?0:kt(t,u.__wbindgen_malloc,u.__wbindgen_realloc),i=ut;const r=u.automerge_emptyChange(this.__wbg_ptr,n,i,!F(e),F(e)?0:e);return w(r)}mark(t,e,n,i,r){try{const l=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_mark(l,this.__wbg_ptr,_(t),_(e),_(n),_(i),_(r));var s=m().getInt32(l+4*0,!0),a=m().getInt32(l+4*1,!0);if(a)throw w(s)}finally{u.__wbindgen_add_to_stack_pointer(16)}}unmark(t,e,n){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_unmark(s,this.__wbg_ptr,_(t),_(e),_(n));var i=m().getInt32(s+4*0,!0),r=m().getInt32(s+4*1,!0);if(r)throw w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}marks(t,e){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_marks(s,this.__wbg_ptr,_(t),F(e)?0:_(e));var n=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),r=m().getInt32(s+4*2,!0);if(r)throw w(i);return w(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}marksAt(t,e,n){try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.automerge_marksAt(a,this.__wbg_ptr,_(t),e,F(n)?0:_(n));var i=m().getInt32(a+4*0,!0),r=m().getInt32(a+4*1,!0),s=m().getInt32(a+4*2,!0);if(s)throw w(r);return w(i)}finally{u.__wbindgen_add_to_stack_pointer(16)}}hasOurChanges(t){ie(t,ft);const e=u.automerge_hasOurChanges(this.__wbg_ptr,t.__wbg_ptr);return w(e)}topoHistoryTraversal(){const t=u.automerge_topoHistoryTraversal(this.__wbg_ptr);return w(t)}stats(){const t=u.automerge_stats(this.__wbg_ptr);return w(t)}}const _i=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(o=>u.__wbg_syncstate_free(o>>>0,1));class ft{static __wrap(t){t=t>>>0;const e=Object.create(ft.prototype);return e.__wbg_ptr=t,_i.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,_i.unregister(this),t}free(){const t=this.__destroy_into_raw();u.__wbg_syncstate_free(t,0)}get sharedHeads(){const t=u.syncstate_sharedHeads(this.__wbg_ptr);return w(t)}get lastSentHeads(){const t=u.syncstate_lastSentHeads(this.__wbg_ptr);return w(t)}set lastSentHeads(t){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.syncstate_set_lastSentHeads(i,this.__wbg_ptr,_(t));var e=m().getInt32(i+4*0,!0),n=m().getInt32(i+4*1,!0);if(n)throw w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}set sentHashes(t){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.syncstate_set_sentHashes(i,this.__wbg_ptr,_(t));var e=m().getInt32(i+4*0,!0),n=m().getInt32(i+4*1,!0);if(n)throw w(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}clone(){const t=u.syncstate_clone(this.__wbg_ptr);return ft.__wrap(t)}}function yi(o,t){const e=String(C(t)),n=kt(e,u.__wbindgen_malloc,u.__wbindgen_realloc),i=ut;m().setInt32(o+4*1,i,!0),m().setInt32(o+4*0,n,!0)}function wi(){return Tt(function(o,t,e){const n=Reflect.apply(C(o),C(t),C(e));return _(n)},arguments)}function vi(o,t){const e=Object.assign(C(o),C(t));return _(e)}function ki(o){const t=C(o).buffer;return _(t)}function xi(){return Tt(function(o,t){const e=C(o).call(C(t));return _(e)},arguments)}function Si(){return Tt(function(o,t,e){const n=C(o).call(C(t),C(e));return _(n)},arguments)}function Ci(o,t){const e=C(o).concat(C(t));return _(e)}function Mi(o,t,e){const n=Object.defineProperty(C(o),C(t),C(e));return _(n)}function Oi(){return Tt(function(o,t){return Reflect.deleteProperty(C(o),C(t))},arguments)}function Ni(o){return C(o).done}function Di(o){const t=Object.entries(C(o));return _(t)}function Ii(o,t){let e,n;try{e=o,n=t,console.error(pt(o,t))}finally{u.__wbindgen_free(e,n,1)}}function Ti(o,t){const e=Symbol.for(pt(o,t));return _(e)}function Ai(o){const t=Object.freeze(C(o));return _(t)}function Ei(o){const t=Array.from(C(o));return _(t)}function Bi(){return Tt(function(o,t){globalThis.crypto.getRandomValues(oc(o,t))},arguments)}function Ri(o){return C(o).getTime()}function Pi(){return Tt(function(o,t){const e=Reflect.get(C(o),C(t));return _(e)},arguments)}function zi(o,t){const e=C(o)[t>>>0];return _(e)}function Fi(o){let t;try{t=C(o)instanceof ArrayBuffer}catch{t=!1}return t}function $i(o){let t;try{t=C(o)instanceof Date}catch{t=!1}return t}function Vi(o){let t;try{t=C(o)instanceof Object}catch{t=!1}return t}function Li(o){let t;try{t=C(o)instanceof Uint8Array}catch{t=!1}return t}function ji(o){return Array.isArray(C(o))}function Wi(){return _(Symbol.iterator)}function Ji(o){const t=Object.keys(C(o));return _(t)}function qi(o){return C(o).length}function Hi(o){return C(o).length}function Ui(o){return C(o).length}function Ki(o,t){console.log(C(o),C(t))}function Gi(o){console.log(C(o))}function Xi(o,t){const e=new RangeError(pt(o,t));return _(e)}function Qi(o){const t=new Date(C(o));return _(t)}function Yi(){const o=new Object;return _(o)}function Zi(){const o=new Array;return _(o)}function tr(){const o=new Error;return _(o)}function er(o){const t=new Uint8Array(C(o));return _(t)}function nr(o,t){const e=new Error(pt(o,t));return _(e)}function or(o,t,e){const n=new Uint8Array(C(o),t>>>0,e>>>0);return _(n)}function ir(o){const t=C(o).next;return _(t)}function rr(){return Tt(function(o){const t=C(o).next();return _(t)},arguments)}function sr(){return Tt(function(o){const t=Reflect.ownKeys(C(o));return _(t)},arguments)}function ar(o,t){return C(o).push(C(t))}function lr(o,t,e){C(o)[t>>>0]=w(e)}function cr(o,t,e){C(o)[w(t)]=w(e)}function dr(o,t,e){C(o).set(C(t),e>>>0)}function hr(){return Tt(function(o,t,e){return Reflect.set(C(o),C(t),C(e))},arguments)}function ur(o,t,e){const n=C(o).slice(t>>>0,e>>>0);return _(n)}function pr(o,t){const e=C(t).stack,n=kt(e,u.__wbindgen_malloc,u.__wbindgen_realloc),i=ut;m().setInt32(o+4*1,i,!0),m().setInt32(o+4*0,n,!0)}function fr(o){const t=C(o).toString();return _(t)}function gr(o,t){return C(o).unshift(C(t))}function mr(o){const t=C(o).value;return _(t)}function br(o){const t=Object.values(C(o));return _(t)}function _r(o){return _(o)}function yr(o){const t=BigInt.asUintN(64,o);return _(t)}function wr(o){const t=C(o);return typeof t=="boolean"?t?1:0:2}function vr(o,t){const e=to(C(t)),n=kt(e,u.__wbindgen_malloc,u.__wbindgen_realloc),i=ut;m().setInt32(o+4*1,i,!0),m().setInt32(o+4*0,n,!0)}function kr(o,t){const e=new Error(pt(o,t));return _(e)}function xr(o){return Array.isArray(C(o))}function Sr(o){return typeof C(o)=="function"}function Cr(o){return C(o)===null}function Mr(o){const t=C(o);return typeof t=="object"&&t!==null}function Or(o){return typeof C(o)=="string"}function Nr(o){return C(o)===void 0}function Dr(o,t){const e=C(t),n=JSON.stringify(e===void 0?null:e),i=kt(n,u.__wbindgen_malloc,u.__wbindgen_realloc),r=ut;m().setInt32(o+4*1,r,!0),m().setInt32(o+4*0,i,!0)}function Ir(o,t){return C(o)==C(t)}function Tr(){const o=u.memory;return _(o)}function Ar(o,t){const e=C(t),n=typeof e=="number"?e:void 0;m().setFloat64(o+8*1,F(n)?0:n,!0),m().setInt32(o+4*0,!F(n),!0)}function Er(o){return _(o)}function Br(o){const t=C(o);return _(t)}function Rr(o){w(o)}function Pr(o,t){const e=C(t),n=typeof e=="string"?e:void 0;var i=F(n)?0:kt(n,u.__wbindgen_malloc,u.__wbindgen_realloc),r=ut;m().setInt32(o+4*1,r,!0),m().setInt32(o+4*0,i,!0)}function zr(o,t){const e=pt(o,t);return _(e)}function Fr(o,t){throw new Error(pt(o,t))}URL=globalThis.URL;const v=await Zl({"./automerge_wasm_bg.js":{__wbindgen_object_drop_ref:Rr,__wbindgen_string_get:Pr,__wbindgen_error_new:kr,__wbindgen_string_new:zr,__wbindgen_number_new:Er,__wbindgen_object_clone_ref:Br,__wbindgen_number_get:Ar,__wbindgen_is_undefined:Nr,__wbindgen_boolean_get:wr,__wbindgen_is_null:Cr,__wbindgen_is_string:Or,__wbindgen_is_function:Sr,__wbindgen_is_object:Mr,__wbindgen_is_array:xr,__wbindgen_json_serialize:Dr,__wbg_new_8a6f238a6ece86ea:tr,__wbg_stack_0ed75d68575b0f3c:pr,__wbg_error_7534b8e9a36f1ab4:Ii,__wbindgen_jsval_loose_eq:Ir,__wbg_String_fed4d24b68977888:yi,__wbindgen_bigint_from_i64:_r,__wbindgen_bigint_from_u64:yr,__wbg_set_3fda3bac07393de4:cr,__wbg_getRandomValues_3d90134a348e46b3:Bi,__wbg_log_c222819a41e063d3:Gi,__wbg_log_1ae1e9f741096e91:Ki,__wbg_get_b9b93047fe3cf45b:zi,__wbg_length_e2d2a49132c1b256:Ui,__wbg_new_78feb108b6472713:Zi,__wbg_next_25feadfc0913fea9:ir,__wbg_next_6574e1a8a62d1055:rr,__wbg_done_769e5ede4b31c67b:Ni,__wbg_value_cd1ffa7b1ab794f1:mr,__wbg_iterator_9a24c88df860dc65:Wi,__wbg_get_67b2ba62fc30de12:Pi,__wbg_call_672a4d21634d4a24:xi,__wbg_new_405e22f390576ce2:Yi,__wbg_length_d56737991078581b:Hi,__wbg_set_37837023f3d740e8:lr,__wbg_from_2a5d3e218e67aa85:Ei,__wbg_isArray_a1eab7e0d067391b:ji,__wbg_push_737cfc8c1432c2c6:ar,__wbg_unshift_c290010f73f04fb1:gr,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:Fi,__wbg_new_c68d7209be747379:nr,__wbg_call_7cccdd69e0791ae2:Si,__wbg_instanceof_Date_e9a9be8b9cea7890:$i,__wbg_getTime_46267b1c24877e30:Ri,__wbg_new_31a97dac4f10fab7:Qi,__wbg_instanceof_Object_7f2dcef8f78644a4:Vi,__wbg_assign_3627b8559449930a:vi,__wbg_defineProperty_a3ddad9901e2d29e:Mi,__wbg_entries_3265d4158b33e5dc:Di,__wbg_freeze_ef6d70cf38e8d948:Ai,__wbg_keys_5c77a08ddc2fb8a6:Ji,__wbg_values_fcb8ba8c0aad8b58:br,__wbg_new_1ab78df5e132f715:Xi,__wbg_apply_eb9e9b97497f91e4:wi,__wbg_deleteProperty_96363d4a1d977c97:Oi,__wbg_ownKeys_3930041068756f1f:sr,__wbg_set_bb8cecf6a62b9f46:hr,__wbg_buffer_609cc3eee51ed158:ki,__wbg_concat_9de968491c4340cf:Ci,__wbg_slice_972c243648c9fd2e:ur,__wbg_for_4ff07bddd743c5e7:Ti,__wbg_toString_66ab719c2a98bdf1:fr,__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a:or,__wbg_new_a12002a7f91c75be:er,__wbg_set_65595bdd868b3009:dr,__wbg_length_a446193dc22c12f8:qi,__wbg_instanceof_Uint8Array_17156bcf118086a9:Li,__wbindgen_debug_string:vr,__wbindgen_throw:Fr,__wbindgen_memory:Tr}},Yl),bc=v.memory,_c=v.__wbg_syncstate_free,yc=v.syncstate_sharedHeads,wc=v.syncstate_lastSentHeads,vc=v.syncstate_set_lastSentHeads,kc=v.syncstate_set_sentHashes,xc=v.syncstate_clone,Sc=v.__wbg_automerge_free,Cc=v.automerge_new,Mc=v.automerge_clone,Oc=v.automerge_fork,Nc=v.automerge_pendingOps,Dc=v.automerge_commit,Ic=v.automerge_merge,Tc=v.automerge_rollback,Ac=v.automerge_keys,Ec=v.automerge_text,Bc=v.automerge_spans,Rc=v.automerge_splice,Pc=v.automerge_updateText,zc=v.automerge_updateSpans,Fc=v.automerge_push,$c=v.automerge_pushObject,Vc=v.automerge_insert,Lc=v.automerge_splitBlock,jc=v.automerge_joinBlock,Wc=v.automerge_updateBlock,Jc=v.automerge_getBlock,qc=v.automerge_insertObject,Hc=v.automerge_put,Uc=v.automerge_putObject,Kc=v.automerge_increment,Gc=v.automerge_get,Xc=v.automerge_getWithType,Qc=v.automerge_objInfo,Yc=v.automerge_getAll,Zc=v.automerge_enableFreeze,td=v.automerge_registerDatatype,ed=v.automerge_applyPatches,nd=v.automerge_applyAndReturnPatches,od=v.automerge_diffIncremental,id=v.automerge_updateDiffCursor,rd=v.automerge_resetDiffCursor,sd=v.automerge_diff,ad=v.automerge_isolate,ld=v.automerge_integrate,cd=v.automerge_length,dd=v.automerge_delete,hd=v.automerge_save,ud=v.automerge_saveIncremental,pd=v.automerge_saveSince,fd=v.automerge_saveNoCompress,gd=v.automerge_saveAndVerify,md=v.automerge_loadIncremental,bd=v.automerge_applyChanges,_d=v.automerge_getChanges,yd=v.automerge_getChangeByHash,wd=v.automerge_getDecodedChangeByHash,vd=v.automerge_getChangesAdded,kd=v.automerge_getHeads,xd=v.automerge_getActorId,Sd=v.automerge_getLastLocalChange,Cd=v.automerge_dump,Md=v.automerge_getMissingDeps,Od=v.automerge_receiveSyncMessage,Nd=v.automerge_generateSyncMessage,Dd=v.automerge_toJS,Id=v.automerge_materialize,Td=v.automerge_getCursor,Ad=v.automerge_getCursorPosition,Ed=v.automerge_emptyChange,Bd=v.automerge_mark,Rd=v.automerge_unmark,Pd=v.automerge_marks,zd=v.automerge_marksAt,Fd=v.automerge_hasOurChanges,$d=v.automerge_topoHistoryTraversal,Vd=v.automerge_stats,Ld=v.create,jd=v.load,Wd=v.encodeChange,Jd=v.decodeChange,qd=v.initSyncState,Hd=v.importSyncState,Ud=v.exportSyncState,Kd=v.encodeSyncMessage,Gd=v.decodeSyncMessage,Xd=v.encodeSyncState,Qd=v.decodeSyncState,Yd=v.__wbindgen_malloc,Zd=v.__wbindgen_realloc,th=v.__wbindgen_exn_store,eh=v.__wbindgen_free,nh=v.__wbindgen_add_to_stack_pointer,oh=Object.freeze(Object.defineProperty({__proto__:null,__wbg_automerge_free:Sc,__wbg_syncstate_free:_c,__wbindgen_add_to_stack_pointer:nh,__wbindgen_exn_store:th,__wbindgen_free:eh,__wbindgen_malloc:Yd,__wbindgen_realloc:Zd,automerge_applyAndReturnPatches:nd,automerge_applyChanges:bd,automerge_applyPatches:ed,automerge_clone:Mc,automerge_commit:Dc,automerge_delete:dd,automerge_diff:sd,automerge_diffIncremental:od,automerge_dump:Cd,automerge_emptyChange:Ed,automerge_enableFreeze:Zc,automerge_fork:Oc,automerge_generateSyncMessage:Nd,automerge_get:Gc,automerge_getActorId:xd,automerge_getAll:Yc,automerge_getBlock:Jc,automerge_getChangeByHash:yd,automerge_getChanges:_d,automerge_getChangesAdded:vd,automerge_getCursor:Td,automerge_getCursorPosition:Ad,automerge_getDecodedChangeByHash:wd,automerge_getHeads:kd,automerge_getLastLocalChange:Sd,automerge_getMissingDeps:Md,automerge_getWithType:Xc,automerge_hasOurChanges:Fd,automerge_increment:Kc,automerge_insert:Vc,automerge_insertObject:qc,automerge_integrate:ld,automerge_isolate:ad,automerge_joinBlock:jc,automerge_keys:Ac,automerge_length:cd,automerge_loadIncremental:md,automerge_mark:Bd,automerge_marks:Pd,automerge_marksAt:zd,automerge_materialize:Id,automerge_merge:Ic,automerge_new:Cc,automerge_objInfo:Qc,automerge_pendingOps:Nc,automerge_push:Fc,automerge_pushObject:$c,automerge_put:Hc,automerge_putObject:Uc,automerge_receiveSyncMessage:Od,automerge_registerDatatype:td,automerge_resetDiffCursor:rd,automerge_rollback:Tc,automerge_save:hd,automerge_saveAndVerify:gd,automerge_saveIncremental:ud,automerge_saveNoCompress:fd,automerge_saveSince:pd,automerge_spans:Bc,automerge_splice:Rc,automerge_splitBlock:Lc,automerge_stats:Vd,automerge_text:Ec,automerge_toJS:Dd,automerge_topoHistoryTraversal:$d,automerge_unmark:Rd,automerge_updateBlock:Wc,automerge_updateDiffCursor:id,automerge_updateSpans:zc,automerge_updateText:Pc,create:Ld,decodeChange:Jd,decodeSyncMessage:Gd,decodeSyncState:Qd,encodeChange:Wd,encodeSyncMessage:Kd,encodeSyncState:Xd,exportSyncState:Ud,importSyncState:Hd,initSyncState:qd,load:jd,memory:bc,syncstate_clone:xc,syncstate_lastSentHeads:wc,syncstate_set_lastSentHeads:vc,syncstate_set_sentHashes:kc,syncstate_sharedHeads:yc},Symbol.toStringTag,{value:"Module"}));gi(oh);const ih=Object.freeze(Object.defineProperty({__proto__:null,Automerge:xt,SyncState:ft,TextRepresentation:mc,__wbg_String_fed4d24b68977888:yi,__wbg_apply_eb9e9b97497f91e4:wi,__wbg_assign_3627b8559449930a:vi,__wbg_buffer_609cc3eee51ed158:ki,__wbg_call_672a4d21634d4a24:xi,__wbg_call_7cccdd69e0791ae2:Si,__wbg_concat_9de968491c4340cf:Ci,__wbg_defineProperty_a3ddad9901e2d29e:Mi,__wbg_deleteProperty_96363d4a1d977c97:Oi,__wbg_done_769e5ede4b31c67b:Ni,__wbg_entries_3265d4158b33e5dc:Di,__wbg_error_7534b8e9a36f1ab4:Ii,__wbg_for_4ff07bddd743c5e7:Ti,__wbg_freeze_ef6d70cf38e8d948:Ai,__wbg_from_2a5d3e218e67aa85:Ei,__wbg_getRandomValues_3d90134a348e46b3:Bi,__wbg_getTime_46267b1c24877e30:Ri,__wbg_get_67b2ba62fc30de12:Pi,__wbg_get_b9b93047fe3cf45b:zi,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:Fi,__wbg_instanceof_Date_e9a9be8b9cea7890:$i,__wbg_instanceof_Object_7f2dcef8f78644a4:Vi,__wbg_instanceof_Uint8Array_17156bcf118086a9:Li,__wbg_isArray_a1eab7e0d067391b:ji,__wbg_iterator_9a24c88df860dc65:Wi,__wbg_keys_5c77a08ddc2fb8a6:Ji,__wbg_length_a446193dc22c12f8:qi,__wbg_length_d56737991078581b:Hi,__wbg_length_e2d2a49132c1b256:Ui,__wbg_log_1ae1e9f741096e91:Ki,__wbg_log_c222819a41e063d3:Gi,__wbg_new_1ab78df5e132f715:Xi,__wbg_new_31a97dac4f10fab7:Qi,__wbg_new_405e22f390576ce2:Yi,__wbg_new_78feb108b6472713:Zi,__wbg_new_8a6f238a6ece86ea:tr,__wbg_new_a12002a7f91c75be:er,__wbg_new_c68d7209be747379:nr,__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a:or,__wbg_next_25feadfc0913fea9:ir,__wbg_next_6574e1a8a62d1055:rr,__wbg_ownKeys_3930041068756f1f:sr,__wbg_push_737cfc8c1432c2c6:ar,__wbg_set_37837023f3d740e8:lr,__wbg_set_3fda3bac07393de4:cr,__wbg_set_65595bdd868b3009:dr,__wbg_set_bb8cecf6a62b9f46:hr,__wbg_set_wasm:gi,__wbg_slice_972c243648c9fd2e:ur,__wbg_stack_0ed75d68575b0f3c:pr,__wbg_toString_66ab719c2a98bdf1:fr,__wbg_unshift_c290010f73f04fb1:gr,__wbg_value_cd1ffa7b1ab794f1:mr,__wbg_values_fcb8ba8c0aad8b58:br,__wbindgen_bigint_from_i64:_r,__wbindgen_bigint_from_u64:yr,__wbindgen_boolean_get:wr,__wbindgen_debug_string:vr,__wbindgen_error_new:kr,__wbindgen_is_array:xr,__wbindgen_is_function:Sr,__wbindgen_is_null:Cr,__wbindgen_is_object:Mr,__wbindgen_is_string:Or,__wbindgen_is_undefined:Nr,__wbindgen_json_serialize:Dr,__wbindgen_jsval_loose_eq:Ir,__wbindgen_memory:Tr,__wbindgen_number_get:Ar,__wbindgen_number_new:Er,__wbindgen_object_clone_ref:Br,__wbindgen_object_drop_ref:Rr,__wbindgen_string_get:Pr,__wbindgen_string_new:zr,__wbindgen_throw:Fr,create:rc,decodeChange:lc,decodeSyncMessage:pc,decodeSyncState:gc,encodeChange:ac,encodeSyncMessage:uc,encodeSyncState:fc,exportSyncState:hc,importSyncState:dc,initSyncState:cc,load:sc},Symbol.toStringTag,{value:"Module"}));Pg(ih);function q(o){this.content=o}q.prototype={constructor:q,find:function(o){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===o)return t;return-1},get:function(o){var t=this.find(o);return t==-1?void 0:this.content[t+1]},update:function(o,t,e){var n=e&&e!=o?this.remove(e):this,i=n.find(o),r=n.content.slice();return i==-1?r.push(e||o,t):(r[i+1]=t,e&&(r[i]=e)),new q(r)},remove:function(o){var t=this.find(o);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new q(e)},addToStart:function(o,t){return new q([o,t].concat(this.remove(o).content))},addToEnd:function(o,t){var e=this.remove(o).content.slice();return e.push(o,t),new q(e)},addBefore:function(o,t,e){var n=this.remove(t),i=n.content.slice(),r=n.find(o);return i.splice(r==-1?i.length:r,0,t,e),new q(i)},forEach:function(o){for(var t=0;t<this.content.length;t+=2)o(this.content[t],this.content[t+1])},prepend:function(o){return o=q.from(o),o.size?new q(o.content.concat(this.subtract(o).content)):this},append:function(o){return o=q.from(o),o.size?new q(this.subtract(o).content.concat(o.content)):this},subtract:function(o){var t=this;o=q.from(o);for(var e=0;e<o.content.length;e+=2)t=t.remove(o.content[e]);return t},toObject:function(){var o={};return this.forEach(function(t,e){o[t]=e}),o},get size(){return this.content.length>>1}},q.from=function(o){if(o instanceof q)return o;var t=[];if(o)for(var e in o)t.push(e,o[e]);return new q(t)};function $r(o,t,e){for(let n=0;;n++){if(n==o.childCount||n==t.childCount)return o.childCount==t.childCount?null:e;let i=o.child(n),r=t.child(n);if(i==r){e+=i.nodeSize;continue}if(!i.sameMarkup(r))return e;if(i.isText&&i.text!=r.text){for(let s=0;i.text[s]==r.text[s];s++)e++;return e}if(i.content.size||r.content.size){let s=$r(i.content,r.content,e+1);if(s!=null)return s}e+=i.nodeSize}}function Vr(o,t,e,n){for(let i=o.childCount,r=t.childCount;;){if(i==0||r==0)return i==r?null:{a:e,b:n};let s=o.child(--i),a=t.child(--r),l=s.nodeSize;if(s==a){e-=l,n-=l;continue}if(!s.sameMarkup(a))return{a:e,b:n};if(s.isText&&s.text!=a.text){let c=0,d=Math.min(s.text.length,a.text.length);for(;c<d&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,e--,n--;return{a:e,b:n}}if(s.content.size||a.content.size){let c=Vr(s.content,a.content,e-1,n-1);if(c)return c}e-=l,n-=l}}class x{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,i=0,r){for(let s=0,a=0;a<e;s++){let l=this.content[s],c=a+l.nodeSize;if(c>t&&n(l,i+a,r||null,s)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,t-d),Math.min(l.content.size,e-d),n,i+d)}a=c}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,i){let r="",s=!0;return this.nodesBetween(t,e,(a,l)=>{let c=a.isText?a.text.slice(Math.max(t,l)-l,e-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(s?s=!1:r+=n),r+=c},0),r}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,i=this.content.slice(),r=0;for(e.isText&&e.sameMarkup(n)&&(i[i.length-1]=e.withText(e.text+n.text),r=1);r<t.content.length;r++)i.push(t.content[r]);return new x(i,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let n=[],i=0;if(e>t)for(let r=0,s=0;s<e;r++){let a=this.content[r],l=s+a.nodeSize;l>t&&((s<t||l>e)&&(a.isText?a=a.cut(Math.max(0,t-s),Math.min(a.text.length,e-s)):a=a.cut(Math.max(0,t-s-1),Math.min(a.content.size,e-s-1))),n.push(a),i+=a.nodeSize),s=l}return new x(n,i)}cutByIndex(t,e){return t==e?x.empty:t==0&&e==this.content.length?this:new x(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let i=this.content.slice(),r=this.size+e.nodeSize-n.nodeSize;return i[t]=e,new x(i,r)}addToStart(t){return new x([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new x(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let i=this.content[e];t(i,n,e),n+=i.nodeSize}}findDiffStart(t,e=0){return $r(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return Vr(this,t,e,n)}findIndex(t,e=-1){if(t==0)return fn(0,t);if(t==this.size)return fn(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,i=0;;n++){let r=this.child(n),s=i+r.nodeSize;if(s>=t)return s==t||e>0?fn(n+1,s):fn(n,i);i=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return x.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new x(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return x.empty;let e,n=0;for(let i=0;i<t.length;i++){let r=t[i];n+=r.nodeSize,i&&r.isText&&t[i-1].sameMarkup(r)?(e||(e=t.slice(0,i)),e[e.length-1]=r.withText(e[e.length-1].text+r.text)):e&&e.push(r)}return new x(e||t,n)}static from(t){if(!t)return x.empty;if(t instanceof x)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new x([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}x.empty=new x([],0);const eo={index:0,offset:0};function fn(o,t){return eo.index=o,eo.offset=t,eo}function gn(o,t){if(o===t)return!0;if(!(o&&typeof o=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(o);if(Array.isArray(t)!=e)return!1;if(e){if(o.length!=t.length)return!1;for(let n=0;n<o.length;n++)if(!gn(o[n],t[n]))return!1}else{for(let n in o)if(!(n in t)||!gn(o[n],t[n]))return!1;for(let n in t)if(!(n in o))return!1}return!0}class B{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let i=0;i<t.length;i++){let r=t[i];if(this.eq(r))return t;if(this.type.excludes(r.type))e||(e=t.slice(0,i));else{if(r.type.excludes(this.type))return t;!n&&r.type.rank>this.type.rank&&(e||(e=t.slice(0,i)),e.push(this),n=!0),e&&e.push(r)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&gn(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);let i=n.create(e.attrs);return n.checkAttrs(i.attrs),i}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return B.none;if(t instanceof B)return[t];let e=t.slice();return e.sort((n,i)=>n.type.rank-i.type.rank),e}}B.none=[];class mn extends Error{}class M{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=jr(this.content,t+this.openStart,e);return n&&new M(n,this.openStart,this.openEnd)}removeBetween(t,e){return new M(Lr(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return M.empty;let n=e.openStart||0,i=e.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new M(x.fromJSON(t,e.content),n,i)}static maxOpen(t,e=!0){let n=0,i=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let r=t.lastChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.lastChild)i++;return new M(t,n,i)}}M.empty=new M(x.empty,0,0);function Lr(o,t,e){let{index:n,offset:i}=o.findIndex(t),r=o.maybeChild(n),{index:s,offset:a}=o.findIndex(e);if(i==t||r.isText){if(a!=e&&!o.child(s).isText)throw new RangeError("Removing non-flat range");return o.cut(0,t).append(o.cut(e))}if(n!=s)throw new RangeError("Removing non-flat range");return o.replaceChild(n,r.copy(Lr(r.content,t-i-1,e-i-1)))}function jr(o,t,e,n){let{index:i,offset:r}=o.findIndex(t),s=o.maybeChild(i);if(r==t||s.isText)return o.cut(0,t).append(e).append(o.cut(t));let a=jr(s.content,t-r-1,e);return a&&o.replaceChild(i,s.copy(a))}function rh(o,t,e){if(e.openStart>o.depth)throw new mn("Inserted content deeper than insertion position");if(o.depth-e.openStart!=t.depth-e.openEnd)throw new mn("Inconsistent open depths");return Wr(o,t,e,0)}function Wr(o,t,e,n){let i=o.index(n),r=o.node(n);if(i==t.index(n)&&n<o.depth-e.openStart){let s=Wr(o,t,e,n+1);return r.copy(r.content.replaceChild(i,s))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&o.depth==n&&t.depth==n){let s=o.parent,a=s.content;return se(s,a.cut(0,o.parentOffset).append(e.content).append(a.cut(t.parentOffset)))}else{let{start:s,end:a}=sh(e,o);return se(r,qr(o,s,a,t,n))}else return se(r,bn(o,t,n))}function Jr(o,t){if(!t.type.compatibleContent(o.type))throw new mn("Cannot join "+t.type.name+" onto "+o.type.name)}function no(o,t,e){let n=o.node(e);return Jr(n,t.node(e)),n}function re(o,t){let e=t.length-1;e>=0&&o.isText&&o.sameMarkup(t[e])?t[e]=o.withText(t[e].text+o.text):t.push(o)}function Fe(o,t,e,n){let i=(t||o).node(e),r=0,s=t?t.index(e):i.childCount;o&&(r=o.index(e),o.depth>e?r++:o.textOffset&&(re(o.nodeAfter,n),r++));for(let a=r;a<s;a++)re(i.child(a),n);t&&t.depth==e&&t.textOffset&&re(t.nodeBefore,n)}function se(o,t){return o.type.checkContent(t),o.copy(t)}function qr(o,t,e,n,i){let r=o.depth>i&&no(o,t,i+1),s=n.depth>i&&no(e,n,i+1),a=[];return Fe(null,o,i,a),r&&s&&t.index(i)==e.index(i)?(Jr(r,s),re(se(r,qr(o,t,e,n,i+1)),a)):(r&&re(se(r,bn(o,t,i+1)),a),Fe(t,e,i,a),s&&re(se(s,bn(e,n,i+1)),a)),Fe(n,null,i,a),new x(a)}function bn(o,t,e){let n=[];if(Fe(null,o,e,n),o.depth>e){let i=no(o,t,e+1);re(se(i,bn(o,t,e+1)),n)}return Fe(t,null,e,n),new x(n)}function sh(o,t){let e=t.depth-o.openStart,n=t.node(e).copy(o.content);for(let i=e-1;i>=0;i--)n=t.node(i).copy(x.from(n));return{start:n.resolveNoCache(o.openStart+e),end:n.resolveNoCache(n.content.size-o.openEnd-e)}}class $e{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=t.child(e);return n?t.child(e).cut(n):i}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[e*3],i=e==0?0:this.path[e*3-1]+1;for(let r=0;r<t;r++)i+=n.child(r).nodeSize;return i}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return B.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),i=t.maybeChild(e);if(!n){let a=n;n=i,i=a}let r=n.marks;for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,i=t.parent.maybeChild(t.index());for(var r=0;r<n.length;r++)n[r].type.spec.inclusive===!1&&(!i||!n[r].isInSet(i.marks))&&(n=n[r--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new ch(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],i=0,r=e;for(let s=t;;){let{index:a,offset:l}=s.content.findIndex(r),c=r-l;if(n.push(s,a,i+l),!c||(s=s.child(a),s.isText))break;r=c-1,i+=l+1}return new $e(e,n,r)}static resolveCached(t,e){let n=Hr.get(t);if(n)for(let r=0;r<n.elts.length;r++){let s=n.elts[r];if(s.pos==e)return s}else Hr.set(t,n=new ah);let i=n.elts[n.i]=$e.resolve(t,e);return n.i=(n.i+1)%lh,i}}class ah{constructor(){this.elts=[],this.i=0}}const lh=12,Hr=new WeakMap;class ch{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const dh=Object.create(null);class St{constructor(t,e,n,i=B.none){this.type=t,this.attrs=e,this.marks=i,this.content=n||x.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,i=0){this.content.nodesBetween(t,e,n,i,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,i){return this.content.textBetween(t,e,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&gn(this.attrs,e||t.defaultAttrs||dh)&&B.sameSet(this.marks,n||B.none)}copy(t=null){return t==this.content?this:new St(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new St(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return M.empty;let i=this.resolve(t),r=this.resolve(e),s=n?0:i.sharedDepth(e),a=i.start(s),l=i.node(s).content.cut(i.pos-a,r.pos-a);return new M(l,i.depth-s,r.depth-s)}replace(t,e,n){return rh(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:i}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(i==t||e.isText)return e;t-=i+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let i=this.content.child(e-1);return{node:i,index:e-1,offset:n-i.nodeSize}}resolve(t){return $e.resolveCached(this,t)}resolveNoCache(t){return $e.resolve(this,t)}rangeHasMark(t,e,n){let i=!1;return e>t&&this.nodesBetween(t,e,r=>(n.isInSet(r.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Ur(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=x.empty,i=0,r=n.childCount){let s=this.contentMatchAt(t).matchFragment(n,i,r),a=s&&s.matchFragment(this.content,e);if(!a||!a.validEnd)return!1;for(let l=i;l<r;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(t,e,n,i){if(i&&!this.type.allowsMarks(i))return!1;let r=this.contentMatchAt(t).matchType(n),s=r&&r.matchFragment(this.content,e);return s?s.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=B.none;for(let e=0;e<this.marks.length;e++){let n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!B.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let i=x.fromJSON(t,e.content),r=t.nodeType(e.type).create(e.attrs,i,n);return r.type.checkAttrs(r.attrs),r}}St.prototype.text=void 0;class _n extends St{constructor(t,e,n,i){if(super(t,e,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Ur(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new _n(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new _n(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function Ur(o,t){for(let e=o.length-1;e>=0;e--)t=o[e].type.name+"("+t+")";return t}class ae{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new hh(t,e);if(n.next==null)return ae.empty;let i=Kr(n);n.next&&n.err("Unexpected trailing text");let r=_h(bh(i));return yh(r,n),r}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let i=this;for(let r=e;i&&r<n;r++)i=i.matchType(t.child(r).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let i=[this];function r(s,a){let l=s.matchFragment(t,n);if(l&&(!e||l.validEnd))return x.from(a.map(c=>c.createAndFill()));for(let c=0;c<s.next.length;c++){let{type:d,next:h}=s.next[c];if(!(d.isText||d.hasRequiredAttrs())&&i.indexOf(h)==-1){i.push(h);let f=r(h,a.concat(d));if(f)return f}}return null}return r(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),r=i.match;if(r.matchType(t)){let s=[];for(let a=i;a.type;a=a.via)s.push(a.type);return s.reverse()}for(let s=0;s<r.next.length;s++){let{type:a,next:l}=r.next[s];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in e)&&(!i.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:i}),e[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(n){t.push(n);for(let i=0;i<n.next.length;i++)t.indexOf(n.next[i].next)==-1&&e(n.next[i].next)}return e(this),t.map((n,i)=>{let r=i+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)r+=(s?", ":"")+n.next[s].type.name+"->"+t.indexOf(n.next[s].next);return r}).join(`
`)}}ae.empty=new ae(!0);class hh{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function Kr(o){let t=[];do t.push(uh(o));while(o.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function uh(o){let t=[];do t.push(ph(o));while(o.next&&o.next!=")"&&o.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function ph(o){let t=mh(o);for(;;)if(o.eat("+"))t={type:"plus",expr:t};else if(o.eat("*"))t={type:"star",expr:t};else if(o.eat("?"))t={type:"opt",expr:t};else if(o.eat("{"))t=fh(o,t);else break;return t}function Gr(o){/\D/.test(o.next)&&o.err("Expected number, got '"+o.next+"'");let t=Number(o.next);return o.pos++,t}function fh(o,t){let e=Gr(o),n=e;return o.eat(",")&&(o.next!="}"?n=Gr(o):n=-1),o.eat("}")||o.err("Unclosed braced range"),{type:"range",min:e,max:n,expr:t}}function gh(o,t){let e=o.nodeTypes,n=e[t];if(n)return[n];let i=[];for(let r in e){let s=e[r];s.isInGroup(t)&&i.push(s)}return i.length==0&&o.err("No node type or group '"+t+"' found"),i}function mh(o){if(o.eat("(")){let t=Kr(o);return o.eat(")")||o.err("Missing closing paren"),t}else if(/\W/.test(o.next))o.err("Unexpected token '"+o.next+"'");else{let t=gh(o,o.next).map(e=>(o.inline==null?o.inline=e.isInline:o.inline!=e.isInline&&o.err("Mixing inline and block content"),{type:"name",value:e}));return o.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function bh(o){let t=[[]];return i(r(o,0),e()),t;function e(){return t.push([])-1}function n(s,a,l){let c={term:l,to:a};return t[s].push(c),c}function i(s,a){s.forEach(l=>l.to=a)}function r(s,a){if(s.type=="choice")return s.exprs.reduce((l,c)=>l.concat(r(c,a)),[]);if(s.type=="seq")for(let l=0;;l++){let c=r(s.exprs[l],a);if(l==s.exprs.length-1)return c;i(c,a=e())}else if(s.type=="star"){let l=e();return n(a,l),i(r(s.expr,l),l),[n(l)]}else if(s.type=="plus"){let l=e();return i(r(s.expr,a),l),i(r(s.expr,l),l),[n(l)]}else{if(s.type=="opt")return[n(a)].concat(r(s.expr,a));if(s.type=="range"){let l=a;for(let c=0;c<s.min;c++){let d=e();i(r(s.expr,l),d),l=d}if(s.max==-1)i(r(s.expr,l),l);else for(let c=s.min;c<s.max;c++){let d=e();n(l,d),i(r(s.expr,l),d),l=d}return[n(l)]}else{if(s.type=="name")return[n(a,void 0,s.value)];throw new Error("Unknown expr type")}}}}function Xr(o,t){return t-o}function Qr(o,t){let e=[];return n(t),e.sort(Xr);function n(i){let r=o[i];if(r.length==1&&!r[0].term)return n(r[0].to);e.push(i);for(let s=0;s<r.length;s++){let{term:a,to:l}=r[s];!a&&e.indexOf(l)==-1&&n(l)}}}function _h(o){let t=Object.create(null);return e(Qr(o,0));function e(n){let i=[];n.forEach(s=>{o[s].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let d=0;d<i.length;d++)i[d][0]==a&&(c=i[d][1]);Qr(o,l).forEach(d=>{c||i.push([a,c=[]]),c.indexOf(d)==-1&&c.push(d)})})});let r=t[n.join(",")]=new ae(n.indexOf(o.length-1)>-1);for(let s=0;s<i.length;s++){let a=i[s][1].sort(Xr);r.next.push({type:i[s][0],next:t[a.join(",")]||e(a)})}return r}}function yh(o,t){for(let e=0,n=[o];e<n.length;e++){let i=n[e],r=!i.validEnd,s=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];s.push(l.name),r&&!(l.isText||l.hasRequiredAttrs())&&(r=!1),n.indexOf(c)==-1&&n.push(c)}r&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Yr(o){let t=Object.create(null);for(let e in o){let n=o[e];if(!n.hasDefault)return null;t[e]=n.default}return t}function Zr(o,t){let e=Object.create(null);for(let n in o){let i=t&&t[n];if(i===void 0){let r=o[n];if(r.hasDefault)i=r.default;else throw new RangeError("No value supplied for attribute "+n)}e[n]=i}return e}function ts(o,t,e,n){for(let i in t)if(!(i in o))throw new RangeError(`Unsupported attribute ${i} for ${e} of type ${i}`);for(let i in o){let r=o[i];r.validate&&r.validate(t[i])}}function es(o,t){let e=Object.create(null);if(t)for(let n in t)e[n]=new vh(o,n,t[n]);return e}let ns=class Ql{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=es(t,n.attrs),this.defaultAttrs=Yr(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ae.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:Zr(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new St(this,this.computeAttrs(t),x.from(e),B.setFrom(n))}createChecked(t=null,e,n){return e=x.from(e),this.checkContent(e),new St(this,this.computeAttrs(t),e,B.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),e=x.from(e),e.size){let s=this.contentMatch.fillBefore(e);if(!s)return null;e=s.append(e)}let i=this.contentMatch.matchFragment(e),r=i&&i.fillBefore(x.empty,!0);return r?new St(this,t,e.append(r),B.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){ts(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:B.none:t}static compile(t,e){let n=Object.create(null);t.forEach((r,s)=>n[r]=new Ql(r,e,s));let i=e.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let r in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function wh(o,t,e){let n=e.split("|");return i=>{let r=i===null?"null":typeof i;if(n.indexOf(r)<0)throw new RangeError(`Expected value of type ${n} for attribute ${t} on type ${o}, got ${r}`)}}class vh{constructor(t,e,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?wh(t,e,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class yn{constructor(t,e,n,i){this.name=t,this.rank=e,this.schema=n,this.spec=i,this.attrs=es(t,i.attrs),this.excluded=null;let r=Yr(this.attrs);this.instance=r?new B(this,r):null}create(t=null){return!t&&this.instance?this.instance:new B(this,Zr(this.attrs,t))}static compile(t,e){let n=Object.create(null),i=0;return t.forEach((r,s)=>n[r]=new yn(r,i++,e,s)),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){ts(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class kh{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let i in t)e[i]=t[i];e.nodes=q.from(t.nodes),e.marks=q.from(t.marks||{}),this.nodes=ns.compile(this.spec.nodes,this),this.marks=yn.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let r=this.nodes[i],s=r.spec.content||"",a=r.spec.marks;if(r.contentMatch=n[s]||(n[s]=ae.parse(s,this.nodes)),r.inlineContent=r.contentMatch.inlineContent,r.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!r.isInline||!r.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=r}r.markSet=a=="_"?null:a?is(this,a.split(" ")):a==""||!r.inlineContent?[]:null}for(let i in this.marks){let r=this.marks[i],s=r.spec.excludes;r.excluded=s==null?[r]:s==""?[]:is(this,s.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,i){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof ns){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,n,i)}text(t,e){let n=this.nodes.text;return new _n(n,n.defaultAttrs,t,B.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeFromJSON(t){return St.fromJSON(this,t)}markFromJSON(t){return B.fromJSON(this,t)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}function is(o,t){let e=[];for(let n=0;n<t.length;n++){let i=t[n],r=o.marks[i],s=r;if(r)e.push(r);else for(let a in o.marks){let l=o.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&e.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}return e}function xh(o){return o.tag!=null}function Sh(o){return o.style!=null}class Ve{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let n=this.matchedStyles=[];e.forEach(i=>{if(xh(i))this.tags.push(i);else if(Sh(i)){let r=/[^=]*/.exec(i.style)[0];n.indexOf(r)<0&&n.push(r),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let r=t.nodes[i.node];return r.contentMatch.matchType(r)})}parse(t,e={}){let n=new ls(this,e,!1);return n.addAll(t,B.none,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new ls(this,e,!0);return n.addAll(t,B.none,e.from,e.to),M.maxOpen(n.finish())}matchTag(t,e,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let r=this.tags[i];if(Oh(t,r.tag)&&(r.namespace===void 0||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){let s=r.getAttrs(t);if(s===!1)continue;r.attrs=s||void 0}return r}}}matchStyle(t,e,n,i){for(let r=i?this.styles.indexOf(i)+1:0;r<this.styles.length;r++){let s=this.styles[r],a=s.style;if(!(a.indexOf(t)!=0||s.context&&!n.matchesContext(s.context)||a.length>t.length&&(a.charCodeAt(t.length)!=61||a.slice(t.length+1)!=e))){if(s.getAttrs){let l=s.getAttrs(e);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(t){let e=[];function n(i){let r=i.priority==null?50:i.priority,s=0;for(;s<e.length;s++){let a=e[s];if((a.priority==null?50:a.priority)<r)break}e.splice(s,0,i)}for(let i in t.marks){let r=t.marks[i].spec.parseDOM;r&&r.forEach(s=>{n(s=cs(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in t.nodes){let r=t.nodes[i].spec.parseDOM;r&&r.forEach(s=>{n(s=cs(s)),s.node||s.ignore||s.mark||(s.node=i)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Ve(t,Ve.schemaRules(t)))}}const rs={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ch={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ss={ol:!0,ul:!0},Le=1,oo=2,wn=4;function as(o,t,e){return t!=null?(t?Le:0)|(t==="full"?oo:0):o&&o.whitespace=="pre"?Le|oo:e&-5}class vn{constructor(t,e,n,i,r,s){this.type=t,this.attrs=e,this.marks=n,this.solid=i,this.options=s,this.content=[],this.activeMarks=B.none,this.match=r||(s&wn?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(x.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(t.type))?(this.match=n,i):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Le)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let r=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-i[0].length))}}let e=x.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(x.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!rs.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class ls{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=e.topNode,r,s=as(null,e.preserveWhitespace,0)|(n?wn:0);i?r=new vn(i.type,i.attrs,B.none,!0,e.topMatch||i.type.contentMatch,s):n?r=new vn(null,null,B.none,!0,null,s):r=new vn(t.schema.topNodeType,null,B.none,!0,null,s),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){t.nodeType==3?this.addTextNode(t,e):t.nodeType==1&&this.addElement(t,e)}addTextNode(t,e){let n=t.nodeValue,i=this.top,r=i.options&oo?"full":this.localPreserveWS||(i.options&Le)>0;if(r==="full"||i.inlineContext(t)||/[^ \t\r\n\u000c]/.test(n)){if(r)r!=="full"?n=n.replace(/\r?\n|\r/g," "):n=n.replace(/\r\n?/g,`
`);else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let s=i.content[i.content.length-1],a=t.previousSibling;(!s||a&&a.nodeName=="BR"||s.isText&&/[ \t\r\n\u000c]$/.test(s.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),e,!/\S/.test(n)),this.findInText(t)}else this.findInside(t)}addElement(t,e,n){let i=this.localPreserveWS,r=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let s=t.nodeName.toLowerCase(),a;ss.hasOwnProperty(s)&&this.parser.normalizeLists&&Mh(t);let l=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(a=this.parser.matchTag(t,this,n));t:if(l?l.ignore:Ch.hasOwnProperty(s))this.findInside(t),this.ignoreFallback(t,e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(t=l.skip);let c,d=this.needsBlock;if(rs.hasOwnProperty(s))r.content.length&&r.content[0].isInline&&this.open&&(this.open--,r=this.top),c=!0,r.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break t}let h=l&&l.skip?e:this.readStyles(t,e);h&&this.addAll(t,h),c&&this.sync(r),this.needsBlock=d}else{let c=this.readStyles(t,e);c&&this.addElementByRule(t,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(t,e){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),e)}ignoreFallback(t,e){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),e,!0)}readStyles(t,e){let n=t.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let r=this.parser.matchedStyles[i],s=n.getPropertyValue(r);if(s)for(let a=void 0;;){let l=this.parser.matchStyle(r,s,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?e=e.filter(c=>!l.clearMark(c)):e=e.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return e}addElementByRule(t,e,n,i){let r,s;if(e.node)if(s=this.parser.schema.nodes[e.node],s.isLeaf)this.insertNode(s.create(e.attrs),n,t.nodeName=="BR")||this.leafFallback(t,n);else{let l=this.enter(s,e.attrs||null,n,e.preserveWhitespace);l&&(r=!0,n=l)}else{let l=this.parser.schema.marks[e.mark];n=n.concat(l.create(e.attrs))}let a=this.top;if(s&&s.isLeaf)this.findInside(t);else if(i)this.addElement(t,n,i);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=t;typeof e.contentElement=="string"?l=t.querySelector(e.contentElement):typeof e.contentElement=="function"?l=e.contentElement(t):e.contentElement&&(l=e.contentElement),this.findAround(t,l,!0),this.addAll(l,n),this.findAround(t,l,!1)}r&&this.sync(a)&&this.open--}addAll(t,e,n,i){let r=n||0;for(let s=n?t.childNodes[n]:t.firstChild,a=i==null?null:t.childNodes[i];s!=a;s=s.nextSibling,++r)this.findAtPoint(t,r),this.addDOM(s,e);this.findAtPoint(t,r)}findPlace(t,e,n){let i,r;for(let s=this.open,a=0;s>=0;s--){let l=this.nodes[s],c=l.findWrapping(t);if(c&&(!i||i.length>c.length+a)&&(i=c,r=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!i)return null;this.sync(r);for(let s=0;s<i.length;s++)e=this.enterInner(i[s],null,e,!1);return e}insertNode(t,e,n){if(t.isInline&&this.needsBlock&&!this.top.type){let r=this.textblockFromContext();r&&(e=this.enterInner(r,null,e))}let i=this.findPlace(t,e,n);if(i){this.closeExtra();let r=this.top;r.match&&(r.match=r.match.matchType(t.type));let s=B.none;for(let a of i.concat(t.marks))(r.type?r.type.allowsMarkType(a.type):ds(a.type,t.type))&&(s=a.addToSet(s));return r.content.push(t.mark(s)),!0}return!1}enter(t,e,n,i){let r=this.findPlace(t.create(e),n,!1);return r&&(r=this.enterInner(t,e,n,!0,i)),r}enterInner(t,e,n,i=!1,r){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(t);let a=as(t,r,s.options);s.options&wn&&s.content.length==0&&(a|=wn);let l=B.none;return n=n.filter(c=>(s.type?s.type.allowsMarkType(c.type):ds(c.type,t))?(l=c.addToSet(l),!1):!0),this.nodes.push(new vn(t,e,l,i,null,a)),this.open++,n}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=Le)}return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let i=n.length-1;i>=0;i--)t+=n[i].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)&&e.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),r=-(n?n.depth+1:0)+(i?0:1),s=(a,l)=>{for(;a>=0;a--){let c=e[a];if(c==""){if(a==e.length-1||a==0)continue;for(;l>=r;l--)if(s(a-1,l))return!0;return!1}else{let d=l>0||l==0&&i?this.nodes[l].type:n&&l>=r?n.node(l-r).type:null;if(!d||d.name!=c&&!d.isInGroup(c))return!1;l--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let n=this.parser.schema.nodes[e];if(n.isTextblock&&n.defaultAttrs)return n}}}function Mh(o){for(let t=o.firstChild,e=null;t;t=t.nextSibling){let n=t.nodeType==1?t.nodeName.toLowerCase():null;n&&ss.hasOwnProperty(n)&&e?(e.appendChild(t),t=e):n=="li"?e=t:n&&(e=null)}}function Oh(o,t){return(o.matches||o.msMatchesSelector||o.webkitMatchesSelector||o.mozMatchesSelector).call(o,t)}function cs(o){let t={};for(let e in o)t[e]=o[e];return t}function ds(o,t){let e=t.schema.nodes;for(let n in e){let i=e[n];if(!i.allowsMarkType(o))continue;let r=[],s=a=>{r.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:d}=a.edge(l);if(c==t||r.indexOf(d)<0&&s(d))return!0}};if(s(i.contentMatch))return!0}}class ve{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=io(e).createDocumentFragment());let i=n,r=[];return t.forEach(s=>{if(r.length||s.marks.length){let a=0,l=0;for(;a<r.length&&l<s.marks.length;){let c=s.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(r[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<r.length;)i=r.pop()[1];for(;l<s.marks.length;){let c=s.marks[l++],d=this.serializeMark(c,s.isInline,e);d&&(r.push([c,i]),i.appendChild(d.dom),i=d.contentDOM||d.dom)}}i.appendChild(this.serializeNodeInner(s,e))}),n}serializeNodeInner(t,e){let{dom:n,contentDOM:i}=kn(io(e),this.nodes[t.type.name](t),null,t.attrs);if(i){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,i)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let i=t.marks.length-1;i>=0;i--){let r=this.serializeMark(t.marks[i],t.isInline,e);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(t,e,n={}){let i=this.marks[t.type.name];return i&&kn(io(n),i(t,e),null,t.attrs)}static renderSpec(t,e,n=null,i){return kn(t,e,n,i)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new ve(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=hs(t.nodes);return e.text||(e.text=n=>n.text),e}static marksFromSchema(t){return hs(t.marks)}}function hs(o){let t={};for(let e in o){let n=o[e].spec.toDOM;n&&(t[e]=n)}return t}function io(o){return o.document||window.document}const us=new WeakMap;function Nh(o){let t=us.get(o);return t===void 0&&us.set(o,t=Dh(o)),t}function Dh(o){let t=null;function e(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")t||(t=[]),t.push(n);else for(let i=0;i<n.length;i++)e(n[i]);else for(let i in n)e(n[i])}return e(o),t}function kn(o,t,e,n){if(typeof t=="string")return{dom:o.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let i=t[0],r;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(r=Nh(n))&&r.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=i.indexOf(" ");s>0&&(e=i.slice(0,s),i=i.slice(s+1));let a,l=e?o.createElementNS(e,i):o.createElement(i),c=t[1],d=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){d=2;for(let h in c)if(c[h]!=null){let f=h.indexOf(" ");f>0?l.setAttributeNS(h.slice(0,f),h.slice(f+1),c[h]):l.setAttribute(h,c[h])}}for(let h=d;h<t.length;h++){let f=t[h];if(f===0){if(h<t.length-1||h>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:g,contentDOM:p}=kn(o,f,e,n);if(l.appendChild(g),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}class ps{constructor(t){vt(this,"nodeMappings");vt(this,"markMappings");vt(this,"unknownBlock");vt(this,"unknownLeaf");vt(this,"unknownMark");vt(this,"schema");const e=Ih(t);Th(e.nodes);const n={attrs:{unknownMarks:{default:null}},toDOM(){return["span",{"data-unknown-mark":!0}]}};e.marks!=null?e.marks.unknownMark=n:e.marks={unknownMark:n},e.nodes.unknownLeaf={inline:!0,attrs:{isAmgBlock:{default:!0},unknownBlock:{default:null}},group:"inline",toDOM(){return document.createTextNode("u{fffc}")}};const i=new kh(e),r=[],s=[];let a=null;for(const[l,c]of Object.entries(e.nodes)){const d=c.automerge;if(d!=null){if(d.unknownBlock){if(a!=null)throw new Error("only one node can be marked as unknownBlock");a=i.nodes[l]}if(d.block!=null)if(typeof d.block=="string"){const h={blockName:d.block,outer:null,content:i.nodes[l],isEmbed:d.isEmbed||!1};d.attrParsers!=null&&(h.attrParsers=d.attrParsers),r.push(h)}else for(const[h,f]of Object.entries(d.block.within)){if(i.nodes[h]==null)throw new Error(`${c.name} references an unknown outer node
  ${h} in its within block mapping`);r.push({blockName:f,outer:i.nodes[h],content:i.nodes[l]})}}}for(const[l,c]of Object.entries(e.marks||{})){const d=c.automerge;if(d!=null&&d.markName!=null){let h;d.parsers!=null?h=d.parsers:h={fromAutomerge:()=>({}),fromProsemirror:()=>!0},s.push({automergeMarkName:d.markName,prosemirrorMark:i.marks[l],parsers:h})}}if(a==null)throw new Error(`no unknown block specified: one node must be marked as the unknownblock
by setting the automerge.unknownBlock property to true`);this.unknownMark=i.marks.unknownMark,this.nodeMappings=r,this.markMappings=s,this.unknownLeaf=i.nodes.unknownLeaf,this.unknownBlock=a,this.schema=i}}function Ih(o){const t={};for(const[n,i]of Object.entries(o.nodes)){const r=Object.assign({},i);i.attrs!=null&&(r.attrs=Object.assign({},i.attrs)),t[n]=r}const e={};if(o.marks!=null)for(const[n,i]of Object.entries(o.marks)){const r=Object.assign({},i);i.attrs!=null&&(r.attrs=Object.assign({},i.attrs)),e[n]=r}return{nodes:t,marks:e}}function Th(o){var t;for(const[e,n]of Object.entries(o))e!=="text"&&(n.attrs==null?n.attrs={isAmgBlock:{default:!1},unknownAttrs:{default:null}}:(n.attrs.isAmgBlock={default:!1},n.attrs.unknownAttrs={default:null})),(t=n.automerge)!=null&&t.unknownBlock&&(n.attrs==null?n.attrs={unknownParentBlock:{default:null},unknownBlock:{default:null}}:(n.attrs.unknownParentBlock={default:null},n.attrs.unknownBlock={default:null}));return o}function fs(o,t){const e={};return t.forEach(n=>{const i=o.markMappings.find(r=>r.prosemirrorMark===n.type);if(i!=null)e[i.automergeMarkName]=i.parsers.fromProsemirror(n);else if(n.type===o.unknownMark)for(const[r,s]of Object.entries(n.attrs.unknownMarks))e[r]=s}),e}function ro(o,t){const e={};let n=!1;const i=[];for(const[r,s]of Object.entries(t)){if(s==null)continue;const a=o.markMappings.find(l=>l.automergeMarkName===r);a==null?(e[r]=s,n=!0):i.push(a.prosemirrorMark.create(a.parsers.fromAutomerge(s)))}return n&&i.push(o.unknownMark.create({unknownMarks:e})),i}const Ah=["p",0],Eh=["blockquote",0],Bh=["hr"],Rh=["pre",["code",0]],Ph=["em",0],zh=["strong",0],Fh=["code",0],$h=["ol",0],Vh=["ul",0],Lh=["li",0],jh={nodes:{doc:{content:"block+"},paragraph:{automerge:{block:"paragraph"},content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return Ah}},unknownBlock:{automerge:{unknownBlock:!0},group:"block",content:"block+",parseDOM:[{tag:"div",attrs:{"data-unknown-block":"true"}}],toDOM(){return["div",{"data-unknown-block":"true"},0]}},blockquote:{automerge:{block:"blockquote"},content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM(){return Eh}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return Bh}},heading:{automerge:{block:"heading",attrParsers:{fromAutomerge:o=>({level:o.attrs.level}),fromProsemirror:o=>({level:o.attrs.level})}},attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level,0]}},code_block:{automerge:{block:"code-block"},content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return Rh}},text:{group:"inline"},image:{automerge:{block:"image",isEmbed:!0,attrParsers:{fromAutomerge:o=>{var t;return{src:((t=o.attrs.src)==null?void 0:t.toString())||null,alt:o.attrs.alt,title:o.attrs.title}},fromProsemirror:o=>({src:new $t(o.attrs.src),alt:o.attrs.alt,title:o.attrs.title})}},inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(o){return{src:o.getAttribute("src"),title:o.getAttribute("title"),alt:o.getAttribute("alt")}}}],toDOM(o){const{src:t,alt:e,title:n}=o.attrs;return["img",{src:t,alt:e,title:n}]}},ordered_list:{group:"block",content:"list_item+",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs(o){return{order:o.hasAttribute("start")?+o.getAttribute("start"):1}}}],toDOM(o){return o.attrs.order==1?$h:["ol",{start:o.attrs.order},0]}},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM(){return Vh}},list_item:{automerge:{block:{within:{ordered_list:"ordered-list-item",bullet_list:"unordered-list-item"}}},content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM(){return Lh},defining:!0},aside:{automerge:{block:"aside"},content:"block+",group:"block",defining:!0,parseDOM:[{tag:"aside"}],toDOM(){return["aside",0]}}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(o){return{href:o.getAttribute("href"),title:o.getAttribute("title")}}}],toDOM(o){const{href:t,title:e}=o.attrs;return["a",{href:t,title:e},0]},automerge:{markName:"link",parsers:{fromAutomerge:o=>{if(typeof o=="string")try{const t=JSON.parse(o);return{href:t.href||"",title:t.title||""}}catch{console.warn("failed to parse link mark as JSON")}return{href:"",title:""}},fromProsemirror:o=>JSON.stringify({href:o.attrs.href,title:o.attrs.title})}}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:o=>o.type.name=="em"}],toDOM(){return Ph},automerge:{markName:"em"}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:o=>o.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:o=>o.type.name=="strong"},{style:"font-weight",getAttrs:o=>/^(bold(er)?|[5-9]\d{2,})$/.test(o)&&null}],toDOM(){return zh},automerge:{markName:"strong"}},code:{parseDOM:[{tag:"code"}],toDOM(){return Fh}}}},Wh=new ps(jh);function Jh(o){const{type:t,parents:e,attrs:n,isEmbed:i}=o;let r;t instanceof $t?r=t:r=new $t("paragraph");const s={};if(n&&typeof n=="object")for(const[l,c]of Object.entries(n))s[l]=c;let a;return qh(e)?a=e:a=[],{type:r,parents:a,attrs:s,isEmbed:!!i}}function qh(o){if(!Array.isArray(o))return!1;for(const t of o)if(!(t instanceof $t))return!1;return!0}function Hh(o){return o.type==="text"?{type:"text",value:o.value,marks:o.marks}:{type:"block",value:Jh(o.value)}}function so(o,t){const e=co(o,t),n=[{tag:"doc",attrs:{},children:[]}];let i=null;for(const r of e){if(r.type==="openTag"){const s=Object.assign({},i,r.attrs);n.push({tag:r.tag,attrs:s,children:[]})}else if(r.type==="closeTag"){const{children:s,attrs:a,tag:l}=n.pop(),c=ao(o.schema,l,a,s);n[n.length-1].children.push(c)}else if(r.type==="leafNode")n[n.length-1].children.push(ao(o.schema,r.tag,i||{},[]));else if(r.type==="text"){const s=ro(o,r.marks);n[n.length-1].children.push(o.schema.text(r.text,s))}r.type==="block"?(i={isAmgBlock:!0,...r.block.attrs},r.isUnknown&&(i.unknownBlock=r.block)):i=null}if(n.length!==1)throw new Error("Invalid stack length");{const{children:r,attrs:s,tag:a}=n[0];return ao(o.schema,a,s,r)}}function ao(o,t,e,n){var a,l,c;const i={},r={};let s=!1;for(const d of Object.keys(e)){if(d==="isAmgBlock"||d==="unknownBlock"||d==="unknownAttrs"){i[d]=e[d];continue}((c=(l=(a=o.nodes[t])==null?void 0:a.spec)==null?void 0:l.attrs)==null?void 0:c[d])!=null?i[d]=e[d]:(s=!0,r[d]=e[d])}return s&&(i.unknownAttrs=r),o.node(t,i,n)}function xn(o,t,e){const n=gs(co(o,t));let i=null;for(const r of n){if(r.before.amIdx>=e&&i!=null)return i;if(r.event.type==="openTag")o.schema.nodes[r.event.tag].isTextblock&&(i=r.after.pmIdx);else if(r.event.type==="leafNode")i=r.after.pmIdx;else if(r.event.type==="text"&&(i=r.after.pmIdx,r.after.amIdx>=e&&r.before.amIdx+r.event.text.length>=e)){const s=e-r.before.amIdx;return r.before.pmIdx+s-1}}return i}function*gs(o){let t=0,e=-1;for(;;){const n=o.next();if(n.done)return;const i=n.value,r={amIdx:e,pmIdx:t};i.type==="openTag"&&i.tag!=="doc"||i.type==="closeTag"&&i.tag!=="doc"||i.type==="leafNode"?t+=1:i.type==="text"?(e+=i.text.length,t+=i.text.length):i.type==="block"&&(e+=1),yield{event:i,before:r,after:{amIdx:e,pmIdx:t}}}}function*Uh(o,t){const e=[{node:t,parent:null,indexInParent:0,numChildrenInParent:t.childCount,type:"node"}],n=[];for(;e.length>0;){const i=e.pop();if(i==null)return;if(i.type==="node"){const r=i.node;if(r.isText){const s=fs(o,r.marks);yield{type:"text",text:r.text,marks:s}}else{const s=Kh(o,r,n,i.indexInParent,i.numChildrenInParent),a=s!=null?"explicit":"render-only";if(s!=null){const{block:l,isUnknown:c}=s;yield{type:"block",isUnknown:c,block:l}}if(r.isLeaf)yield{type:"leafNode",tag:r.type.name,role:a};else{yield{type:"openTag",tag:r.type.name,role:a},n.push(r),e.push({type:"closeTag",tag:r.type.name,role:a});for(let l=r.childCount-1;l>=0;l--)e.push({parent:r,indexInParent:l,numChildrenInParent:r.childCount,type:"node",node:r.child(l)})}}}else i.type==="closeTag"&&n.pop(),yield i}}function Kh(o,t,e,n,i){var a;if(t.attrs.unknownBlock!=null)return{isUnknown:!0,block:t.attrs.unknownBlock};const r=ms(o,t,e);if(r==null){if(t.attrs.isAmgBlock)throw new Error("no mapping found for node which is marked as a block");return null}const s=((a=r.attrParsers)==null?void 0:a.fromProsemirror(t))||{};if(t.attrs.unknownAttrs!=null)for(const l of Object.keys(t.attrs.unknownAttrs))s[l]=t.attrs.unknownAttrs[l];if(t.attrs.isAmgBlock)return{isUnknown:!1,block:{type:r.blockName,parents:lo(o,e),attrs:s,isEmbed:r.isEmbed||!1}};if(r&&r.isEmbed)return{isUnknown:!1,block:{type:r.blockName,parents:lo(o,e),attrs:s,isEmbed:!0}};{const l=Xh(t);if(l!=null){const d=r.content.contentMatch.fillBefore(x.from([l.first]),!0);if(d==null)throw new Error("schema could not find wrapping");if(d.eq(l.contentBeforeFirst))return null}let c=!1;if(t.isTextblock){const d=e[e.length-1];d==null||d.type===o.schema.nodes.doc&&i>1?c=!0:d.type.contentMatch.defaultType===t.type&&n===0&&!t.attrs.isAmgBlock||(c=!0)}else Gh(t)&&(c=!0);return c?{isUnknown:r.content===o.unknownBlock,block:{type:r.blockName,parents:lo(o,e),attrs:s,isEmbed:r.isEmbed||!1}}:null}}function Gh(o){for(let t=0;t<o.childCount;t++)if(o.child(t).isTextblock)return!0;return!1}function Xh(o){let t=0,e=null;const n=[];for(let i=0;i<o.childCount;i++){const r=o.child(i);let s=!1;if(r.attrs.isAmgBlock?s=!0:r.descendants(a=>a.attrs.isAmgBlock?(s=!0,!1):!0),s&&(t++,e==null&&(e=r)),e==null&&n.push(r),t>1)break}return t>0?{contentBeforeFirst:x.from(n),first:e}:null}function ms(o,t,e){if(t.type===o.unknownBlock&&t.attrs.unknownParentBlock)return{blockName:t.attrs.unknownParentBlock,content:t.type,outer:null,isEmbed:!1};const n=o.nodeMappings.filter(s=>s.content===t.type);if(n.length===0)return null;const i=e[e.length-1];let r=n[0];for(const s of n)if(i!=null&&s.outer===i.type){r=s;break}return r}function lo(o,t){const e=[];for(const[n,i]of t.entries()){if(n===t.length-1&&i.isTextblock&&!i.attrs.isAmgBlock)continue;const r=ms(o,i,t.slice(0,n));r!=null&&e.push(r.blockName)}return e}function*co(o,t){const e=t.map(Hh);if(e.length===0)return yield*[{type:"openTag",tag:"paragraph",role:"render-only"},{type:"closeTag",tag:"paragraph",role:"render-only"}];const n=new Qh(o);for(const i of e)i.type==="block"?yield*n.newBlock(i.value):yield*n.newText(i.value,i.marks||{});yield*n.finish()}class Qh{constructor(t){vt(this,"adapter");vt(this,"lastBlock",null);vt(this,"stack",[]);vt(this,"topMatch");this.adapter=t,this.stack=[],this.topMatch=this.adapter.schema.nodes.doc.contentMatch}set currentMatch(t){if(t===null)throw new Error("Match cannot be null");this.stack.length>0?this.stack[this.stack.length-1].lastMatch=t:this.topMatch=t}get currentMatch(){return this.stack.length>0?this.stack[this.stack.length-1].lastMatch:this.topMatch}*newBlock(t){if(t.isEmbed){const{content:s}=Sn(this.adapter,t.type.val,t.isEmbed),a=this.currentMatch.findWrapping(s);if(a)for(let l=0;l<a.length;l++)yield this.pushNode(a[l],null,"render-only");this.currentMatch=this.currentMatch.matchType(s),yield bs(this.adapter,t),yield{type:"leafNode",tag:s.name,role:"explicit"};return}const e=Yh(this.adapter,t);let n=0;for(;n<e.length&&n<this.stack.length&&this.stack[n].node===e[n].type;)n++;const i=this.stack.splice(n);for(const{node:s,role:a,lastMatch:l}of i.toReversed())yield*this.finishStackFrame({node:s,role:a,lastMatch:l}),yield{type:"closeTag",tag:s.name,role:a};for(let s=n;s<e.length;s++){const{type:a,attrs:l}=e[s];yield*this.fillBefore(a),yield this.pushNode(a,l,"render-only")}yield bs(this.adapter,t);const{content:r}=Sn(this.adapter,t.type.val,t.isEmbed||!1);yield this.pushNode(r,null,"explicit")}pushNode(t,e,n){return this.currentMatch=this.currentMatch.matchType(t),this.stack.push({node:t,role:n,lastMatch:t.contentMatch}),{type:"openTag",tag:t.name,role:n,...e&&{attrs:e}}}*newText(t,e){const n=this.currentMatch.findWrapping(this.adapter.schema.nodes.text);if(n)for(let i=0;i<n.length;i++)yield this.pushNode(n[i],null,"render-only");this.currentMatch=this.currentMatch.matchType(this.adapter.schema.nodes.text),yield{type:"text",text:t,marks:e}}*finish(){for(const{node:t,role:e,lastMatch:n}of this.stack.toReversed())yield*this.finishStackFrame({node:t,role:e,lastMatch:n}),yield{type:"closeTag",tag:t.name,role:e}}*fillBefore(t){const e=this.currentMatch.fillBefore(x.from(t.create()));e!=null&&(yield*this.emitFragment(e),this.currentMatch=this.currentMatch.matchFragment(e))}*emitFragment(t){const e=[];for(let n=t.childCount-1;n>=0;n--)e.push({type:"open",node:t.child(n)});for(;e.length>0;){const n=e.pop();if(n==null)return;if(n.type==="open")if(yield{type:"openTag",tag:n.node.type.name,role:"render-only"},n.node.isText)yield{type:"text",text:n.node.text,marks:{}},yield{type:"closeTag",tag:n.node.type.name,role:"render-only"};else{e.push({type:"close",node:n.node.type});for(let i=n.node.childCount-1;i>=0;i--)e.push({type:"open",node:n.node.child(i)})}else yield{type:"closeTag",tag:n.node.name,role:"render-only"}}}*finishStackFrame(t){const e=t.lastMatch.fillBefore(x.empty,!0);e&&(yield*this.emitFragment(e))}}function Yh(o,t){const e=[];for(const i of t.parents){const{outer:r,content:s,attrs:a}=Sn(o,i.val,!1);r!=null&&e.push({type:r,attrs:null}),e.push({type:s,attrs:a||null})}const{outer:n}=Sn(o,t.type.val,t.isEmbed||!1);return n!=null&&e.push({type:n,attrs:null}),e}function bs(o,t){const e=o.nodeMappings.find(i=>i.blockName===t.type.val),n={...t.attrs};for(const[i,r]of Object.entries(n))r instanceof $t&&(n[i]=r.val);return{type:"block",isUnknown:e==null,block:{attrs:n,parents:t.parents.map(i=>i.val),type:t.type.val,isEmbed:t.isEmbed||!1}}}function ho(o,t,{from:e,to:n}){const i=gs(co(o,t));let r=null,s=null,a=null,l=null;for(e===0&&(r=0);a==null||a<=n||r==null||s==null;){const c=i.next();if(c.done)break;const d=c.value;if(a=d.after.pmIdx,l=d.after.amIdx,r==null){if(d.after.pmIdx<e)continue;if(d.event.type==="text")if(d.before.pmIdx>e)r=Math.max(d.before.amIdx,0)+1;else if(d.before.pmIdx+d.event.text.length>e){const h=e-d.before.pmIdx;r=d.before.amIdx+h+1}else r=Math.max(d.after.amIdx,0)+1;else d.after.pmIdx>=e&&(r=d.after.amIdx+1)}if(s==null){if(d.after.pmIdx<n)continue;if(d.event.type==="text"){if(d.before.pmIdx>=n)s=d.before.amIdx+1;else if(d.before.pmIdx+d.event.text.length>n){const h=n-d.before.pmIdx;s=d.before.amIdx+h+1}}else d.before.pmIdx>=n&&(s=d.before.amIdx+1)}}if(r!=null)return s==null&&(s=l?l+1:r),{start:r,end:s};{const c=l?l+1:0;return{start:c,end:c}}}function _s(o,t){const e=Uh(o,t),n=[];for(const i of e)if(i.type=="block"){const r={...i.block.attrs};delete r.isAmgBlock,n.push({type:"block",value:{type:new $t(i.block.type),parents:i.block.parents.map(s=>new $t(s)),attrs:r,isEmbed:i.block.isEmbed}})}else i.type=="text"&&n.push({type:"text",value:i.text,marks:i.marks});return n}function Sn(o,t,e){const n=o.nodeMappings.find(i=>i.blockName===t);return n==null?e?{outer:null,content:o.unknownLeaf}:{outer:null,content:o.unknownBlock,attrs:{unknownParentBlock:t}}:{outer:n.outer,content:n.content}}const ys=65535,ws=Math.pow(2,16);function Zh(o,t){return o+t*ws}function vs(o){return o&ys}function tu(o){return(o-(o&ys))/ws}const ks=1,xs=2,Cn=4,Ss=8;class uo{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(this.delInfo&Ss)>0}get deletedBefore(){return(this.delInfo&(ks|Cn))>0}get deletedAfter(){return(this.delInfo&(xs|Cn))>0}get deletedAcross(){return(this.delInfo&Cn)>0}}class it{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&it.empty)return it.empty}recover(t){let e=0,n=vs(t);if(!this.inverted)for(let i=0;i<n;i++)e+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+e+tu(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let i=0,r=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>t)break;let c=this.ranges[a+r],d=this.ranges[a+s],h=l+c;if(t<=h){let f=c?t==l?-1:t==h?1:e:e,g=l+i+(f<0?0:d);if(n)return g;let p=t==(e<0?l:h)?null:Zh(a/3,t-l),b=t==l?xs:t==h?ks:Cn;return(e<0?t!=l:t!=h)&&(b|=Ss),new uo(g,b,p)}i+=d-c}return n?t+i:new uo(t+i,0,null)}touches(t,e){let n=0,i=vs(e),r=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>t)break;let c=this.ranges[a+r],d=l+c;if(t<=d&&a==i*3)return!0;n+=this.ranges[a+s]-c}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,r=0;i<this.ranges.length;i+=3){let s=this.ranges[i],a=s-(this.inverted?r:0),l=s+(this.inverted?0:r),c=this.ranges[i+e],d=this.ranges[i+n];t(a,a+c,l,l+d),r+=d-c}}invert(){return new it(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?it.empty:new it(t<0?[0,-t,0]:[0,0,t])}}it.empty=new it([]);class Mn{constructor(t,e,n=0,i=t?t.length:0){this.mirror=e,this.from=n,this.to=i,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new Mn(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),e!=null&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,n=this._maps.length;e<t._maps.length;e++){let i=t.getMirror(e);this.appendMap(t._maps[e],i!=null&&i<e?n+i:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,n=this._maps.length+t._maps.length;e>=0;e--){let i=t.getMirror(e);this.appendMap(t._maps[e].invert(),i!=null&&i>e?n-i-1:void 0)}}invert(){let t=new Mn;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let n=this.from;n<this.to;n++)t=this._maps[n].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,n){let i=0;for(let r=this.from;r<this.to;r++){let s=this._maps[r],a=s.mapResult(t,e);if(a.recover!=null){let l=this.getMirror(r);if(l!=null&&l>r&&l<this.to){r=l,t=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,t=a.pos}return n?t:new uo(t,i,null)}}const po=Object.create(null);class G{getMap(){return it.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=po[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in po)throw new RangeError("Duplicate use of step JSON ID "+t);return po[t]=e,e.prototype.jsonID=t,e}}class j{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new j(t,null)}static fail(t){return new j(null,t)}static fromReplace(t,e,n,i){try{return j.ok(t.replace(e,n,i))}catch(r){if(r instanceof mn)return j.fail(r.message);throw r}}}function fo(o,t,e){let n=[];for(let i=0;i<o.childCount;i++){let r=o.child(i);r.content.size&&(r=r.copy(fo(r.content,t,r))),r.isInline&&(r=t(r,e,i)),n.push(r)}return x.fromArray(n)}class Lt extends G{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),i=n.node(n.sharedDepth(this.to)),r=new M(fo(e.content,(s,a)=>!s.isAtom||!a.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),e.openStart,e.openEnd);return j.fromReplace(t,this.from,this.to,r)}invert(){return new Ct(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new Lt(e.pos,n.pos,this.mark)}merge(t){return t instanceof Lt&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Lt(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Lt(e.from,e.to,t.markFromJSON(e.mark))}}G.jsonID("addMark",Lt);class Ct extends G{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new M(fo(e.content,i=>i.mark(this.mark.removeFromSet(i.marks)),t),e.openStart,e.openEnd);return j.fromReplace(t,this.from,this.to,n)}invert(){return new Lt(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new Ct(e.pos,n.pos,this.mark)}merge(t){return t instanceof Ct&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Ct(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ct(e.from,e.to,t.markFromJSON(e.mark))}}G.jsonID("removeMark",Ct);class jt extends G{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return j.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return j.fromReplace(t,this.pos,this.pos+1,new M(x.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let n=this.mark.addToSet(e.marks);if(n.length==e.marks.length){for(let i=0;i<e.marks.length;i++)if(!e.marks[i].isInSet(n))return new jt(this.pos,e.marks[i]);return new jt(this.pos,this.mark)}}return new le(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new jt(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new jt(e.pos,t.markFromJSON(e.mark))}}G.jsonID("addNodeMark",jt);class le extends G{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return j.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return j.fromReplace(t,this.pos,this.pos+1,new M(x.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new jt(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new le(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new le(e.pos,t.markFromJSON(e.mark))}}G.jsonID("removeNodeMark",le);class H extends G{constructor(t,e,n,i=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=i}apply(t){return this.structure&&go(t,this.from,this.to)?j.fail("Structure replace would overwrite content"):j.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new it([this.from,this.to-this.from,this.slice.size])}invert(t){return new H(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new H(e.pos,Math.max(e.pos,n.pos),this.slice,this.structure)}merge(t){if(!(t instanceof H)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?M.empty:new M(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new H(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?M.empty:new M(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new H(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new H(e.from,e.to,M.fromJSON(t,e.slice),!!e.structure)}}G.jsonID("replace",H);class rt extends G{constructor(t,e,n,i,r,s,a=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=i,this.slice=r,this.insert=s,this.structure=a}apply(t){if(this.structure&&(go(t,this.from,this.gapFrom)||go(t,this.gapTo,this.to)))return j.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return j.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?j.fromReplace(t,this.from,this.to,n):j.fail("Content does not fit in gap")}getMap(){return new it([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new rt(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),i=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),r=this.to==this.gapTo?n.pos:t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||i<e.pos||r>n.pos?null:new rt(e.pos,n.pos,i,r,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new rt(e.from,e.to,e.gapFrom,e.gapTo,M.fromJSON(t,e.slice),e.insert,!!e.structure)}}G.jsonID("replaceAround",rt);function go(o,t,e){let n=o.resolve(t),i=e-t,r=n.depth;for(;i>0&&r>0&&n.indexAfter(r)==n.node(r).childCount;)r--,i--;if(i>0){let s=n.node(r).maybeChild(n.indexAfter(r));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}function eu(o,t,e,n){let i=[],r=[],s,a;o.doc.nodesBetween(t,e,(l,c,d)=>{if(!l.isInline)return;let h=l.marks;if(!n.isInSet(h)&&d.type.allowsMarkType(n.type)){let f=Math.max(c,t),g=Math.min(c+l.nodeSize,e),p=n.addToSet(h);for(let b=0;b<h.length;b++)h[b].isInSet(p)||(s&&s.to==f&&s.mark.eq(h[b])?s.to=g:i.push(s=new Ct(f,g,h[b])));a&&a.to==f?a.to=g:r.push(a=new Lt(f,g,n))}}),i.forEach(l=>o.step(l)),r.forEach(l=>o.step(l))}function nu(o,t,e,n){let i=[],r=0;o.doc.nodesBetween(t,e,(s,a)=>{if(!s.isInline)return;r++;let l=null;if(n instanceof yn){let c=s.marks,d;for(;d=n.isInSet(c);)(l||(l=[])).push(d),c=d.removeFromSet(c)}else n?n.isInSet(s.marks)&&(l=[n]):l=s.marks;if(l&&l.length){let c=Math.min(a+s.nodeSize,e);for(let d=0;d<l.length;d++){let h=l[d],f;for(let g=0;g<i.length;g++){let p=i[g];p.step==r-1&&h.eq(i[g].style)&&(f=p)}f?(f.to=c,f.step=r):i.push({style:h,from:Math.max(a,t),to:c,step:r})}}}),i.forEach(s=>o.step(new Ct(s.from,s.to,s.style)))}function mo(o,t,e,n=e.contentMatch,i=!0){let r=o.doc.nodeAt(t),s=[],a=t+1;for(let l=0;l<r.childCount;l++){let c=r.child(l),d=a+c.nodeSize,h=n.matchType(c.type);if(!h)s.push(new H(a,d,M.empty));else{n=h;for(let f=0;f<c.marks.length;f++)e.allowsMarkType(c.marks[f].type)||o.step(new Ct(a,d,c.marks[f]));if(i&&c.isText&&e.whitespace!="pre"){let f,g=/\r?\n|\r/g,p;for(;f=g.exec(c.text);)p||(p=new M(x.from(e.schema.text(" ",e.allowedMarks(c.marks))),0,0)),s.push(new H(a+f.index,a+f.index+f[0].length,p))}}a=d}if(!n.validEnd){let l=n.fillBefore(x.empty,!0);o.replace(a,a,new M(l,0,0))}for(let l=s.length-1;l>=0;l--)o.step(s[l])}function ou(o,t,e){return(t==0||o.canReplace(t,o.childCount))&&(e==o.childCount||o.canReplace(0,e))}function bo(o){let t=o.parent.content.cutByIndex(o.startIndex,o.endIndex);for(let e=o.depth;;--e){let n=o.$from.node(e),i=o.$from.index(e),r=o.$to.indexAfter(e);if(e<o.depth&&n.canReplace(i,r,t))return e;if(e==0||n.type.spec.isolating||!ou(n,i,r))break}return null}function iu(o,t,e){let{$from:n,$to:i,depth:r}=t,s=n.before(r+1),a=i.after(r+1),l=s,c=a,d=x.empty,h=0;for(let p=r,b=!1;p>e;p--)b||n.index(p)>0?(b=!0,d=x.from(n.node(p).copy(d)),h++):l--;let f=x.empty,g=0;for(let p=r,b=!1;p>e;p--)b||i.after(p+1)<i.end(p)?(b=!0,f=x.from(i.node(p).copy(f)),g++):c++;o.step(new rt(l,c,s,a,new M(d.append(f),h,g),d.size-h,!0))}function ru(o,t,e){let n=x.empty;for(let s=e.length-1;s>=0;s--){if(n.size){let a=e[s].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=x.from(e[s].type.create(e[s].attrs,n))}let i=t.start,r=t.end;o.step(new rt(i,r,i,r,new M(n,0,0),e.length,!0))}function su(o,t,e,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let r=o.steps.length;o.doc.nodesBetween(t,e,(s,a)=>{let l=typeof i=="function"?i(s):i;if(s.isTextblock&&!s.hasMarkup(n,l)&&au(o.doc,o.mapping.slice(r).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let g=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);g&&!p?c=!1:!g&&p&&(c=!0)}c===!1&&Ms(o,s,a,r),mo(o,o.mapping.slice(r).map(a,1),n,void 0,c===null);let d=o.mapping.slice(r),h=d.map(a,1),f=d.map(a+s.nodeSize,1);return o.step(new rt(h,f,h+1,f-1,new M(x.from(n.create(l,null,s.marks)),0,0),1,!0)),c===!0&&Cs(o,s,a,r),!1}})}function Cs(o,t,e,n){t.forEach((i,r)=>{if(i.isText){let s,a=/\r?\n|\r/g;for(;s=a.exec(i.text);){let l=o.mapping.slice(n).map(e+1+r+s.index);o.replaceWith(l,l+1,t.type.schema.linebreakReplacement.create())}}})}function Ms(o,t,e,n){t.forEach((i,r)=>{if(i.type==i.type.schema.linebreakReplacement){let s=o.mapping.slice(n).map(e+1+r);o.replaceWith(s,s+1,t.type.schema.text(`
`))}})}function au(o,t,e){let n=o.resolve(t),i=n.index();return n.parent.canReplaceWith(i,i+1,e)}function lu(o,t,e,n,i){let r=o.doc.nodeAt(t);if(!r)throw new RangeError("No node at given position");e||(e=r.type);let s=e.create(n,null,i||r.marks);if(r.isLeaf)return o.replaceWith(t,t+r.nodeSize,s);if(!e.validContent(r.content))throw new RangeError("Invalid content for node type "+e.name);o.step(new rt(t,t+r.nodeSize,t+1,t+r.nodeSize-1,new M(x.from(s),0,0),1,!0))}function On(o,t,e=1,n){let i=o.resolve(t),r=i.depth-e,s=n&&n[n.length-1]||i.parent;if(r<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,d=e-2;c>r;c--,d--){let h=i.node(c),f=i.index(c);if(h.type.spec.isolating)return!1;let g=h.content.cutByIndex(f,h.childCount),p=n&&n[d+1];p&&(g=g.replaceChild(0,p.type.create(p.attrs)));let b=n&&n[d]||h;if(!h.canReplace(f+1,h.childCount)||!b.type.validContent(g))return!1}let a=i.indexAfter(r),l=n&&n[0];return i.node(r).canReplaceWith(a,a,l?l.type:i.node(r+1).type)}function cu(o,t,e=1,n){let i=o.doc.resolve(t),r=x.empty,s=x.empty;for(let a=i.depth,l=i.depth-e,c=e-1;a>l;a--,c--){r=x.from(i.node(a).copy(r));let d=n&&n[c];s=x.from(d?d.type.create(d.attrs,s):i.node(a).copy(s))}o.step(new H(t,t,new M(r.append(s),e,e),!0))}function Os(o,t){let e=o.resolve(t),n=e.index();return hu(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(n,n+1)}function du(o,t){t.content.size||o.type.compatibleContent(t.type);let e=o.contentMatchAt(o.childCount),{linebreakReplacement:n}=o.type.schema;for(let i=0;i<t.childCount;i++){let r=t.child(i),s=r.type==n?o.type.schema.nodes.text:r.type;if(e=e.matchType(s),!e||!o.type.allowsMarks(r.marks))return!1}return e.validEnd}function hu(o,t){return!!(o&&t&&!o.isLeaf&&du(o,t))}function uu(o,t,e){let n=null,{linebreakReplacement:i}=o.doc.type.schema,r=o.doc.resolve(t-e),s=r.node().type;if(i&&s.inlineContent){let d=s.whitespace=="pre",h=!!s.contentMatch.matchType(i);d&&!h?n=!1:!d&&h&&(n=!0)}let a=o.steps.length;if(n===!1){let d=o.doc.resolve(t+e);Ms(o,d.node(),d.before(),a)}s.inlineContent&&mo(o,t+e-1,s,r.node().contentMatchAt(r.index()),n==null);let l=o.mapping.slice(a),c=l.map(t-e);if(o.step(new H(c,l.map(t+e,-1),M.empty,!0)),n===!0){let d=o.doc.resolve(c);Cs(o,d.node(),d.before(),o.steps.length)}return o}function pu(o,t,e){let n=o.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),e))return t;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let r=n.index(i);if(n.node(i).canReplaceWith(r,r,e))return n.before(i+1);if(r>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let r=n.indexAfter(i);if(n.node(i).canReplaceWith(r,r,e))return n.after(i+1);if(r<n.node(i).childCount)return null}return null}function fu(o,t,e){let n=o.resolve(t);if(!e.content.size)return t;let i=e.content;for(let r=0;r<e.openStart;r++)i=i.firstChild.content;for(let r=1;r<=(e.openStart==0&&e.size?2:1);r++)for(let s=n.depth;s>=0;s--){let a=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1,l=n.index(s)+(a>0?1:0),c=n.node(s),d=!1;if(r==1)d=c.canReplace(l,l,i);else{let h=c.contentMatchAt(l).findWrapping(i.firstChild.type);d=h&&c.canReplaceWith(l,l,h[0])}if(d)return a==0?n.pos:a<0?n.before(s+1):n.after(s+1)}return null}function _o(o,t,e=t,n=M.empty){if(t==e&&!n.size)return null;let i=o.resolve(t),r=o.resolve(e);return Ns(i,r,n)?new H(t,e,n):new gu(i,r,n).fit()}function Ns(o,t,e){return!e.openStart&&!e.openEnd&&o.start()==t.start()&&o.parent.canReplace(o.index(),t.index(),e.content)}class gu{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=x.empty;for(let i=0;i<=t.depth;i++){let r=t.node(i);this.frontier.push({type:r.type,match:r.contentMatchAt(t.indexAfter(i))})}for(let i=t.depth;i>0;i--)this.placed=x.from(t.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(t<0?this.$to:n.doc.resolve(t));if(!i)return null;let r=this.placed,s=n.depth,a=i.depth;for(;s&&a&&r.childCount==1;)r=r.firstChild.content,s--,a--;let l=new M(r,s,a);return t>-1?new rt(n.pos,t,this.$to.pos,this.$to.end(),l,e):l.size||n.pos!=this.$to.pos?new H(n.pos,i.pos,l):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<t;n++){let r=e.firstChild;if(e.childCount>1&&(i=0),r.type.spec.isolating&&i<=n){t=n;break}e=r.content}for(let e=1;e<=2;e++)for(let n=e==1?t:this.unplaced.openStart;n>=0;n--){let i,r=null;n?(r=yo(this.unplaced.content,n-1).firstChild,i=r.content):i=this.unplaced.content;let s=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],d,h=null;if(e==1&&(s?c.matchType(s.type)||(h=c.fillBefore(x.from(s),!1)):r&&l.compatibleContent(r.type)))return{sliceDepth:n,frontierDepth:a,parent:r,inject:h};if(e==2&&s&&(d=c.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:a,parent:r,wrap:d};if(r&&c.matchType(r.type))break}}}openMore(){let{content:t,openStart:e,openEnd:n}=this.unplaced,i=yo(t,e);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new M(t,e+1,Math.max(n,i.size+e>=t.size-n?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:n}=this.unplaced,i=yo(t,e);if(i.childCount<=1&&e>0){let r=t.size-e<=e+i.size;this.unplaced=new M(je(t,e-1,1),e-1,r?e-1:n)}else this.unplaced=new M(je(t,e,1),e,n)}placeNodes({sliceDepth:t,frontierDepth:e,parent:n,inject:i,wrap:r}){for(;this.depth>e;)this.closeFrontierNode();if(r)for(let b=0;b<r.length;b++)this.openFrontierNode(r[b]);let s=this.unplaced,a=n?n.content:s.content,l=s.openStart-t,c=0,d=[],{match:h,type:f}=this.frontier[e];if(i){for(let b=0;b<i.childCount;b++)d.push(i.child(b));h=h.matchFragment(i)}let g=a.size+t-(s.content.size-s.openEnd);for(;c<a.childCount;){let b=a.child(c),y=h.matchType(b.type);if(!y)break;c++,(c>1||l==0||b.content.size)&&(h=y,d.push(Ds(b.mark(f.allowedMarks(b.marks)),c==1?l:0,c==a.childCount?g:-1)))}let p=c==a.childCount;p||(g=-1),this.placed=We(this.placed,e,x.from(d)),this.frontier[e].match=h,p&&g<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let b=0,y=a;b<g;b++){let k=y.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),y=k.content}this.unplaced=p?t==0?M.empty:new M(je(s.content,t-1,1),t-1,g<0?s.openEnd:t-1):new M(je(s.content,t,c),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!wo(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:n,type:i}=this.frontier[e],r=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=wo(t,e,i,n,r);if(s){for(let a=e-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],d=wo(t,a,c,l,!0);if(!d||d.childCount)continue t}return{depth:e,fit:s,move:r?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=We(this.placed,e.depth,e.fit)),t=e.move;for(let n=e.depth+1;n<=t.depth;n++){let i=t.node(n),r=i.type.contentMatch.fillBefore(i.content,!0,t.index(n));this.openFrontierNode(i.type,i.attrs,r)}return t}openFrontierNode(t,e=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=We(this.placed,this.depth,x.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(x.empty,!0);t.childCount&&(this.placed=We(this.placed,this.frontier.length,t))}}function je(o,t,e){return t==0?o.cutByIndex(e,o.childCount):o.replaceChild(0,o.firstChild.copy(je(o.firstChild.content,t-1,e)))}function We(o,t,e){return t==0?o.append(e):o.replaceChild(o.childCount-1,o.lastChild.copy(We(o.lastChild.content,t-1,e)))}function yo(o,t){for(let e=0;e<t;e++)o=o.firstChild.content;return o}function Ds(o,t,e){if(t<=0)return o;let n=o.content;return t>1&&(n=n.replaceChild(0,Ds(n.firstChild,t-1,n.childCount==1?e-1:0))),t>0&&(n=o.type.contentMatch.fillBefore(n).append(n),e<=0&&(n=n.append(o.type.contentMatch.matchFragment(n).fillBefore(x.empty,!0)))),o.copy(n)}function wo(o,t,e,n,i){let r=o.node(t),s=i?o.indexAfter(t):o.index(t);if(s==r.childCount&&!e.compatibleContent(r.type))return null;let a=n.fillBefore(r.content,!0,s);return a&&!mu(e,r.content,s)?a:null}function mu(o,t,e){for(let n=e;n<t.childCount;n++)if(!o.allowsMarks(t.child(n).marks))return!0;return!1}function bu(o){return o.spec.defining||o.spec.definingForContent}function _u(o,t,e,n){if(!n.size)return o.deleteRange(t,e);let i=o.doc.resolve(t),r=o.doc.resolve(e);if(Ns(i,r,n))return o.step(new H(t,e,n));let s=Ts(i,o.doc.resolve(e));s[s.length-1]==0&&s.pop();let a=-(i.depth+1);s.unshift(a);for(let f=i.depth,g=i.pos-1;f>0;f--,g--){let p=i.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;s.indexOf(f)>-1?a=f:i.before(f)==g&&s.splice(1,0,-f)}let l=s.indexOf(a),c=[],d=n.openStart;for(let f=n.content,g=0;;g++){let p=f.firstChild;if(c.push(p),g==n.openStart)break;f=p.content}for(let f=d-1;f>=0;f--){let g=c[f],p=bu(g.type);if(p&&!g.sameMarkup(i.node(Math.abs(a)-1)))d=f;else if(p||!g.type.isTextblock)break}for(let f=n.openStart;f>=0;f--){let g=(f+d+1)%(n.openStart+1),p=c[g];if(p)for(let b=0;b<s.length;b++){let y=s[(b+l)%s.length],k=!0;y<0&&(k=!1,y=-y);let D=i.node(y-1),$=i.index(y-1);if(D.canReplaceWith($,$,p.type,p.marks))return o.replace(i.before(y),k?r.after(y):e,new M(Is(n.content,0,n.openStart,g),g,n.openEnd))}}let h=o.steps.length;for(let f=s.length-1;f>=0&&(o.replace(t,e,n),!(o.steps.length>h));f--){let g=s[f];g<0||(t=i.before(g),e=r.after(g))}}function Is(o,t,e,n,i){if(t<e){let r=o.firstChild;o=o.replaceChild(0,r.copy(Is(r.content,t+1,e,n,r)))}if(t>n){let r=i.contentMatchAt(0),s=r.fillBefore(o).append(o);o=s.append(r.matchFragment(s).fillBefore(x.empty,!0))}return o}function yu(o,t,e,n){if(!n.isInline&&t==e&&o.doc.resolve(t).parent.content.size){let i=pu(o.doc,t,n.type);i!=null&&(t=e=i)}o.replaceRange(t,e,new M(x.from(n),0,0))}function wu(o,t,e){let n=o.doc.resolve(t),i=o.doc.resolve(e),r=Ts(n,i);for(let s=0;s<r.length;s++){let a=r[s],l=s==r.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return o.delete(n.start(a),i.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),i.indexAfter(a-1))))return o.delete(n.before(a),i.after(a))}for(let s=1;s<=n.depth&&s<=i.depth;s++)if(t-n.start(s)==n.depth-s&&e>n.end(s)&&i.end(s)-e!=i.depth-s&&n.start(s-1)==i.start(s-1)&&n.node(s-1).canReplace(n.index(s-1),i.index(s-1)))return o.delete(n.before(s),e);o.delete(t,e)}function Ts(o,t){let e=[],n=Math.min(o.depth,t.depth);for(let i=n;i>=0;i--){let r=o.start(i);if(r<o.pos-(o.depth-i)||t.end(i)>t.pos+(t.depth-i)||o.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(r==t.start(i)||i==o.depth&&i==t.depth&&o.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==r-1)&&e.push(i)}return e}class ke extends G{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return j.fail("No node at attribute step's position");let n=Object.create(null);for(let r in e.attrs)n[r]=e.attrs[r];n[this.attr]=this.value;let i=e.type.create(n,null,e.marks);return j.fromReplace(t,this.pos,this.pos+1,new M(x.from(i),0,e.isLeaf?0:1))}getMap(){return it.empty}invert(t){return new ke(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new ke(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new ke(e.pos,e.attr,e.value)}}G.jsonID("attr",ke);class Je extends G{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let i in t.attrs)e[i]=t.attrs[i];e[this.attr]=this.value;let n=t.type.create(e,t.content,t.marks);return j.ok(n)}getMap(){return it.empty}invert(t){return new Je(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Je(e.attr,e.value)}}G.jsonID("docAttr",Je);let xe=class extends Error{};xe=function o(t){let e=Error.call(this,t);return e.__proto__=o.prototype,e},xe.prototype=Object.create(Error.prototype),xe.prototype.constructor=xe,xe.prototype.name="TransformError";class vu{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Mn}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new xe(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,n=M.empty){let i=_o(this.doc,t,e,n);return i&&this.step(i),this}replaceWith(t,e,n){return this.replace(t,e,new M(x.from(n),0,0))}delete(t,e){return this.replace(t,e,M.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,n){return _u(this,t,e,n),this}replaceRangeWith(t,e,n){return yu(this,t,e,n),this}deleteRange(t,e){return wu(this,t,e),this}lift(t,e){return iu(this,t,e),this}join(t,e=1){return uu(this,t,e),this}wrap(t,e){return ru(this,t,e),this}setBlockType(t,e=t,n,i=null){return su(this,t,e,n,i),this}setNodeMarkup(t,e,n=null,i){return lu(this,t,e,n,i),this}setNodeAttribute(t,e,n){return this.step(new ke(t,e,n)),this}setDocAttribute(t,e){return this.step(new Je(t,e)),this}addNodeMark(t,e){return this.step(new jt(t,e)),this}removeNodeMark(t,e){let n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(e instanceof B)e.isInSet(n.marks)&&this.step(new le(t,e));else{let i=n.marks,r,s=[];for(;r=e.isInSet(i);)s.push(new le(t,r)),i=r.removeFromSet(i);for(let a=s.length-1;a>=0;a--)this.step(s[a])}return this}split(t,e=1,n){return cu(this,t,e,n),this}addMark(t,e,n){return eu(this,t,e,n),this}removeMark(t,e,n){return nu(this,t,e,n),this}clearIncompatible(t,e,n){return mo(this,t,e,n),this}}const vo=Object.create(null);class E{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new ku(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=M.empty){let n=e.content.lastChild,i=null;for(let a=0;a<e.openEnd;a++)i=n,n=n.lastChild;let r=t.steps.length,s=this.ranges;for(let a=0;a<s.length;a++){let{$from:l,$to:c}=s[a],d=t.mapping.slice(r);t.replaceRange(d.map(l.pos),d.map(c.pos),a?M.empty:e),a==0&&Bs(t,r,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,i=this.ranges;for(let r=0;r<i.length;r++){let{$from:s,$to:a}=i[r],l=t.mapping.slice(n),c=l.map(s.pos),d=l.map(a.pos);r?t.deleteRange(c,d):(t.replaceRangeWith(c,d,e),Bs(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let i=t.parent.inlineContent?new z(t):Se(t.node(0),t.parent,t.pos,t.index(),e,n);if(i)return i;for(let r=t.depth-1;r>=0;r--){let s=e<0?Se(t.node(0),t.node(r),t.before(r+1),t.index(r),e,n):Se(t.node(0),t.node(r),t.after(r+1),t.index(r)+1,e,n);if(s)return s}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new st(t.node(0))}static atStart(t){return Se(t,t,0,0,1)||new st(t)}static atEnd(t){return Se(t,t,t.content.size,t.childCount,-1)||new st(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=vo[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in vo)throw new RangeError("Duplicate use of selection JSON ID "+t);return vo[t]=e,e.prototype.jsonID=t,e}getBookmark(){return z.between(this.$anchor,this.$head).getBookmark()}}E.prototype.visible=!0;class ku{constructor(t,e){this.$from=t,this.$to=e}}let As=!1;function Es(o){!As&&!o.parent.inlineContent&&(As=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+o.parent.type.name+")"))}class z extends E{constructor(t,e=t){Es(t),Es(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return E.near(n);let i=t.resolve(e.map(this.anchor));return new z(i.parent.inlineContent?i:n,n)}replace(t,e=M.empty){if(super.replace(t,e),e==M.empty){let n=this.$from.marksAcross(this.$to);n&&t.ensureMarks(n)}}eq(t){return t instanceof z&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new Nn(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new z(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let i=t.resolve(e);return new this(i,n==e?i:t.resolve(n))}static between(t,e,n){let i=t.pos-e.pos;if((!n||i)&&(n=i>=0?1:-1),!e.parent.inlineContent){let r=E.findFrom(e,n,!0)||E.findFrom(e,-n,!0);if(r)e=r.$head;else return E.near(e,n)}return t.parent.inlineContent||(i==0?t=e:(t=(E.findFrom(t,-n,!0)||E.findFrom(t,n,!0)).$anchor,t.pos<e.pos!=i<0&&(t=e))),new z(t,e)}}E.jsonID("text",z);class Nn{constructor(t,e){this.anchor=t,this.head=e}map(t){return new Nn(t.map(this.anchor),t.map(this.head))}resolve(t){return z.between(t.resolve(this.anchor),t.resolve(this.head))}}class T extends E{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:i}=e.mapResult(this.anchor),r=t.resolve(i);return n?E.near(r):new T(r)}content(){return new M(x.from(this.node),0,0)}eq(t){return t instanceof T&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new ko(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new T(t.resolve(e.anchor))}static create(t,e){return new T(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}T.prototype.visible=!1,E.jsonID("node",T);class ko{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new Nn(n,n):new ko(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&T.isSelectable(n)?new T(e):E.near(e)}}class st extends E{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=M.empty){if(e==M.empty){t.delete(0,t.doc.content.size);let n=E.atStart(t.doc);n.eq(t.selection)||t.setSelection(n)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new st(t)}map(t){return new st(t)}eq(t){return t instanceof st}getBookmark(){return xu}}E.jsonID("all",st);const xu={map(){return this},resolve(o){return new st(o)}};function Se(o,t,e,n,i,r=!1){if(t.inlineContent)return z.create(o,e);for(let s=n-(i>0?0:1);i>0?s<t.childCount:s>=0;s+=i){let a=t.child(s);if(a.isAtom){if(!r&&T.isSelectable(a))return T.create(o,e-(i<0?a.nodeSize:0))}else{let l=Se(o,a,e+i,i<0?a.childCount:0,i,r);if(l)return l}e+=a.nodeSize*i}return null}function Bs(o,t,e){let n=o.steps.length-1;if(n<t)return;let i=o.steps[n];if(!(i instanceof H||i instanceof rt))return;let r=o.mapping.maps[n],s;r.forEach((a,l,c,d)=>{s==null&&(s=d)}),o.setSelection(E.near(o.doc.resolve(s),e))}const Rs=1,Ps=2,zs=4;class Su extends vu{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Rs)&-3,this.storedMarks=null,this}get selectionSet(){return(this.updated&Rs)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=Ps,this}ensureMarks(t){return B.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ps)>0}addStep(t,e){super.addStep(t,e),this.updated=this.updated&-3,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||B.none))),n.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,n){let i=this.doc.type.schema;if(e==null)return t?this.replaceSelectionWith(i.text(t),!0):this.deleteSelection();{if(n==null&&(n=e),n=n??e,!t)return this.deleteRange(e,n);let r=this.storedMarks;if(!r){let s=this.doc.resolve(e);r=n==e?s.marks():s.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,i.text(t,r)),this.selection.empty||this.setSelection(E.near(this.selection.$to)),this}}setMeta(t,e){return this.meta[typeof t=="string"?t:t.key]=e,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=zs,this}get scrolledIntoView(){return(this.updated&zs)>0}}function Fs(o,t){return!t||!o?o:o.bind(t)}class qe{constructor(t,e,n){this.name=t,this.init=Fs(e.init,n),this.apply=Fs(e.apply,n)}}const Cu=[new qe("doc",{init(o){return o.doc||o.schema.topNodeType.createAndFill()},apply(o){return o.doc}}),new qe("selection",{init(o,t){return o.selection||E.atStart(t.doc)},apply(o){return o.selection}}),new qe("storedMarks",{init(o){return o.storedMarks||null},apply(o,t,e,n){return n.selection.$cursor?o.storedMarks:null}}),new qe("scrollToSelection",{init(){return 0},apply(o,t){return o.scrolledIntoView?t+1:t}})];class xo{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Cu.slice(),e&&e.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new qe(n.key,n.spec.state,n))})}}class Ce{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=e){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],n=this.applyInner(t),i=null;for(;;){let r=!1;for(let s=0;s<this.config.plugins.length;s++){let a=this.config.plugins[s];if(a.spec.appendTransaction){let l=i?i[s].n:0,c=i?i[s].state:this,d=l<e.length&&a.spec.appendTransaction.call(a,l?e.slice(l):e,c,n);if(d&&n.filterTransaction(d,s)){if(d.setMeta("appendedTransaction",t),!i){i=[];for(let h=0;h<this.config.plugins.length;h++)i.push(h<s?{state:n,n:e.length}:{state:this,n:0})}e.push(d),n=n.applyInner(d),r=!0}i&&(i[s]={state:n,n:e.length})}}if(!r)return{state:n,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new Ce(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let r=n[i];e[r.name]=r.apply(t,this[r.name],this,e)}return e}get tr(){return new Su(this)}static create(t){let e=new xo(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new Ce(e);for(let i=0;i<e.fields.length;i++)n[e.fields[i].name]=e.fields[i].init(t,n);return n}reconfigure(t){let e=new xo(this.schema,t.plugins),n=e.fields,i=new Ce(e);for(let r=0;r<n.length;r++){let s=n[r].name;i[s]=this.hasOwnProperty(s)?this[s]:n[r].init(t,i)}return i}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(n=>n.toJSON())),t&&typeof t=="object")for(let n in t){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=t[n],r=i.spec.state;r&&r.toJSON&&(e[n]=r.toJSON.call(i,this[i.key]))}return e}static fromJSON(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let i=new xo(t.schema,t.plugins),r=new Ce(i);return i.fields.forEach(s=>{if(s.name=="doc")r.doc=St.fromJSON(t.schema,e.doc);else if(s.name=="selection")r.selection=E.fromJSON(r.doc,e.selection);else if(s.name=="storedMarks")e.storedMarks&&(r.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(let a in n){let l=n[a],c=l.spec.state;if(l.key==s.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(e,a)){r[s.name]=c.fromJSON.call(l,t,e[a],r);return}}r[s.name]=s.init(t,r)}}),r}}function $s(o,t,e){for(let n in o){let i=o[n];i instanceof Function?i=i.bind(t):n=="handleDOMEvents"&&(i=$s(i,t,{})),e[n]=i}return e}class Vs{constructor(t){this.spec=t,this.props={},t.props&&$s(t.props,this,this.props),this.key=t.key?t.key.key:Ls("plugin")}getState(t){return t[this.key]}}const So=Object.create(null);function Ls(o){return o in So?o+"$"+ ++So[o]:(So[o]=0,o+"$")}class Mu{constructor(t="key"){this.key=Ls(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}function Ou(o,t,e,n,i,r){let s=[];function a(){s.length>0&&(Tu(o,t,s,n,r),s=[])}for(const l of e){const c=l.toJSON().stepType;if(c==="addMark"){s.push(l);continue}else a();Nu(o,t,c,l,n,i,r);const d=l.apply(i).doc;if(d==null)throw new Error("Could not apply step to document");i=d,t=Re(n,r)}a()}function Nu(o,t,e,n,i,r,s){e==="replace"?Du(o,t,n,i,s,r):e==="replaceAround"?Iu(o,n,i,r,s):e==="removeMark"&&Au(o,t,n,i,s)}function Du(o,t,e,n,i,r){var l;if(e.slice.content.childCount===1&&((l=e.slice.content.firstChild)!=null&&l.isText)){const c=ho(o,t,{from:e.from,to:e.to});if(c==null)throw new Error(`Could not find range (${e.from}, ${e.to}) in render tree`);let{start:d,end:h}=c;d>h&&([d,h]=[h,d]);const f=h-d;zg(n,i,d,f,e.slice.content.firstChild.text);const g=e.slice.content.firstChild.marks,p=e.slice.content.firstChild.text.length;Eu(o,n,i,d,p,g);return}const s=e.apply(r).doc;if(s==null)throw new Error("Could not apply step to document");const a=_s(o,s);Bl(n,i,a)}function Iu(o,t,e,n,i){const r=t.apply(n).doc;if(r==null)throw new Error("Could not apply step to document");const s=_s(o,r);Bl(e,i,s)}function Tu(o,t,e,n,i){const r=e.map(s=>{const a=ho(o,t,{from:s.from,to:s.to});if(a==null)throw new Error(`Could not find range (${s.from}, ${s.to}) in render tree`);const l=s.mark.type.name,c=s.mark.type.spec.inclusive?"both":"none",d=Bu(s.mark.type,s.mark.attrs);return{range:a,markName:l,expand:c,value:d}}).reduce((s,a)=>{const l=s[s.length-1];return l==null?[a]:l.markName===a.markName&&l.expand===a.expand&&l.value===a.value&&(l.range.end===a.range.start||t.slice(l.range.end,a.range.start).every(c=>c.type==="block"))?(l.range.end=a.range.end,s):(s.push(a),s)},[]);for(const s of r)El(n,i,{start:s.range.start,end:s.range.end,expand:s.expand},s.markName,s.value)}function Au(o,t,e,n,i){const r=ho(o,t,{from:e.from,to:e.to});if(r==null)throw new Error(`Could not find range (${e.from}, ${e.to}) in render tree`);const{start:s,end:a}=r;if(s==null||a==null)throw new Error(`Could not find step.from (${e.from}) or step.to (${e.to}) in render tree`);const l=e.mark.type.name,c=e.mark.type.spec.inclusive?"both":"none";Rl(n,i,{start:s,end:a,expand:c},l)}function Eu(o,t,e,n,i,r){const s=Fg(t,e,n),a=fs(o,r),l=new Set(Object.keys(a)),c=new Set(Object.keys(s));for(const d of l)(!c.has(d)||a[d]!==s[d])&&El(t,e,{start:n,end:n+i,expand:"both"},d,a[d]);for(const d of c)o.markMappings.find(h=>h.automergeMarkName===d)!=null&&(l.has(d)||Rl(t,e,{start:n,end:n+i,expand:"both"},d))}function Bu(o,t){return o.name==="link"?JSON.stringify(t):(o.name==="strong"||o.name==="em"||o.name,!0)}function Dn(o,t){if(o.length!==t.length)return!1;for(let e=0;e<o.length;e++)if(o[e]!==t[e])return!1;return!0}function js(o,t){if(o.length>t.length)return!1;for(let e=0;e<o.length;e++)if(o[e]!==t[e])return!1;return!0}function In(o,t,e){if(Dn(o,e.path)){if(e.action==="mark")for(const n of e.marks)Pu(t,n)}else if(js(o,e.path))if(e.path.length===o.length+1)e.action==="insert"?Vu(t,e):e.action==="del"?zu(t,e):e.action==="splice"&&Ru(t,e);else{const n=e.path[o.length];if(typeof n!="number")throw console.error(`Invalid path: ${e.path}`),new Error("Invalid path: expected number when patching spans");const i=Js(t,n);if(i==null)throw new Error("Invalid path: unable to find block at index");Fu(o,e,i)}}function Ru(o,t){let e=0;const n=t.path[t.path.length-1];if(typeof n!="number")return;let i=0;for(;i<o.length;){const r=o[i];if(r.type==="text")if(e<=n&&e+r.value.length>n){const s=n-e,a=r.value.slice(0,s),l=r.value.slice(s);if(ce(r.marks,t.marks))r.value=a+t.value+l;else{const c=[],d=o[i-1];a.length===0&&d&&d.type==="text"&&ce(d.marks,t.marks)?d.value+=t.value:(a.length>0&&c.push(At({value:a,marks:r.marks})),c.push(At({value:t.value,marks:t.marks}))),l.length>0&&c.push(At({value:l,marks:r.marks})),o.splice(i,1,...c)}return}else e+=r.value.length,i+=1;else{if(e===n){const s=o[i-1];if(s!=null&&s.type==="text"&&ce(s.marks,t.marks))s.value+=t.value;else{const a={type:"text",value:t.value};t.marks!=null&&(a.marks=t.marks),o.splice(i,0,a)}return}e+=1,i+=1}}if(e===n){const r=o[o.length-1];if(r&&r.type==="text"&&ce(r.marks||{},t.marks||{}))r.value+=t.value;else{const s={type:"text",value:t.value};t.marks!=null&&(s.marks=t.marks),o.push(s)}}}function Pu(o,t){let e=0,n=0;for(;n<o.length;){const i=o[n];if(i.type==="text"){const r=e,s=e+i.value.length;if(r<t.end&&s>t.start){const a=Math.max(0,t.start-r),l=Math.min(i.value.length,t.end-r);a>0?(o.splice(n,1,At({value:i.value.slice(0,a),marks:i.marks}),At({value:i.value.slice(a,l),marks:{...i.marks,[t.name]:t.value}})),n++):o[n]=At({value:i.value.slice(0,l),marks:{...i.marks,[t.name]:t.value}}),l<i.value.length&&o.splice(n+1,0,At({value:i.value.slice(l),marks:i.marks}));const c=o[n-1];let d=o[n];n>0&&c.type==="text"&&d.type==="text"&&ce(c.marks,d.marks)?(c.value+=d.value,o.splice(n,1)):n++;const h=o[n+1];d=o[n],n<o.length-1&&h.type==="text"&&d.type==="text"&&ce(h.marks,d.marks)&&(d.value+=h.value,o.splice(n+1,1))}else n++;e+=i.value.length}else n++,e+=1}}function zu(o,t){const e=t.path[t.path.length-1];if(typeof e!="number")throw new Error("Invalid path: expected number when deleting spans");const n=e+(t.length||1);let i=0,r=0,s=0;function a(l){const c=o[l-1],d=o[l];if(c&&c.type==="text"&&d&&d.type==="text"&&ce(c.marks,d.marks)){const h=c.value.length;return c.value+=d.value,o.splice(l,1),h}}for(;s<o.length&&i<n-e;){const l=o[s],c=n-i;if(l.type==="text"){const d=r,h=r+l.value.length;if(d>=e&&h<=c)o.splice(s,1),i+=l.value.length,a(s);else if(d<c&&h>e){const f=Math.max(0,e-d),g=Math.min(l.value.length,c-d);f>0&&g<l.value.length?(o.splice(s,1,At({value:l.value.slice(0,f),marks:l.marks}),At({value:l.value.slice(g),marks:l.marks})),s++,r+=f,i+=g-f):f>0?(i+=l.value.length-f,l.value=l.value.slice(0,f)):g<l.value.length&&(i+=g,l.value=l.value.slice(g));const p=a(s);p?r-=p:(s++,r+=l.value.length)}else r+=l.value.length,s++}else if(l.type==="block")if(r>=e&&r<c){o.splice(s,1),i+=1;const d=a(s);d&&(s--,r-=d)}else r++,s++}}function Fu(o,t,e){const n=t.path.slice(o.length+1);if(t.action==="put"){const i=Tn(e,n.slice(0,-1)),r=t.path[t.path.length-1];i[r]=Ws(t.value)}else if(t.action==="insert"){const i=Tn(e,n.slice(0,-2)),r=n.pop(),s=n.pop(),a=i[s];if(!Array.isArray(a))throw new Error("Invalid path: expected array when inserting");a.splice(r,0,...$u(t.values))}else if(t.action==="splice"){const i=Tn(e,n.slice(0,-2)),r=n.pop(),s=n.pop(),a=i[s],l=a.slice(0,r)+t.value+a.slice(r);i[s]=l}else if(t.action==="del"){const i=Tn(e,n.slice(0,-1)),r=t.path[t.path.length-1];delete i[r]}}function $u(o){return o.map(t=>Ws(t))}function Ws(o){return o instanceof $t?new $t(o.toString()):structuredClone(o)}function Tn(o,t){let e=o;for(const n of t){if(typeof e!="object")throw new Error("Invalid path: expected object when resolving target");e=e[n]}return e}function Vu(o,t){let e=0,n=0;const i=t.path[t.path.length-1];if(typeof i!="number")throw new Error(`Invalid patch path, expected a number got ", ${t.path[t.path.length-1]}`);const r=[];for(const s of t.values){if(!s||typeof s!="object")throw new Error("Invalid patch: expected object when inserting");if(Object.keys(s).length!==0)throw new Error("Invalid patch: unexpected nonempty object when inserting");r.push({type:"block",value:{}})}for(;e<i&&n<o.length;){const s=o[n];if(s.type=="text"){if(s.value.length+e>i){const a=i-e,l=s.value.slice(0,a),c=s.value.slice(a);s.value=l,o.splice(n+1,0,...r),o.splice(n+r.length+1,0,{type:"text",value:c});return}e+=s.value.length}else e+=1;n+=1}o.splice(n,0,...r)}function Js(o,t){let e=0;for(const n of o)if(n.type==="block"){if(e===t)return n.value;e+=1}else e+=n.value.length;return null}function ce(o,t){if(o===t)return!0;if(!o||!t||Object.keys(o).length!==Object.keys(t).length)return!1;for(const e in o)if(o[e]!==t[e])return!1;return!0}function At({value:o,marks:t}){const e={type:"text",value:o};return t!=null&&(e.marks=t),e}function qs(o,t,e,n,i){const r=Hu(n,e);let s=i;for(const a of r)if(a.type==="text")for(const l of a.patches)if(l.action==="splice")s=Lu(o,t,l,n,s),In(n,t,l);else if(l.action==="del"){const c=l.path[l.path.length-1];Js(t,c)!=null?s=Hs(o,n,t,c,[l],s):s=ju(o,t,l,n,s),In(n,t,l)}else l.action==="mark"&&(s=Wu(o,t,l,n,s),In(n,t,l));else s=Hs(o,n,t,a.index,a.patches,s);return s}function Lu(o,t,e,n,i){const r=Ks(n,e.path);if(r===null)return i;const s=xn(o,t,r);if(s==null)throw new Error("Invalid index");const a=qu(o,e.value,e.marks);return i=i.step(new H(s,s,new M(a,0,0))),i}function ju(o,t,e,n,i){const r=Ks(n,e.path);if(r===null)return i;const s=xn(o,t,r);if(s==null)throw new Error("Invalid index");const a=s+(e.length||1);return i.delete(s,a)}function Wu(o,t,e,n,i){if(Dn(e.path,n))for(const r of e.marks){const s=xn(o,t,r.start),a=xn(o,t,r.end);if(s==null||a==null)throw new Error("Invalid index");if(r.value==null){const l=o.markMappings.find(d=>d.automergeMarkName===r.name),c=l?l.prosemirrorMark:o.unknownMark;i=i.removeMark(s,a,c)}else{const l=ro(o,{[r.name]:r.value});for(const c of l)i=i.addMark(s,a,c)}}return i}function Hs(o,t,e,n,i,r){for(const b of i)In(t,e,b);const s=so(o,e),a=Ju(r.doc.content,s.content);if(a==null)return r;const l=s.resolve(a.start),c=s.resolve(a.endB),d=r.doc.resolve(a.start),h=l.sameParent(c)&&l.parent.inlineContent&&d.end()>=a.endA,f=a.start,g=a.endA;let p=!1;if(h){if(l.pos==c.pos)p=!0,r=r.delete(f,g);else if(l.parent.child(l.index()).isText&&l.index()==c.index()-(c.textOffset?0:1)){p=!0;const b=l.parent.textBetween(l.parentOffset,c.parentOffset);r=r.insertText(b,f,g)}}return p||(r=r.replace(f,g,s.slice(a.start,a.endB))),r}function Ju(o,t){let e=o.findDiffStart(t);if(e==null)return null;let{a:n,b:i}=o.findDiffEnd(t);return n<e&&o.size<t.size?(e&&e<t.size&&Us(t.textBetween(e-1,e+1))&&(e-=1),i=e+(i-n),n=e):i<e&&(e&&e<o.size&&Us(o.textBetween(e-1,e+1))&&(e-=1),n=e+(n-i),i=e),{start:e,endA:n,endB:i}}function Us(o){if(o.length!=2)return!1;const t=o.charCodeAt(0),e=o.charCodeAt(1);return t>=56320&&t<=57343&&e>=55296&&e<=56319}function Ks(o,t){if(t.length!==o.length+1)return null;for(let n=0;n<o.length;n++)if(o[n]!==t[n])return null;const e=t[t.length-1];return typeof e=="number"?e:null}function qu(o,t,e){let n;return e!=null&&(n=ro(o,e)),x.from(o.schema.text(t,n))}function Hu(o,t){const e=[];let n={type:"gatheringText",gathered:[]};function i(){n.type==="gatheringBlock"?e.push({type:"block",index:n.index,patches:n.gathered}):n.type==="gatheringText"&&e.push({type:"text",patches:n.gathered}),n={type:"transitioning"}}for(const r of t)if(js(o,r.path))if(Dn(o,r.path)&&r.action==="mark")n.type==="gatheringText"?n.gathered.push(r):(i(),n={type:"gatheringText",gathered:[r]});else if(r.path.length===o.length+1){const s=r.path[r.path.length-1];typeof s=="number"&&(r.action==="splice"||r.action==="del"?n.type==="gatheringText"?n.gathered.push(r):(i(),n={type:"gatheringText",gathered:[r]}):r.action==="insert"&&(i(),n={type:"gatheringBlock",index:s,gathered:[r]}))}else{const s=r.path[o.length];if(typeof s!="number")continue;n.type==="gatheringBlock"&&n.index===s?n.gathered.push(r):(i(),n={type:"gatheringBlock",index:s,gathered:[r]})}return i(),e}function Uu({adapter:o,path:t,before:e,after:n,patches:i,state:r}){const s=li(e),a=Re($g(n,s),t),l=qs(o,a,i,t,r.tr);return l.setMeta("addToHistory",!1),l}const Gs={encodeCharacter:o=>o,encodeNodeStart:o=>o.type.name,encodeNodeEnd:()=>-1,compareTokens:(o,t)=>o===t};function Co(o,t,e,n,i){for(let r=0,s=0;r<o.childCount;r++){let a=o.child(r),l=s+a.nodeSize,c=Math.max(s,e),d=Math.min(l,n);if(c<d)if(a.isText)for(let h=c;h<d;h++)i.push(t.encodeCharacter(a.text.charCodeAt(h-s),a.marks));else a.isLeaf?i.push(t.encodeNodeStart(a)):(c==s&&i.push(t.encodeNodeStart(a)),Co(a.content,t,Math.max(s+1,c)-s-1,Math.min(l-1,d)-s-1,i),d==l&&i.push(t.encodeNodeEnd(a)));s=l}return i}const Ku=5e3;function Gu(o,t){return Math.min(15,Math.max(2,Math.floor(Math.max(o,t)/10)))}function Xs(o,t,e,n=Gs){let i=Co(o,n,e.fromA,e.toA,[]),r=Co(t,n,e.fromB,e.toB,[]),s=0,a=i.length,l=r.length,c=n.compareTokens;for(;s<i.length&&s<r.length&&c(i[s],r[s]);)s++;if(s==i.length&&s==r.length)return[];for(;a>s&&l>s&&c(i[a-1],r[l-1]);)a--,l--;if(a==s||l==s||a==l&&a==s+1)return[e.slice(s,a,s,l)];let d=a-s,h=l-s,f=Math.min(Ku,d+h),g=f+1,p=[],b=[];for(let y=g*2,k=0;k<y;k++)b[k]=-1;for(let y=0;y<=f;y++){for(let k=-y;k<=y;k+=2){let D=b[k+1+f],$=b[k-1+f],O=D<$?$:D+1,P=O+k;for(;O<d&&P<h&&c(i[s+O],r[s+P]);)O++,P++;if(b[k+f]=O,O>=d&&P>=h){let V=[],an=Gu(a-s,l-s),ct=-1,A=-1,dt=-1,Zt=-1,Un=(Be,ln,cn,Eg)=>{ct>-1&&ct<ln+an?(ct=Be,dt=cn):(ct>-1&&V.push(e.slice(ct,A,dt,Zt)),ct=Be,A=ln,dt=cn,Zt=Eg)};for(let Be=y-1;Be>=0;Be--){let ln=b[k+1+f],cn=b[k-1+f];ln<cn?(k--,O=cn+s,P=O+k,Un(O,O,P,P+1)):(k++,O=ln+s,P=O+k,Un(O,O+1,P,P)),b=p[Be>>1]}return ct>-1&&V.push(e.slice(ct,A,dt,Zt)),V.reverse()}}y%2==0&&p.push(b.slice())}return[e.slice(s,a,s,l)]}class L{constructor(t,e){this.length=t,this.data=e}cut(t){return t==this.length?this:new L(t,this.data)}static slice(t,e,n){if(e==n)return L.none;if(e==0&&n==L.len(t))return t;let i=[];for(let r=0,s=0;s<n;r++){let a=t[r],l=s+a.length,c=Math.min(n,l)-Math.max(e,s);c>0&&i.push(a.cut(c)),s=l}return i}static join(t,e,n){if(t.length==0)return e;if(e.length==0)return t;let i=n(t[t.length-1].data,e[0].data);if(i==null)return t.concat(e);let r=t.slice(0,t.length-1);r.push(new L(t[t.length-1].length+e[0].length,i));for(let s=1;s<e.length;s++)r.push(e[s]);return r}static len(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n].length;return e}}L.none=[];class Et{constructor(t,e,n,i,r,s){this.fromA=t,this.toA=e,this.fromB=n,this.toB=i,this.deleted=r,this.inserted=s}get lenA(){return this.toA-this.fromA}get lenB(){return this.toB-this.fromB}slice(t,e,n,i){return t==0&&n==0&&e==this.toA-this.fromA&&i==this.toB-this.fromB?this:new Et(this.fromA+t,this.fromA+e,this.fromB+n,this.fromB+i,L.slice(this.deleted,t,e),L.slice(this.inserted,n,i))}static merge(t,e,n){if(t.length==0)return e;if(e.length==0)return t;let i=[];for(let r=0,s=0,a=t[0],l=e[0];;){if(!a&&!l)return i;if(a&&(!l||a.toB<l.fromA)){let c=s?e[s-1].toB-e[s-1].toA:0;i.push(c==0?a:new Et(a.fromA,a.toA,a.fromB+c,a.toB+c,a.deleted,a.inserted)),a=r++==t.length?null:t[r]}else if(l&&(!a||l.toA<a.fromB)){let c=r?t[r-1].toB-t[r-1].toA:0;i.push(c==0?l:new Et(l.fromA-c,l.toA-c,l.fromB,l.toB,l.deleted,l.inserted)),l=s++==e.length?null:e[s]}else{let c=Math.min(a.fromB,l.fromA),d=Math.min(a.fromA,l.fromA-(r?t[r-1].toB-t[r-1].toA:0)),h=d,f=Math.min(l.fromB,a.fromB+(s?e[s-1].toB-e[s-1].toA:0)),g=f,p=L.none,b=L.none,y=!1,k=!1;for(;;){let D=a?c>=a.fromB?a.toB:a.fromB:2e8,$=l?c>=l.fromA?l.toA:l.fromA:2e8,O=Math.min(D,$),P=a&&c>=a.fromB,V=l&&c>=l.fromA;if(!P&&!V)break;P&&c==a.fromB&&!y&&(p=L.join(p,a.deleted,n),h+=a.lenA,y=!0),P&&!V&&(b=L.join(b,L.slice(a.inserted,c-a.fromB,O-a.fromB),n),g+=O-c),V&&c==l.fromA&&!k&&(b=L.join(b,l.inserted,n),g+=l.lenB,k=!0),V&&!P&&(p=L.join(p,L.slice(l.deleted,c-l.fromA,O-l.fromA),n),h+=O-c),P&&O==a.toB&&(a=r++==t.length?null:t[r],y=!1),V&&O==l.toA&&(l=s++==e.length?null:e[s],k=!1),c=O}(d<h||f<g)&&i.push(new Et(d,h,f,g,p,b))}}}}let Xu;try{Xu=new RegExp("[\\p{Alphabetic}_]","u")}catch{}class de{constructor(t,e){this.config=t,this.changes=e}addSteps(t,e,n){let i=[];for(let l=0;l<e.length;l++){let c=Array.isArray(n)?n[l]:n,d=0;e[l].forEach((h,f,g,p)=>{i.push(new Et(h+d,f+d,g,p,h==f?L.none:[new L(f-h,c)],g==p?L.none:[new L(p-g,c)])),d=p-g-(f-h)})}if(i.length==0)return this;let r=Mo(i,this.config.combine),s=Et.merge(this.changes,r,this.config.combine),a=s;for(let l=0;l<a.length;l++){let c=a[l];if(c.fromA==c.toA||c.fromB==c.toB||!r.some(h=>h.toB>c.fromB&&h.fromB<c.toB))continue;let d=Xs(this.config.doc.content,t.content,c,this.config.encoder);d.length==1&&d[0].fromB==0&&d[0].toB==c.toB-c.fromB||(a==s&&(a=s.slice()),d.length==1?a[l]=d[0]:(a.splice(l,1,...d),l+=d.length-1))}return new de(this.config,a)}get startDoc(){return this.config.doc}map(t){let e=n=>{let i=t(n);return i===n.data?n:new L(n.length,i)};return new de(this.config,this.changes.map(n=>new Et(n.fromA,n.toA,n.fromB,n.toB,n.deleted.map(e),n.inserted.map(e))))}changedRange(t,e){if(t==this)return null;let n=e&&Qu(e),i=n?n.toB-n.fromB-(n.toA-n.fromA):0;function r(h){return!n||h<=n.fromA?h:h+i}let s=n?n.fromB:2e8,a=n?n.toB:-2e8;function l(h,f=h){s=Math.min(h,s),a=Math.max(f,a)}let c=this.changes,d=t.changes;for(let h=0,f=0;h<c.length&&f<d.length;){let g=c[h],p=d[f];g&&p&&Yu(g,p,r)?(h++,f++):p&&(!g||r(g.fromB)>=p.fromB)?(l(p.fromB,p.toB),f++):(l(r(g.fromB),r(g.toB)),h++)}return s<=a?{from:s,to:a}:null}static create(t,e=(i,r)=>i===r?i:null,n=Gs){return new de({combine:e,doc:t,encoder:n},[])}}de.computeDiff=Xs;function Mo(o,t,e=0,n=o.length){if(n==e+1)return[o[e]];let i=e+n>>1;return Et.merge(Mo(o,t,e,i),Mo(o,t,i,n),t)}function Qs(o){let t=2e8,e=-2e8;for(let n=0;n<o.length;n++){let i=o[n];t!=2e8&&(t=i.map(t,-1),e=i.map(e,1)),i.forEach((r,s,a,l)=>{t=Math.min(t,a),e=Math.max(e,l)})}return t==2e8?null:{from:t,to:e}}function Qu(o){let t=Qs(o);if(!t)return null;let e=Qs(o.map(n=>n.invert()).reverse());return{fromA:e.from,toA:e.to,fromB:t.from,toB:t.to}}function Yu(o,t,e){return e(o.fromB)==t.fromB&&e(o.toB)==t.toB&&Ys(o.deleted,t.deleted)&&Ys(o.inserted,t.inserted)}function Ys(o,t){if(o.length!=t.length)return!1;for(let e=0;e<o.length;e++)if(o[e].length!=t[e].length||o[e].data!==t[e].data)return!1;return!0}const Zu=new Mu("automerge-sync"),tp=({adapter:o,handle:t,path:e})=>{let n=!1;return new Vs({key:Zu,view:i=>{const r=({doc:s,patches:a,patchInfo:l})=>{if(n)return;const c=Uu({adapter:o,path:e,before:l.before,after:s,patches:a,state:i.state});n=!0,i.dispatch(c),n=!1};return t.on("change",r),{destroy(){t.off("change",r)}}},appendTransaction(i,r,s){if(n||(i=i.filter(O=>O.docChanged),i.length===0))return;n=!0,t.change(O=>{for(const P of i){const V=Re(O,e);Ou(o,V,P.steps,O,P.docs[0],e)}}),n=!1;const a=t.docSync(),l=li(a),c=Re(a,e),d=t.docSync(),h=li(d),f=Re(d,e);if(Dn(l,h))return;const g=Vg(d,l,h),p=qs(o,c,g,e,r.tr);let b=de.create(r.doc);b=b.addSteps(r.doc,p.mapping.maps,void 0);let y=de.create(r.doc);for(const O of i)y=y.addSteps(O.docs[0],O.mapping.maps,void 0);const k=y.changedRange(b);if(!k||k.from===k.to)return;console.warn(`Warning: ProseMirror doc doesn't match AutoMerge spans.

State will be automatically fixed with a tr. File an issue at https://github.com/automerge/automerge-repo.
`,{spansBefore:c,steps:i.map(O=>O.steps.map(P=>P.toJSON()))});const D=so(o,f).slice(k.from,k.to),$=s.tr;$.replace(k.from,k.to,D);try{$.setSelection(E.fromJSON($.doc,s.selection.toJSON()))}catch(O){if(!(O instanceof RangeError))throw O}return $.setStoredMarks(s.storedMarks),$}})};var Zs={exports:{}};(function(o){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function i(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function r(l,c,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var g=new i(d,h||l,f),p=e?e+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],g]:l._events[p].push(g):(l._events[p]=g,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)t.call(c,d)&&l.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=e?e+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,g=new Array(f);h<f;h++)g[h]=d[h].fn;return g},a.prototype.listenerCount=function(l){var c=e?e+l:l,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,c,d,h,f,g){var p=e?e+l:l;if(!this._events[p])return!1;var b=this._events[p],y=arguments.length,k,D;if(b.fn){switch(b.once&&this.removeListener(l,b.fn,void 0,!0),y){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,c),!0;case 3:return b.fn.call(b.context,c,d),!0;case 4:return b.fn.call(b.context,c,d,h),!0;case 5:return b.fn.call(b.context,c,d,h,f),!0;case 6:return b.fn.call(b.context,c,d,h,f,g),!0}for(D=1,k=new Array(y-1);D<y;D++)k[D-1]=arguments[D];b.fn.apply(b.context,k)}else{var $=b.length,O;for(D=0;D<$;D++)switch(b[D].once&&this.removeListener(l,b[D].fn,void 0,!0),y){case 1:b[D].fn.call(b[D].context);break;case 2:b[D].fn.call(b[D].context,c);break;case 3:b[D].fn.call(b[D].context,c,d);break;case 4:b[D].fn.call(b[D].context,c,d,h);break;default:if(!k)for(O=1,k=new Array(y-1);O<y;O++)k[O-1]=arguments[O];b[D].fn.apply(b[D].context,k)}}return!0},a.prototype.on=function(l,c,d){return r(this,l,c,d,!1)},a.prototype.once=function(l,c,d){return r(this,l,c,d,!0)},a.prototype.removeListener=function(l,c,d,h){var f=e?e+l:l;if(!this._events[f])return this;if(!c)return s(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!h||g.once)&&(!d||g.context===d)&&s(this,f);else{for(var p=0,b=[],y=g.length;p<y;p++)(g[p].fn!==c||h&&!g[p].once||d&&g[p].context!==d)&&b.push(g[p]);b.length?this._events[f]=b.length===1?b[0]:b:s(this,f)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=e?e+l:l,this._events[c]&&s(this,c)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,o.exports=a})(Zs);var ep=Zs.exports;const ta=Yg(ep);let Oo=!1;const An=new Kn.subtle.Watcher(()=>{Oo||(Oo=!0,queueMicrotask(()=>{Oo=!1;for(const o of An.getPending())o.get();An.watch()}))});function np(o){let t;const e=new Kn.Computed(()=>{typeof t=="function"&&t(),t=o()});return An.watch(e),e.get(),()=>{typeof t=="function"&&t(),An.unwatch(e)}}class op extends ta{get activeCollaborators(){return Array.from(this.collaborators.get().keys())}constructor(t,e,n){super(),this.client=t,this.sessionId=e,this.acceptedCollaborators=n,this.collaborators=new Kn.State(new Pl),this.joined=!0,this.ignoredMessages=new Pl,t.onSignal(r=>{if(!(!this.joined||r.remote_signal.session_id!==this.sessionId)){if(!this.acceptedCollaborators.get().find(s=>Y(s)===Y(r.provenance))){console.warn(`Received a message from an invalid peer ${Y(r.provenance)}: ignoring.`),this.ignoredMessages.has(r.provenance)||this.ignoredMessages.set(r.provenance,[]),this.ignoredMessages.get(r.provenance).push(r.remote_signal);return}this.handleCollaboratorMessage(r.provenance,r.remote_signal)}});let i;np(()=>{const r=this.acceptedCollaborators.get();for(const[s,a]of Array.from(this.ignoredMessages.entries()))if(r.find(l=>Y(l)===Y(s))){for(const l of a)this.handleCollaboratorMessage(s,l);this.ignoredMessages.delete(s)}i&&clearInterval(i),i=setInterval(()=>{this.joined&&this.client.sendPresenceSignal(this.sessionId,r.filter(s=>Y(s)!==Y(this.client.client.myPubKey)))},3e3)})}handleCollaboratorMessage(t,e){const n=this.collaborators.get(),i=n.get(t);switch(e.type){case"Presence":i||this.emit("collaborator-joined",{collaborator:t}),n.set(t,{lastSeen:Date.now()});break;case"SessionMessage":this.emit("message-received",{collaborator:t,message:Lg(e.message)}),n.set(t,{lastSeen:Date.now()});break;case"LeaveSession":n.delete(t),this.emit("collaborator-left",{collaborator:t});break}this.collaborators.set(n)}async join(){this.joined=!0;const t=this.acceptedCollaborators.get();return this.client.sendPresenceSignal(this.sessionId,t.filter(e=>Y(e)!==Y(this.client.client.myPubKey)))}async sendMessage(t,e){if(t.length===0)return;const n=jg(e);return this.client.sendSessionMessage(this.sessionId,t.filter(i=>Y(i)!==Y(this.client.client.myPubKey)),n)}async leave(){return this.joined=!1,this.client.sendLeaveSesionSignal(this.sessionId,this.activeCollaborators)}}const ea=$l("collaborative_sessions/client");class ip extends ta{constructor(t,e,n,i){super(),this.client=t,this.sessionId=e,this.acceptedCollaborators=n,this.doc=i,this.syncStates={},this.session=new op(this.client,this.sessionId,this.acceptedCollaborators),this.session.on("message-received",r=>{switch(r.message.type){case"sync":this.handleSyncMessage(Y(r.collaborator),r.message.syncMessage);return;case"change":this.handleChange(Y(r.collaborator),r.message.change);return}}),this.session.on("collaborator-joined",r=>this.sendSyncMessage(Y(r.collaborator)))}change(t){this.doc=Wg(this.doc,{patchCallback:this.patchCallback.bind(this)},t);const e=Jg(this.doc);e&&this.session.sendMessage(this.session.activeCollaborators,{type:"change",change:e})}docSync(){return this.doc}async syncWithPeers(){this.session.activeCollaborators.forEach(t=>this.sendSyncMessage(Y(t)))}sendSyncMessage(t){this.syncStates[t]||(this.syncStates[t]=zl());const e=this.syncStates[t],[n,i]=qg(this.doc,e);i&&(this.syncStates[t]=n,this.session.sendMessage([Hg(t)],{type:"sync",syncMessage:i}))}handleSyncMessage(t,e){this.syncStates[t]||(this.syncStates[t]=zl());const n=this.syncStates[t],[i,r]=Ug(this.doc,n,e,{patchCallback:this.patchCallback.bind(this)});this.doc=i,this.syncStates[t]=r,this.sendSyncMessage(t)}handleChange(t,e){const[n]=Kg(this.doc,[e],{patchCallback:this.patchCallback.bind(this)});this.doc=n}patchCallback(t,e){this.emit("change",{doc:e.after,handle:this,patches:t,patchInfo:e})}}const na=$l("collaborative_document"),U=function(o){for(var t=0;;t++)if(o=o.previousSibling,!o)return t},Me=function(o){let t=o.assignedSlot||o.parentNode;return t&&t.nodeType==11?t.host:t};let No=null;const Bt=function(o,t,e){let n=No||(No=document.createRange());return n.setEnd(o,e??o.nodeValue.length),n.setStart(o,t||0),n},rp=function(){No=null},he=function(o,t,e,n){return e&&(oa(o,t,e,n,-1)||oa(o,t,e,n,1))},sp=/^(img|br|input|textarea|hr)$/i;function oa(o,t,e,n,i){for(;;){if(o==e&&t==n)return!0;if(t==(i<0?0:gt(o))){let r=o.parentNode;if(!r||r.nodeType!=1||He(o)||sp.test(o.nodeName)||o.contentEditable=="false")return!1;t=U(o)+(i<0?0:1),o=r}else if(o.nodeType==1){if(o=o.childNodes[t+(i<0?-1:0)],o.contentEditable=="false")return!1;t=i<0?gt(o):0}else return!1}}function gt(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function ap(o,t){for(;;){if(o.nodeType==3&&t)return o;if(o.nodeType==1&&t>0){if(o.contentEditable=="false")return null;o=o.childNodes[t-1],t=gt(o)}else if(o.parentNode&&!He(o))t=U(o),o=o.parentNode;else return null}}function lp(o,t){for(;;){if(o.nodeType==3&&t<o.nodeValue.length)return o;if(o.nodeType==1&&t<o.childNodes.length){if(o.contentEditable=="false")return null;o=o.childNodes[t],t=0}else if(o.parentNode&&!He(o))t=U(o)+1,o=o.parentNode;else return null}}function cp(o,t,e){for(let n=t==0,i=t==gt(o);n||i;){if(o==e)return!0;let r=U(o);if(o=o.parentNode,!o)return!1;n=n&&r==0,i=i&&r==gt(o)}}function He(o){let t;for(let e=o;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==o||t.contentDOM==o)}const En=function(o){return o.focusNode&&he(o.focusNode,o.focusOffset,o.anchorNode,o.anchorOffset)};function ue(o,t){let e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=o,e.key=e.code=t,e}function dp(o){let t=o.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function hp(o,t,e){if(o.caretPositionFromPoint)try{let n=o.caretPositionFromPoint(t,e);if(n)return{node:n.offsetNode,offset:Math.min(gt(n.offsetNode),n.offset)}}catch{}if(o.caretRangeFromPoint){let n=o.caretRangeFromPoint(t,e);if(n)return{node:n.startContainer,offset:Math.min(gt(n.startContainer),n.startOffset)}}}const Mt=typeof navigator<"u"?navigator:null,ia=typeof document<"u"?document:null,Wt=Mt&&Mt.userAgent||"",Do=/Edge\/(\d+)/.exec(Wt),ra=/MSIE \d/.exec(Wt),Io=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Wt),nt=!!(ra||Io||Do),Jt=ra?document.documentMode:Io?+Io[1]:Do?+Do[1]:0,yt=!nt&&/gecko\/(\d+)/i.test(Wt);yt&&+(/Firefox\/(\d+)/.exec(Wt)||[0,0])[1];const To=!nt&&/Chrome\/(\d+)/.exec(Wt),X=!!To,sa=To?+To[1]:0,Z=!nt&&!!Mt&&/Apple Computer/.test(Mt.vendor),Oe=Z&&(/Mobile\/\w+/.test(Wt)||!!Mt&&Mt.maxTouchPoints>2),mt=Oe||(Mt?/Mac/.test(Mt.platform):!1),up=Mt?/Win/.test(Mt.platform):!1,Rt=/Android \d/.test(Wt),Ue=!!ia&&"webkitFontSmoothing"in ia.documentElement.style,pp=Ue?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function fp(o){let t=o.defaultView&&o.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:o.documentElement.clientWidth,top:0,bottom:o.documentElement.clientHeight}}function Pt(o,t){return typeof o=="number"?o:o[t]}function gp(o){let t=o.getBoundingClientRect(),e=t.width/o.offsetWidth||1,n=t.height/o.offsetHeight||1;return{left:t.left,right:t.left+o.clientWidth*e,top:t.top,bottom:t.top+o.clientHeight*n}}function aa(o,t,e){let n=o.someProp("scrollThreshold")||0,i=o.someProp("scrollMargin")||5,r=o.dom.ownerDocument;for(let s=e||o.dom;s;){if(s.nodeType!=1){s=Me(s);continue}let a=s,l=a==r.body,c=l?fp(r):gp(a),d=0,h=0;if(t.top<c.top+Pt(n,"top")?h=-(c.top-t.top+Pt(i,"top")):t.bottom>c.bottom-Pt(n,"bottom")&&(h=t.bottom-t.top>c.bottom-c.top?t.top+Pt(i,"top")-c.top:t.bottom-c.bottom+Pt(i,"bottom")),t.left<c.left+Pt(n,"left")?d=-(c.left-t.left+Pt(i,"left")):t.right>c.right-Pt(n,"right")&&(d=t.right-c.right+Pt(i,"right")),d||h)if(l)r.defaultView.scrollBy(d,h);else{let g=a.scrollLeft,p=a.scrollTop;h&&(a.scrollTop+=h),d&&(a.scrollLeft+=d);let b=a.scrollLeft-g,y=a.scrollTop-p;t={left:t.left-b,top:t.top-y,right:t.right-b,bottom:t.bottom-y}}let f=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(f))break;s=f=="absolute"?s.offsetParent:Me(s)}}function mp(o){let t=o.dom.getBoundingClientRect(),e=Math.max(0,t.top),n,i;for(let r=(t.left+t.right)/2,s=e+1;s<Math.min(innerHeight,t.bottom);s+=5){let a=o.root.elementFromPoint(r,s);if(!a||a==o.dom||!o.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=e-20){n=a,i=l.top;break}}return{refDOM:n,refTop:i,stack:la(o.dom)}}function la(o){let t=[],e=o.ownerDocument;for(let n=o;n&&(t.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),o!=e);n=Me(n));return t}function bp({refDOM:o,refTop:t,stack:e}){let n=o?o.getBoundingClientRect().top:0;ca(e,n==0?0:n-t)}function ca(o,t){for(let e=0;e<o.length;e++){let{dom:n,top:i,left:r}=o[e];n.scrollTop!=i+t&&(n.scrollTop=i+t),n.scrollLeft!=r&&(n.scrollLeft=r)}}let Ne=null;function _p(o){if(o.setActive)return o.setActive();if(Ne)return o.focus(Ne);let t=la(o);o.focus(Ne==null?{get preventScroll(){return Ne={preventScroll:!0},!0}}:void 0),Ne||(Ne=!1,ca(t,0))}function da(o,t){let e,n=2e8,i,r=0,s=t.top,a=t.top,l,c;for(let d=o.firstChild,h=0;d;d=d.nextSibling,h++){let f;if(d.nodeType==1)f=d.getClientRects();else if(d.nodeType==3)f=Bt(d).getClientRects();else continue;for(let g=0;g<f.length;g++){let p=f[g];if(p.top<=s&&p.bottom>=a){s=Math.max(p.bottom,s),a=Math.min(p.top,a);let b=p.left>t.left?p.left-t.left:p.right<t.left?t.left-p.right:0;if(b<n){e=d,n=b,i=b&&e.nodeType==3?{left:p.right<t.left?p.right:p.left,top:t.top}:t,d.nodeType==1&&b&&(r=h+(t.left>=(p.left+p.right)/2?1:0));continue}}else p.top>t.top&&!l&&p.left<=t.left&&p.right>=t.left&&(l=d,c={left:Math.max(p.left,Math.min(p.right,t.left)),top:p.top});!e&&(t.left>=p.right&&t.top>=p.top||t.left>=p.left&&t.top>=p.bottom)&&(r=h+1)}}return!e&&l&&(e=l,i=c,n=0),e&&e.nodeType==3?yp(e,i):!e||n&&e.nodeType==1?{node:o,offset:r}:da(e,i)}function yp(o,t){let e=o.nodeValue.length,n=document.createRange();for(let i=0;i<e;i++){n.setEnd(o,i+1),n.setStart(o,i);let r=qt(n,1);if(r.top!=r.bottom&&Ao(t,r))return{node:o,offset:i+(t.left>=(r.left+r.right)/2?1:0)}}return{node:o,offset:0}}function Ao(o,t){return o.left>=t.left-1&&o.left<=t.right+1&&o.top>=t.top-1&&o.top<=t.bottom+1}function wp(o,t){let e=o.parentNode;return e&&/^li$/i.test(e.nodeName)&&t.left<o.getBoundingClientRect().left?e:o}function vp(o,t,e){let{node:n,offset:i}=da(t,e),r=-1;if(n.nodeType==1&&!n.firstChild){let s=n.getBoundingClientRect();r=s.left!=s.right&&e.left>(s.left+s.right)/2?1:-1}return o.docView.posFromDOM(n,i,r)}function kp(o,t,e,n){let i=-1;for(let r=t,s=!1;r!=o.dom;){let a=o.docView.nearestDesc(r,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&(!s&&l.left>n.left||l.top>n.top?i=a.posBefore:(!s&&l.right<n.left||l.bottom<n.top)&&(i=a.posAfter),s=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;r=a.dom.parentNode}return i>-1?i:o.docView.posFromDOM(t,e,-1)}function ha(o,t,e){let n=o.childNodes.length;if(n&&e.top<e.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(t.top-e.top)/(e.bottom-e.top))-2)),r=i;;){let s=o.childNodes[r];if(s.nodeType==1){let a=s.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(Ao(t,c))return ha(s,t,c)}}if((r=(r+1)%n)==i)break}return o}function xp(o,t){let e=o.dom.ownerDocument,n,i=0,r=hp(e,t.left,t.top);r&&({node:n,offset:i}=r);let s=(o.root.elementFromPoint?o.root:e).elementFromPoint(t.left,t.top),a;if(!s||!o.dom.contains(s.nodeType!=1?s.parentNode:s)){let c=o.dom.getBoundingClientRect();if(!Ao(t,c)||(s=ha(o.dom,t,c),!s))return null}if(Z)for(let c=s;n&&c;c=Me(c))c.draggable&&(n=void 0);if(s=wp(s,t),n){if(yt&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let d=n.childNodes[i],h;d.nodeName=="IMG"&&(h=d.getBoundingClientRect()).right<=t.left&&h.bottom>t.top&&i++}let c;Ue&&i&&n.nodeType==1&&(c=n.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=t.top&&i--,n==o.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&t.top>n.lastChild.getBoundingClientRect().bottom?a=o.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(a=kp(o,n,i,t))}a==null&&(a=vp(o,s,t));let l=o.docView.nearestDesc(s,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function ua(o){return o.top<o.bottom||o.left<o.right}function qt(o,t){let e=o.getClientRects();if(e.length){let n=e[t<0?0:e.length-1];if(ua(n))return n}return Array.prototype.find.call(e,ua)||o.getBoundingClientRect()}const Sp=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function pa(o,t,e){let{node:n,offset:i,atom:r}=o.docView.domFromPos(t,e<0?-1:1),s=Ue||yt;if(n.nodeType==3)if(s&&(Sp.test(n.nodeValue)||(e<0?!i:i==n.nodeValue.length))){let a=qt(Bt(n,i,i),e);if(yt&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let l=qt(Bt(n,i-1,i-1),-1);if(l.top==a.top){let c=qt(Bt(n,i,i+1),-1);if(c.top!=a.top)return Ke(c,c.left<l.left)}}return a}else{let a=i,l=i,c=e<0?1:-1;return e<0&&!i?(l++,c=-1):e>=0&&i==n.nodeValue.length?(a--,c=1):e<0?a--:l++,Ke(qt(Bt(n,a,l),c),c<0)}if(!o.state.doc.resolve(t-(r||0)).parent.inlineContent){if(r==null&&i&&(e<0||i==gt(n))){let a=n.childNodes[i-1];if(a.nodeType==1)return Eo(a.getBoundingClientRect(),!1)}if(r==null&&i<gt(n)){let a=n.childNodes[i];if(a.nodeType==1)return Eo(a.getBoundingClientRect(),!0)}return Eo(n.getBoundingClientRect(),e>=0)}if(r==null&&i&&(e<0||i==gt(n))){let a=n.childNodes[i-1],l=a.nodeType==3?Bt(a,gt(a)-(s?0:1)):a.nodeType==1&&(a.nodeName!="BR"||!a.nextSibling)?a:null;if(l)return Ke(qt(l,1),!1)}if(r==null&&i<gt(n)){let a=n.childNodes[i];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let l=a?a.nodeType==3?Bt(a,0,s?0:1):a.nodeType==1?a:null:null;if(l)return Ke(qt(l,-1),!0)}return Ke(qt(n.nodeType==3?Bt(n):n,-e),e>=0)}function Ke(o,t){if(o.width==0)return o;let e=t?o.left:o.right;return{top:o.top,bottom:o.bottom,left:e,right:e}}function Eo(o,t){if(o.height==0)return o;let e=t?o.top:o.bottom;return{top:e,bottom:e,left:o.left,right:o.right}}function fa(o,t,e){let n=o.state,i=o.root.activeElement;n!=t&&o.updateState(t),i!=o.dom&&o.focus();try{return e()}finally{n!=t&&o.updateState(n),i!=o.dom&&i&&i.focus()}}function Cp(o,t,e){let n=t.selection,i=e=="up"?n.$from:n.$to;return fa(o,t,()=>{let{node:r}=o.docView.domFromPos(i.pos,e=="up"?-1:1);for(;;){let a=o.docView.nearestDesc(r,!0);if(!a)break;if(a.node.isBlock){r=a.contentDOM||a.dom;break}r=a.dom.parentNode}let s=pa(o,i.pos,1);for(let a=r.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Bt(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let d=l[c];if(d.bottom>d.top+1&&(e=="up"?s.top-d.top>(d.bottom-s.top)*2:d.bottom-s.bottom>(s.bottom-d.top)*2))return!1}}return!0})}const Mp=/[\u0590-\u08ac]/;function Op(o,t,e){let{$head:n}=t.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,r=!i,s=i==n.parent.content.size,a=o.domSelection();return a?!Mp.test(n.parent.textContent)||!a.modify?e=="left"||e=="backward"?r:s:fa(o,t,()=>{let{focusNode:l,focusOffset:c,anchorNode:d,anchorOffset:h}=o.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",e,"character");let g=n.depth?o.docView.domAfterPos(n.before()):o.dom,{focusNode:p,focusOffset:b}=o.domSelectionRange(),y=p&&!g.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==b;try{a.collapse(d,h),l&&(l!=d||c!=h)&&a.extend&&a.extend(l,c)}catch{}return f!=null&&(a.caretBidiLevel=f),y}):n.pos==n.start()||n.pos==n.end()}let ga=null,ma=null,ba=!1;function Np(o,t,e){return ga==t&&ma==e?ba:(ga=t,ma=e,ba=e=="up"||e=="down"?Cp(o,t,e):Op(o,t,e))}const bt=0,_a=1,pe=2,Ot=3;class Ge{constructor(t,e,n,i){this.parent=t,this.children=e,this.dom=n,this.contentDOM=i,this.dirty=bt,n.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,n){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,n=this.posAtStart;;e++){let i=this.children[e];if(i==t)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,n){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(n<0){let r,s;if(t==this.contentDOM)r=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;r=t.previousSibling}for(;r&&!((s=r.pmViewDesc)&&s.parent==this);)r=r.previousSibling;return r?this.posBeforeChild(s)+s.size:this.posAtStart}else{let r,s;if(t==this.contentDOM)r=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;r=t.nextSibling}for(;r&&!((s=r.pmViewDesc)&&s.parent==this);)r=r.nextSibling;return r?this.posBeforeChild(s):this.posAtEnd}let i;if(t==this.dom&&this.contentDOM)i=e>U(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(e==0)for(let r=t;;r=r.parentNode){if(r==this.dom){i=!1;break}if(r.previousSibling)break}if(i==null&&e==t.childNodes.length)for(let r=t;;r=r.parentNode){if(r==this.dom){i=!0;break}if(r.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let n=!0,i=t;i;i=i.parentNode){let r=this.getDesc(i),s;if(r&&(!e||r.node))if(n&&(s=r.nodeDOM)&&!(s.nodeType==1?s.contains(t.nodeType==1?t:t.parentNode):s==t))n=!1;else return r}}getDesc(t){let e=t.pmViewDesc;for(let n=e;n;n=n.parent)if(n==this)return e}posFromDOM(t,e,n){for(let i=t;i;i=i.parentNode){let r=this.getDesc(i);if(r)return r.localPosFromDOM(t,e,n)}return-1}descAt(t){for(let e=0,n=0;e<this.children.length;e++){let i=this.children[e],r=n+i.size;if(n==t&&r!=n){for(;!i.border&&i.children.length;)for(let s=0;s<i.children.length;s++){let a=i.children[s];if(a.size){i=a;break}}return i}if(t<r)return i.descAt(t-n-i.border);n=r}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let n=0,i=0;for(let r=0;n<this.children.length;n++){let s=this.children[n],a=r+s.size;if(a>t||s instanceof va){i=t-r;break}r=a}if(i)return this.children[n].domFromPos(i-this.children[n].border,e);for(let r;n&&!(r=this.children[n-1]).size&&r instanceof ya&&r.side>=0;n--);if(e<=0){let r,s=!0;for(;r=n?this.children[n-1]:null,!(!r||r.dom.parentNode==this.contentDOM);n--,s=!1);return r&&e&&s&&!r.border&&!r.domAtom?r.domFromPos(r.size,e):{node:this.contentDOM,offset:r?U(r.dom)+1:0}}else{let r,s=!0;for(;r=n<this.children.length?this.children[n]:null,!(!r||r.dom.parentNode==this.contentDOM);n++,s=!1);return r&&s&&!r.border&&!r.domAtom?r.domFromPos(0,e):{node:this.contentDOM,offset:r?U(r.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,n=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,r=-1;for(let s=n,a=0;;a++){let l=this.children[a],c=s+l.size;if(i==-1&&t<=c){let d=s+l.border;if(t>=d&&e<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(t,e,d);t=s;for(let h=a;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){i=U(f.dom)+1;break}t-=f.size}i==-1&&(i=0)}if(i>-1&&(c>e||a==this.children.length-1)){e=c;for(let d=a+1;d<this.children.length;d++){let h=this.children[d];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){r=U(h.dom);break}e+=h.size}r==-1&&(r=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:t,to:e,fromOffset:i,toOffset:r}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return e.size==0||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:n}=this.domFromPos(t,0);if(e.nodeType!=1||n==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[n]}setSelection(t,e,n,i=!1){let r=Math.min(t,e),s=Math.max(t,e);for(let g=0,p=0;g<this.children.length;g++){let b=this.children[g],y=p+b.size;if(r>p&&s<y)return b.setSelection(t-p-b.border,e-p-b.border,n,i);p=y}let a=this.domFromPos(t,t?-1:1),l=e==t?a:this.domFromPos(e,e?-1:1),c=n.root.getSelection(),d=n.domSelectionRange(),h=!1;if((yt||Z)&&t==e){let{node:g,offset:p}=a;if(g.nodeType==3){if(h=!!(p&&g.nodeValue[p-1]==`
`),h&&p==g.nodeValue.length)for(let b=g,y;b;b=b.parentNode){if(y=b.nextSibling){y.nodeName=="BR"&&(a=l={node:y.parentNode,offset:U(y)+1});break}let k=b.pmViewDesc;if(k&&k.node&&k.node.isBlock)break}}else{let b=g.childNodes[p-1];h=b&&(b.nodeName=="BR"||b.contentEditable=="false")}}if(yt&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let g=d.focusNode.childNodes[d.focusOffset];g&&g.contentEditable=="false"&&(i=!0)}if(!(i||h&&Z)&&he(a.node,a.offset,d.anchorNode,d.anchorOffset)&&he(l.node,l.offset,d.focusNode,d.focusOffset))return;let f=!1;if((c.extend||t==e)&&!h){c.collapse(a.node,a.offset);try{t!=e&&c.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(t>e){let p=a;a=l,l=p}let g=document.createRange();g.setEnd(l.node,l.offset),g.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(g)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let n=0,i=0;i<this.children.length;i++){let r=this.children[i],s=n+r.size;if(n==s?t<=s&&e>=n:t<s&&e>n){let a=n+r.border,l=s-r.border;if(t>=a&&e<=l){this.dirty=t==n||e==s?pe:_a,t==a&&e==l&&(r.contentLost||r.dom.parentNode!=this.contentDOM)?r.dirty=Ot:r.markDirty(t-a,e-a);return}else r.dirty=r.dom==r.contentDOM&&r.dom.parentNode==this.contentDOM&&!r.children.length?pe:Ot}n=s}this.dirty=pe}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let n=t==1?pe:_a;e.dirty<n&&(e.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(t){return!1}}class ya extends Ge{constructor(t,e,n,i){let r,s=e.type.toDOM;if(typeof s=="function"&&(s=s(n,()=>{if(!r)return i;if(r.parent)return r.parent.posBeforeChild(r)})),!e.type.spec.raw){if(s.nodeType!=1){let a=document.createElement("span");a.appendChild(s),s=a}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(t,[],s,null),this.widget=e,this.widget=e,r=this}matchesWidget(t){return this.dirty==bt&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return e?e(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class Dp extends Ge{constructor(t,e,n,i){super(t,[],e,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}}class fe extends Ge{constructor(t,e,n,i,r){super(t,[],n,i),this.mark=e,this.spec=r}static create(t,e,n,i){let r=i.nodeViews[e.type.name],s=r&&r(e,i,n);return(!s||!s.dom)&&(s=ve.renderSpec(document,e.type.spec.toDOM(e,n),null,e.attrs)),new fe(t,e,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&Ot||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=Ot&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),this.dirty!=bt){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=bt}}slice(t,e,n){let i=fe.create(this.parent,this.mark,!0,n),r=this.children,s=this.size;e<s&&(r=Ro(r,e,s,n)),t>0&&(r=Ro(r,0,t,n));for(let a=0;a<r.length;a++)r[a].parent=i;return i.children=r,i}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Ht extends Ge{constructor(t,e,n,i,r,s,a,l,c){super(t,[],r,s),this.node=e,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=a}static create(t,e,n,i,r,s){let a=r.nodeViews[e.type.name],l,c=a&&a(e,r,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},n,i),d=c&&c.dom,h=c&&c.contentDOM;if(e.isText){if(!d)d=document.createTextNode(e.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:h}=ve.renderSpec(document,e.type.spec.toDOM(e),null,e.attrs));!h&&!e.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),e.type.spec.draggable&&(d.draggable=!0));let f=d;return d=Sa(d,n,e),c?l=new Ip(t,e,n,i,d,h||null,f,c,r,s+1):e.isText?new Bn(t,e,n,i,d,f,r):new Ht(t,e,n,i,d,h||null,f,r,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let e=this.children.length-1;e>=0;e--){let n=this.children[e];if(this.dom.contains(n.dom.parentNode)){t.contentElement=n.dom.parentNode;break}}t.contentElement||(t.getContent=()=>x.empty)}return t}matchesNode(t,e,n){return this.dirty==bt&&t.eq(this.node)&&Rn(e,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let n=this.node.inlineContent,i=e,r=t.composing?this.localCompositionInfo(t,e):null,s=r&&r.pos>-1?r:null,a=r&&r.pos<0,l=new Ap(this,s&&s.node,t);Rp(this.node,this.innerDeco,(c,d,h)=>{c.spec.marks?l.syncToMarks(c.spec.marks,n,t):c.type.side>=0&&!h&&l.syncToMarks(d==this.node.childCount?B.none:this.node.child(d).marks,n,t),l.placeWidget(c,t,i)},(c,d,h,f)=>{l.syncToMarks(c.marks,n,t);let g;l.findNodeMatch(c,d,h,f)||a&&t.state.selection.from>i&&t.state.selection.to<i+c.nodeSize&&(g=l.findIndexWithChild(r.node))>-1&&l.updateNodeAt(c,d,h,g,t)||l.updateNextNode(c,d,h,t,f,i)||l.addNode(c,d,h,t,i),i+=c.nodeSize}),l.syncToMarks([],n,t),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==pe)&&(s&&this.protectLocalComposition(t,s),ka(this.contentDOM,this.children,t),Oe&&Pp(this.dom))}localCompositionInfo(t,e){let{from:n,to:i}=t.state.selection;if(!(t.state.selection instanceof z)||n<e||i>e+this.node.content.size)return null;let r=t.input.compositionNode;if(!r||!this.dom.contains(r.parentNode))return null;if(this.node.inlineContent){let s=r.nodeValue,a=zp(this.node.content,s,n-e,i-e);return a<0?null:{node:r,pos:a,text:s}}else return{node:r,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:n,text:i}){if(this.getDesc(e))return;let r=e;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let s=new Dp(this,r,e,i);t.input.compositionNodes.push(s),this.children=Ro(this.children,n,n+i.length,t,s)}update(t,e,n,i){return this.dirty==Ot||!t.sameMarkup(this.node)?!1:(this.updateInner(t,e,n,i),!0)}updateInner(t,e,n,i){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=bt}updateOuterDeco(t){if(Rn(t,this.outerDeco))return;let e=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=xa(this.dom,this.nodeDOM,Bo(this.outerDeco,this.node,e),Bo(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function wa(o,t,e,n,i){Sa(n,t,o);let r=new Ht(void 0,o,t,e,n,n,n,i,0);return r.contentDOM&&r.updateChildren(i,0),r}class Bn extends Ht{constructor(t,e,n,i,r,s,a){super(t,e,n,i,r,null,s,a,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,n,i){return this.dirty==Ot||this.dirty!=bt&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(e),(this.dirty!=bt||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=t,this.dirty=bt,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,n){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,n)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,e,n){let i=this.node.cut(t,e),r=document.createTextNode(i.text);return new Bn(this.parent,i,this.outerDeco,this.innerDeco,r,r,n)}markDirty(t,e){super.markDirty(t,e),this.dom!=this.nodeDOM&&(t==0||e==this.nodeDOM.nodeValue.length)&&(this.dirty=Ot)}get domAtom(){return!1}isText(t){return this.node.text==t}}class va extends Ge{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==bt&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class Ip extends Ht{constructor(t,e,n,i,r,s,a,l,c,d){super(t,e,n,i,r,s,a,c,d),this.spec=l}update(t,e,n,i){if(this.dirty==Ot)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let r=this.spec.update(t,e,n);return r&&this.updateInner(t,e,n,i),r}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,e,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,n,i){this.spec.setSelection?this.spec.setSelection(t,e,n.root):super.setSelection(t,e,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function ka(o,t,e){let n=o.firstChild,i=!1;for(let r=0;r<t.length;r++){let s=t[r],a=s.dom;if(a.parentNode==o){for(;a!=n;)n=Ca(n),i=!0;n=n.nextSibling}else i=!0,o.insertBefore(a,n);if(s instanceof fe){let l=n?n.previousSibling:o.lastChild;ka(s.contentDOM,s.children,e),n=l?l.nextSibling:o.firstChild}}for(;n;)n=Ca(n),i=!0;i&&e.trackWrites==o&&(e.trackWrites=null)}const Xe=function(o){o&&(this.nodeName=o)};Xe.prototype=Object.create(null);const ge=[new Xe];function Bo(o,t,e){if(o.length==0)return ge;let n=e?ge[0]:new Xe,i=[n];for(let r=0;r<o.length;r++){let s=o[r].type.attrs;if(s){s.nodeName&&i.push(n=new Xe(s.nodeName));for(let a in s){let l=s[a];l!=null&&(e&&i.length==1&&i.push(n=new Xe(t.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return i}function xa(o,t,e,n){if(e==ge&&n==ge)return t;let i=t;for(let r=0;r<n.length;r++){let s=n[r],a=e[r];if(r){let l;a&&a.nodeName==s.nodeName&&i!=o&&(l=i.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=ge[0]),i=l}Tp(i,a||ge[0],s)}return i}function Tp(o,t,e){for(let n in t)n!="class"&&n!="style"&&n!="nodeName"&&!(n in e)&&o.removeAttribute(n);for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&e[n]!=t[n]&&o.setAttribute(n,e[n]);if(t.class!=e.class){let n=t.class?t.class.split(" ").filter(Boolean):[],i=e.class?e.class.split(" ").filter(Boolean):[];for(let r=0;r<n.length;r++)i.indexOf(n[r])==-1&&o.classList.remove(n[r]);for(let r=0;r<i.length;r++)n.indexOf(i[r])==-1&&o.classList.add(i[r]);o.classList.length==0&&o.removeAttribute("class")}if(t.style!=e.style){if(t.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(t.style);)o.style.removeProperty(i[1])}e.style&&(o.style.cssText+=e.style)}}function Sa(o,t,e){return xa(o,o,ge,Bo(t,e,o.nodeType!=1))}function Rn(o,t){if(o.length!=t.length)return!1;for(let e=0;e<o.length;e++)if(!o[e].type.eq(t[e].type))return!1;return!0}function Ca(o){let t=o.nextSibling;return o.parentNode.removeChild(o),t}class Ap{constructor(t,e,n){this.lock=e,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=Ep(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,n){let i=0,r=this.stack.length>>1,s=Math.min(r,t.length);for(;i<s&&(i==r-1?this.top:this.stack[i+1<<1]).matchesMark(t[i])&&t[i].type.spec.spanning!==!1;)i++;for(;i<r;)this.destroyRest(),this.top.dirty=bt,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<t.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(t[r])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=fe.create(this.top,t[r],e,n);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,r++}}findNodeMatch(t,e,n,i){let r=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(t,e,n))r=this.top.children.indexOf(s,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(t,e,n)&&!this.preMatch.matched.has(c)){r=a;break}}return r<0?!1:(this.destroyBetween(this.index,r),this.index++,!0)}updateNodeAt(t,e,n,i,r){let s=this.top.children[i];return s.dirty==Ot&&s.dom==s.contentDOM&&(s.dirty=pe),s.update(t,e,n,r)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let n=t.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}t=e}}updateNextNode(t,e,n,i,r,s){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Ht){let c=this.preMatch.matched.get(l);if(c!=null&&c!=r)return!1;let d=l.dom,h,f=this.isLocked(d)&&!(t.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==t.text&&l.dirty!=Ot&&Rn(e,l.outerDeco));if(!f&&l.update(t,e,n,i))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(l,t,e,n,i,s)))return this.destroyBetween(this.index,a),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=pe,h.updateChildren(i,s+1),h.dirty=bt),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,n,i,r,s){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!Rn(n,t.outerDeco)||!i.eq(t.innerDeco))return null;let a=Ht.create(this.top,e,n,i,r,s);if(a.contentDOM){a.children=t.children,t.children=[];for(let l of a.children)l.parent=a}return t.destroy(),a}addNode(t,e,n,i,r){let s=Ht.create(this.top,t,e,n,i,r);s.contentDOM&&s.updateChildren(i,r+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(t,e,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(t)&&(t==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let r=new ya(this.top,t,e,n);this.top.children.splice(this.index++,0,r),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof fe;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof Bn)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((Z||X)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let n=document.createElement(t);t=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),t=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new va(this.top,[],n,null);e!=this.top?e.children.push(i):e.children.splice(this.index++,0,i),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}}function Ep(o,t){let e=t,n=e.children.length,i=o.childCount,r=new Map,s=[];t:for(;i>0;){let a;for(;;)if(n){let c=e.children[n-1];if(c instanceof fe)e=c,n=c.children.length;else{a=c,n--;break}}else{if(e==t)break t;n=e.parent.children.indexOf(e),e=e.parent}let l=a.node;if(l){if(l!=o.child(i-1))break;--i,r.set(a,i),s.push(a)}}return{index:i,matched:r,matches:s.reverse()}}function Bp(o,t){return o.type.side-t.type.side}function Rp(o,t,e,n){let i=t.locals(o),r=0;if(i.length==0){for(let c=0;c<o.childCount;c++){let d=o.child(c);n(d,i,t.forChild(r,d),c),r+=d.nodeSize}return}let s=0,a=[],l=null;for(let c=0;;){let d,h;for(;s<i.length&&i[s].to==r;){let y=i[s++];y.widget&&(d?(h||(h=[d])).push(y):d=y)}if(d)if(h){h.sort(Bp);for(let y=0;y<h.length;y++)e(h[y],c,!!l)}else e(d,c,!!l);let f,g;if(l)g=-1,f=l,l=null;else if(c<o.childCount)g=c,f=o.child(c++);else break;for(let y=0;y<a.length;y++)a[y].to<=r&&a.splice(y--,1);for(;s<i.length&&i[s].from<=r&&i[s].to>r;)a.push(i[s++]);let p=r+f.nodeSize;if(f.isText){let y=p;s<i.length&&i[s].from<y&&(y=i[s].from);for(let k=0;k<a.length;k++)a[k].to<y&&(y=a[k].to);y<p&&(l=f.cut(y-r),f=f.cut(0,y-r),p=y,g=-1)}else for(;s<i.length&&i[s].to<p;)s++;let b=f.isInline&&!f.isLeaf?a.filter(y=>!y.inline):a.slice();n(f,b,t.forChild(r,f),g),r=p}}function Pp(o){if(o.nodeName=="UL"||o.nodeName=="OL"){let t=o.style.cssText;o.style.cssText=t+"; list-style: square !important",window.getComputedStyle(o).listStyle,o.style.cssText=t}}function zp(o,t,e,n){for(let i=0,r=0;i<o.childCount&&r<=n;){let s=o.child(i++),a=r;if(r+=s.nodeSize,!s.isText)continue;let l=s.text;for(;i<o.childCount;){let c=o.child(i++);if(r+=c.nodeSize,!c.isText)break;l+=c.text}if(r>=e){if(r>=n&&l.slice(n-t.length-a,n-a)==t)return n-t.length;let c=a<n?l.lastIndexOf(t,n-a-1):-1;if(c>=0&&c+t.length+a>=e)return a+c;if(e==n&&l.length>=n+t.length-a&&l.slice(n-a,n-a+t.length)==t)return n}}return-1}function Ro(o,t,e,n,i){let r=[];for(let s=0,a=0;s<o.length;s++){let l=o[s],c=a,d=a+=l.size;c>=e||d<=t?r.push(l):(c<t&&r.push(l.slice(0,t-c,n)),i&&(r.push(i),i=void 0),d>e&&r.push(l.slice(e-c,l.size,n)))}return r}function Po(o,t=null){let e=o.domSelectionRange(),n=o.state.doc;if(!e.focusNode)return null;let i=o.docView.nearestDesc(e.focusNode),r=i&&i.size==0,s=o.docView.posFromDOM(e.focusNode,e.focusOffset,1);if(s<0)return null;let a=n.resolve(s),l,c;if(En(e)){for(l=s;i&&!i.node;)i=i.parent;let h=i.node;if(i&&h.isAtom&&T.isSelectable(h)&&i.parent&&!(h.isInline&&cp(e.focusNode,e.focusOffset,i.dom))){let f=i.posBefore;c=new T(s==f?a:n.resolve(f))}}else{if(e instanceof o.dom.ownerDocument.defaultView.Selection&&e.rangeCount>1){let h=s,f=s;for(let g=0;g<e.rangeCount;g++){let p=e.getRangeAt(g);h=Math.min(h,o.docView.posFromDOM(p.startContainer,p.startOffset,1)),f=Math.max(f,o.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(h<0)return null;[l,s]=f==o.state.selection.anchor?[f,h]:[h,f],a=n.resolve(s)}else l=o.docView.posFromDOM(e.anchorNode,e.anchorOffset,1);if(l<0)return null}let d=n.resolve(l);if(!c){let h=t=="pointer"||o.state.selection.head<a.pos&&!r?1:-1;c=Fo(o,d,a,h)}return c}function Ma(o){return o.editable?o.hasFocus():Ea(o)&&document.activeElement&&document.activeElement.contains(o.dom)}function zt(o,t=!1){let e=o.state.selection;if(Ia(o,e),!!Ma(o)){if(!t&&o.input.mouseDown&&o.input.mouseDown.allowDefault&&X){let n=o.domSelectionRange(),i=o.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&he(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){o.input.mouseDown.delayedSelectionSync=!0,o.domObserver.setCurSelection();return}}if(o.domObserver.disconnectSelection(),o.cursorWrapper)$p(o);else{let{anchor:n,head:i}=e,r,s;Oa&&!(e instanceof z)&&(e.$from.parent.inlineContent||(r=Na(o,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(s=Na(o,e.to))),o.docView.setSelection(n,i,o,t),Oa&&(r&&Da(r),s&&Da(s)),e.visible?o.dom.classList.remove("ProseMirror-hideselection"):(o.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Fp(o))}o.domObserver.setCurSelection(),o.domObserver.connectSelection()}}const Oa=Z||X&&sa<63;function Na(o,t){let{node:e,offset:n}=o.docView.domFromPos(t,0),i=n<e.childNodes.length?e.childNodes[n]:null,r=n?e.childNodes[n-1]:null;if(Z&&i&&i.contentEditable=="false")return zo(i);if((!i||i.contentEditable=="false")&&(!r||r.contentEditable=="false")){if(i)return zo(i);if(r)return zo(r)}}function zo(o){return o.contentEditable="true",Z&&o.draggable&&(o.draggable=!1,o.wasDraggable=!0),o}function Da(o){o.contentEditable="false",o.wasDraggable&&(o.draggable=!0,o.wasDraggable=null)}function Fp(o){let t=o.dom.ownerDocument;t.removeEventListener("selectionchange",o.input.hideSelectionGuard);let e=o.domSelectionRange(),n=e.anchorNode,i=e.anchorOffset;t.addEventListener("selectionchange",o.input.hideSelectionGuard=()=>{(e.anchorNode!=n||e.anchorOffset!=i)&&(t.removeEventListener("selectionchange",o.input.hideSelectionGuard),setTimeout(()=>{(!Ma(o)||o.state.selection.visible)&&o.dom.classList.remove("ProseMirror-hideselection")},20))})}function $p(o){let t=o.domSelection(),e=document.createRange();if(!t)return;let n=o.cursorWrapper.dom,i=n.nodeName=="IMG";i?e.setStart(n.parentNode,U(n)+1):e.setStart(n,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),!i&&!o.state.selection.visible&&nt&&Jt<=11&&(n.disabled=!0,n.disabled=!1)}function Ia(o,t){if(t instanceof T){let e=o.docView.descAt(t.from);e!=o.lastSelectedViewDesc&&(Ta(o),e&&e.selectNode(),o.lastSelectedViewDesc=e)}else Ta(o)}function Ta(o){o.lastSelectedViewDesc&&(o.lastSelectedViewDesc.parent&&o.lastSelectedViewDesc.deselectNode(),o.lastSelectedViewDesc=void 0)}function Fo(o,t,e,n){return o.someProp("createSelectionBetween",i=>i(o,t,e))||z.between(t,e,n)}function Aa(o){return o.editable&&!o.hasFocus()?!1:Ea(o)}function Ea(o){let t=o.domSelectionRange();if(!t.anchorNode)return!1;try{return o.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(o.editable||o.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function Vp(o){let t=o.docView.domFromPos(o.state.selection.anchor,0),e=o.domSelectionRange();return he(t.node,t.offset,e.anchorNode,e.anchorOffset)}function $o(o,t){let{$anchor:e,$head:n}=o.selection,i=t>0?e.max(n):e.min(n),r=i.parent.inlineContent?i.depth?o.doc.resolve(t>0?i.after():i.before()):null:i;return r&&E.findFrom(r,t)}function Ut(o,t){return o.dispatch(o.state.tr.setSelection(t).scrollIntoView()),!0}function Ba(o,t,e){let n=o.state.selection;if(n instanceof z)if(e.indexOf("s")>-1){let{$head:i}=n,r=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter;if(!r||r.isText||!r.isLeaf)return!1;let s=o.state.doc.resolve(i.pos+r.nodeSize*(t<0?-1:1));return Ut(o,new z(n.$anchor,s))}else if(n.empty){if(o.endOfTextblock(t>0?"forward":"backward")){let i=$o(o.state,t);return i&&i instanceof T?Ut(o,i):!1}else if(!(mt&&e.indexOf("m")>-1)){let i=n.$head,r=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter,s;if(!r||r.isText)return!1;let a=t<0?i.pos-r.nodeSize:i.pos;return r.isAtom||(s=o.docView.descAt(a))&&!s.contentDOM?T.isSelectable(r)?Ut(o,new T(t<0?o.state.doc.resolve(i.pos-r.nodeSize):i)):Ue?Ut(o,new z(o.state.doc.resolve(t<0?a:a+r.nodeSize))):!1:!1}}else return!1;else{if(n instanceof T&&n.node.isInline)return Ut(o,new z(t>0?n.$to:n.$from));{let i=$o(o.state,t);return i?Ut(o,i):!1}}}function Pn(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function Qe(o,t){let e=o.pmViewDesc;return e&&e.size==0&&(t<0||o.nextSibling||o.nodeName!="BR")}function De(o,t){return t<0?Lp(o):jp(o)}function Lp(o){let t=o.domSelectionRange(),e=t.focusNode,n=t.focusOffset;if(!e)return;let i,r,s=!1;for(yt&&e.nodeType==1&&n<Pn(e)&&Qe(e.childNodes[n],-1)&&(s=!0);;)if(n>0){if(e.nodeType!=1)break;{let a=e.childNodes[n-1];if(Qe(a,-1))i=e,r=--n;else if(a.nodeType==3)e=a,n=e.nodeValue.length;else break}}else{if(Ra(e))break;{let a=e.previousSibling;for(;a&&Qe(a,-1);)i=e.parentNode,r=U(a),a=a.previousSibling;if(a)e=a,n=Pn(e);else{if(e=e.parentNode,e==o.dom)break;n=0}}}s?Vo(o,e,n):i&&Vo(o,i,r)}function jp(o){let t=o.domSelectionRange(),e=t.focusNode,n=t.focusOffset;if(!e)return;let i=Pn(e),r,s;for(;;)if(n<i){if(e.nodeType!=1)break;let a=e.childNodes[n];if(Qe(a,1))r=e,s=++n;else break}else{if(Ra(e))break;{let a=e.nextSibling;for(;a&&Qe(a,1);)r=a.parentNode,s=U(a)+1,a=a.nextSibling;if(a)e=a,n=0,i=Pn(e);else{if(e=e.parentNode,e==o.dom)break;n=i=0}}}r&&Vo(o,r,s)}function Ra(o){let t=o.pmViewDesc;return t&&t.node&&t.node.isBlock}function Wp(o,t){for(;o&&t==o.childNodes.length&&!He(o);)t=U(o)+1,o=o.parentNode;for(;o&&t<o.childNodes.length;){let e=o.childNodes[t];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;o=e,t=0}}function Jp(o,t){for(;o&&!t&&!He(o);)t=U(o),o=o.parentNode;for(;o&&t;){let e=o.childNodes[t-1];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;o=e,t=o.childNodes.length}}function Vo(o,t,e){if(t.nodeType!=3){let r,s;(s=Wp(t,e))?(t=s,e=0):(r=Jp(t,e))&&(t=r,e=r.nodeValue.length)}let n=o.domSelection();if(!n)return;if(En(n)){let r=document.createRange();r.setEnd(t,e),r.setStart(t,e),n.removeAllRanges(),n.addRange(r)}else n.extend&&n.extend(t,e);o.domObserver.setCurSelection();let{state:i}=o;setTimeout(()=>{o.state==i&&zt(o)},50)}function Pa(o,t){let e=o.state.doc.resolve(t);if(!(X||up)&&e.parent.inlineContent){let n=o.coordsAtPos(t);if(t>e.start()){let i=o.coordsAtPos(t-1),r=(i.top+i.bottom)/2;if(r>n.top&&r<n.bottom&&Math.abs(i.left-n.left)>1)return i.left<n.left?"ltr":"rtl"}if(t<e.end()){let i=o.coordsAtPos(t+1),r=(i.top+i.bottom)/2;if(r>n.top&&r<n.bottom&&Math.abs(i.left-n.left)>1)return i.left>n.left?"ltr":"rtl"}}return getComputedStyle(o.dom).direction=="rtl"?"rtl":"ltr"}function za(o,t,e){let n=o.state.selection;if(n instanceof z&&!n.empty||e.indexOf("s")>-1||mt&&e.indexOf("m")>-1)return!1;let{$from:i,$to:r}=n;if(!i.parent.inlineContent||o.endOfTextblock(t<0?"up":"down")){let s=$o(o.state,t);if(s&&s instanceof T)return Ut(o,s)}if(!i.parent.inlineContent){let s=t<0?i:r,a=n instanceof st?E.near(s,t):E.findFrom(s,t);return a?Ut(o,a):!1}return!1}function Fa(o,t){if(!(o.state.selection instanceof z))return!0;let{$head:e,$anchor:n,empty:i}=o.state.selection;if(!e.sameParent(n))return!0;if(!i)return!1;if(o.endOfTextblock(t>0?"forward":"backward"))return!0;let r=!e.textOffset&&(t<0?e.nodeBefore:e.nodeAfter);if(r&&!r.isText){let s=o.state.tr;return t<0?s.delete(e.pos-r.nodeSize,e.pos):s.delete(e.pos,e.pos+r.nodeSize),o.dispatch(s),!0}return!1}function $a(o,t,e){o.domObserver.stop(),t.contentEditable=e,o.domObserver.start()}function qp(o){if(!Z||o.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:e}=o.domSelectionRange();if(t&&t.nodeType==1&&e==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let n=t.firstChild;$a(o,n,"true"),setTimeout(()=>$a(o,n,"false"),20)}return!1}function Hp(o){let t="";return o.ctrlKey&&(t+="c"),o.metaKey&&(t+="m"),o.altKey&&(t+="a"),o.shiftKey&&(t+="s"),t}function Up(o,t){let e=t.keyCode,n=Hp(t);if(e==8||mt&&e==72&&n=="c")return Fa(o,-1)||De(o,-1);if(e==46&&!t.shiftKey||mt&&e==68&&n=="c")return Fa(o,1)||De(o,1);if(e==13||e==27)return!0;if(e==37||mt&&e==66&&n=="c"){let i=e==37?Pa(o,o.state.selection.from)=="ltr"?-1:1:-1;return Ba(o,i,n)||De(o,i)}else if(e==39||mt&&e==70&&n=="c"){let i=e==39?Pa(o,o.state.selection.from)=="ltr"?1:-1:1;return Ba(o,i,n)||De(o,i)}else{if(e==38||mt&&e==80&&n=="c")return za(o,-1,n)||De(o,-1);if(e==40||mt&&e==78&&n=="c")return qp(o)||za(o,1,n)||De(o,1);if(n==(mt?"m":"c")&&(e==66||e==73||e==89||e==90))return!0}return!1}function Lo(o,t){o.someProp("transformCopied",g=>{t=g(t,o)});let e=[],{content:n,openStart:i,openEnd:r}=t;for(;i>1&&r>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,r--;let g=n.firstChild;e.push(g.type.name,g.attrs!=g.type.defaultAttrs?g.attrs:null),n=g.content}let s=o.someProp("clipboardSerializer")||ve.fromSchema(o.state.schema),a=Ua(),l=a.createElement("div");l.appendChild(s.serializeFragment(n,{document:a}));let c=l.firstChild,d,h=0;for(;c&&c.nodeType==1&&(d=qa[c.nodeName.toLowerCase()]);){for(let g=d.length-1;g>=0;g--){let p=a.createElement(d[g]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),h++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${r}${h?` -${h}`:""} ${JSON.stringify(e)}`);let f=o.someProp("clipboardTextSerializer",g=>g(t,o))||t.content.textBetween(0,t.content.size,`

`);return{dom:l,text:f,slice:t}}function Va(o,t,e,n,i){let r=i.parent.type.spec.code,s,a;if(!e&&!t)return null;let l=t&&(n||r||!e);if(l){if(o.someProp("transformPastedText",f=>{t=f(t,r||n,o)}),r)return t?new M(x.from(o.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):M.empty;let h=o.someProp("clipboardTextParser",f=>f(t,i,n,o));if(h)a=h;else{let f=i.marks(),{schema:g}=o.state,p=ve.fromSchema(g);s=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(b=>{let y=s.appendChild(document.createElement("p"));b&&y.appendChild(p.serializeNode(g.text(b,f)))})}}else o.someProp("transformPastedHTML",h=>{e=h(e,o)}),s=Qp(e),Ue&&Yp(s);let c=s&&s.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let h=+d[3];h>0;h--){let f=s.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;s=f}if(a||(a=(o.someProp("clipboardParser")||o.someProp("domParser")||Ve.fromSchema(o.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||d),context:i,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!Kp.test(h.parentNode.nodeName)?{ignore:!0}:null}})),d)a=Zp(Ja(a,+d[1],+d[2]),d[4]);else if(a=M.maxOpen(Gp(a.content,i),!0),a.openStart||a.openEnd){let h=0,f=0;for(let g=a.content.firstChild;h<a.openStart&&!g.type.spec.isolating;h++,g=g.firstChild);for(let g=a.content.lastChild;f<a.openEnd&&!g.type.spec.isolating;f++,g=g.lastChild);a=Ja(a,h,f)}return o.someProp("transformPasted",h=>{a=h(a,o)}),a}const Kp=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Gp(o,t){if(o.childCount<2)return o;for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.index(e)),i,r=[];if(o.forEach(s=>{if(!r)return;let a=n.findWrapping(s.type),l;if(!a)return r=null;if(l=r.length&&i.length&&ja(a,i,s,r[r.length-1],0))r[r.length-1]=l;else{r.length&&(r[r.length-1]=Wa(r[r.length-1],i.length));let c=La(s,a);r.push(c),n=n.matchType(c.type),i=a}}),r)return x.from(r)}return o}function La(o,t,e=0){for(let n=t.length-1;n>=e;n--)o=t[n].create(null,x.from(o));return o}function ja(o,t,e,n,i){if(i<o.length&&i<t.length&&o[i]==t[i]){let r=ja(o,t,e,n.lastChild,i+1);if(r)return n.copy(n.content.replaceChild(n.childCount-1,r));if(n.contentMatchAt(n.childCount).matchType(i==o.length-1?e.type:o[i+1]))return n.copy(n.content.append(x.from(La(e,o,i+1))))}}function Wa(o,t){if(t==0)return o;let e=o.content.replaceChild(o.childCount-1,Wa(o.lastChild,t-1)),n=o.contentMatchAt(o.childCount).fillBefore(x.empty,!0);return o.copy(e.append(n))}function jo(o,t,e,n,i,r){let s=t<0?o.firstChild:o.lastChild,a=s.content;return o.childCount>1&&(r=0),i<n-1&&(a=jo(a,t,e,n,i+1,r)),i>=e&&(a=t<0?s.contentMatchAt(0).fillBefore(a,r<=i).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(x.empty,!0))),o.replaceChild(t<0?0:o.childCount-1,s.copy(a))}function Ja(o,t,e){return t<o.openStart&&(o=new M(jo(o.content,-1,t,o.openStart,0,o.openEnd),t,o.openEnd)),e<o.openEnd&&(o=new M(jo(o.content,1,e,o.openEnd,0,0),o.openStart,e)),o}const qa={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Ha=null;function Ua(){return Ha||(Ha=document.implementation.createHTMLDocument("title"))}let Wo=null;function Xp(o){let t=window.trustedTypes;return t?(Wo||(Wo=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e})),Wo.createHTML(o)):o}function Qp(o){let t=/^(\s*<meta [^>]*>)*/.exec(o);t&&(o=o.slice(t[0].length));let e=Ua().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(o),i;if((i=n&&qa[n[1].toLowerCase()])&&(o=i.map(r=>"<"+r+">").join("")+o+i.map(r=>"</"+r+">").reverse().join("")),e.innerHTML=Xp(o),i)for(let r=0;r<i.length;r++)e=e.querySelector(i[r])||e;return e}function Yp(o){let t=o.querySelectorAll(X?"span:not([class]):not([style])":"span.Apple-converted-space");for(let e=0;e<t.length;e++){let n=t[e];n.childNodes.length==1&&n.textContent=="\xA0"&&n.parentNode&&n.parentNode.replaceChild(o.ownerDocument.createTextNode(" "),n)}}function Zp(o,t){if(!o.size)return o;let e=o.content.firstChild.type.schema,n;try{n=JSON.parse(t)}catch{return o}let{content:i,openStart:r,openEnd:s}=o;for(let a=n.length-2;a>=0;a-=2){let l=e.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;i=x.from(l.create(n[a+1],i)),r++,s++}return new M(i,r,s)}const tt={},et={},tf={touchstart:!0,touchmove:!0};class ef{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function nf(o){for(let t in tt){let e=tt[t];o.dom.addEventListener(t,o.input.eventHandlers[t]=n=>{rf(o,n)&&!qo(o,n)&&(o.editable||!(n.type in et))&&e(o,n)},tf[t]?{passive:!0}:void 0)}Z&&o.dom.addEventListener("input",()=>null),Jo(o)}function Kt(o,t){o.input.lastSelectionOrigin=t,o.input.lastSelectionTime=Date.now()}function of(o){o.domObserver.stop();for(let t in o.input.eventHandlers)o.dom.removeEventListener(t,o.input.eventHandlers[t]);clearTimeout(o.input.composingTimeout),clearTimeout(o.input.lastIOSEnterFallbackTimeout)}function Jo(o){o.someProp("handleDOMEvents",t=>{for(let e in t)o.input.eventHandlers[e]||o.dom.addEventListener(e,o.input.eventHandlers[e]=n=>qo(o,n))})}function qo(o,t){return o.someProp("handleDOMEvents",e=>{let n=e[t.type];return n?n(o,t)||t.defaultPrevented:!1})}function rf(o,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target;e!=o.dom;e=e.parentNode)if(!e||e.nodeType==11||e.pmViewDesc&&e.pmViewDesc.stopEvent(t))return!1;return!0}function sf(o,t){!qo(o,t)&&tt[t.type]&&(o.editable||!(t.type in et))&&tt[t.type](o,t)}et.keydown=(o,t)=>{let e=t;if(o.input.shiftKey=e.keyCode==16||e.shiftKey,!Ga(o,e)&&(o.input.lastKeyCode=e.keyCode,o.input.lastKeyCodeTime=Date.now(),!(Rt&&X&&e.keyCode==13)))if(e.keyCode!=229&&o.domObserver.forceFlush(),Oe&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){let n=Date.now();o.input.lastIOSEnter=n,o.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{o.input.lastIOSEnter==n&&(o.someProp("handleKeyDown",i=>i(o,ue(13,"Enter"))),o.input.lastIOSEnter=0)},200)}else o.someProp("handleKeyDown",n=>n(o,e))||Up(o,e)?e.preventDefault():Kt(o,"key")},et.keyup=(o,t)=>{t.keyCode==16&&(o.input.shiftKey=!1)},et.keypress=(o,t)=>{let e=t;if(Ga(o,e)||!e.charCode||e.ctrlKey&&!e.altKey||mt&&e.metaKey)return;if(o.someProp("handleKeyPress",i=>i(o,e))){e.preventDefault();return}let n=o.state.selection;if(!(n instanceof z)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(e.charCode);!/[\r\n]/.test(i)&&!o.someProp("handleTextInput",r=>r(o,n.$from.pos,n.$to.pos,i))&&o.dispatch(o.state.tr.insertText(i).scrollIntoView()),e.preventDefault()}};function zn(o){return{left:o.clientX,top:o.clientY}}function af(o,t){let e=t.x-o.clientX,n=t.y-o.clientY;return e*e+n*n<100}function Ho(o,t,e,n,i){if(n==-1)return!1;let r=o.state.doc.resolve(n);for(let s=r.depth+1;s>0;s--)if(o.someProp(t,a=>s>r.depth?a(o,e,r.nodeAfter,r.before(s),i,!0):a(o,e,r.node(s),r.before(s),i,!1)))return!0;return!1}function Ie(o,t,e){if(o.focused||o.focus(),o.state.selection.eq(t))return;let n=o.state.tr.setSelection(t);n.setMeta("pointer",!0),o.dispatch(n)}function lf(o,t){if(t==-1)return!1;let e=o.state.doc.resolve(t),n=e.nodeAfter;return n&&n.isAtom&&T.isSelectable(n)?(Ie(o,new T(e)),!0):!1}function cf(o,t){if(t==-1)return!1;let e=o.state.selection,n,i;e instanceof T&&(n=e.node);let r=o.state.doc.resolve(t);for(let s=r.depth+1;s>0;s--){let a=s>r.depth?r.nodeAfter:r.node(s);if(T.isSelectable(a)){n&&e.$from.depth>0&&s>=e.$from.depth&&r.before(e.$from.depth+1)==e.$from.pos?i=r.before(e.$from.depth):i=r.before(s);break}}return i!=null?(Ie(o,T.create(o.state.doc,i)),!0):!1}function df(o,t,e,n,i){return Ho(o,"handleClickOn",t,e,n)||o.someProp("handleClick",r=>r(o,t,n))||(i?cf(o,e):lf(o,e))}function hf(o,t,e,n){return Ho(o,"handleDoubleClickOn",t,e,n)||o.someProp("handleDoubleClick",i=>i(o,t,n))}function uf(o,t,e,n){return Ho(o,"handleTripleClickOn",t,e,n)||o.someProp("handleTripleClick",i=>i(o,t,n))||pf(o,e,n)}function pf(o,t,e){if(e.button!=0)return!1;let n=o.state.doc;if(t==-1)return n.inlineContent?(Ie(o,z.create(n,0,n.content.size)),!0):!1;let i=n.resolve(t);for(let r=i.depth+1;r>0;r--){let s=r>i.depth?i.nodeAfter:i.node(r),a=i.before(r);if(s.inlineContent)Ie(o,z.create(n,a+1,a+1+s.content.size));else if(T.isSelectable(s))Ie(o,T.create(n,a));else continue;return!0}}function Uo(o){return Fn(o)}const Ka=mt?"metaKey":"ctrlKey";tt.mousedown=(o,t)=>{let e=t;o.input.shiftKey=e.shiftKey;let n=Uo(o),i=Date.now(),r="singleClick";i-o.input.lastClick.time<500&&af(e,o.input.lastClick)&&!e[Ka]&&(o.input.lastClick.type=="singleClick"?r="doubleClick":o.input.lastClick.type=="doubleClick"&&(r="tripleClick")),o.input.lastClick={time:i,x:e.clientX,y:e.clientY,type:r};let s=o.posAtCoords(zn(e));s&&(r=="singleClick"?(o.input.mouseDown&&o.input.mouseDown.done(),o.input.mouseDown=new ff(o,s,e,!!n)):(r=="doubleClick"?hf:uf)(o,s.pos,s.inside,e)?e.preventDefault():Kt(o,"pointer"))};class ff{constructor(t,e,n,i){this.view=t,this.pos=e,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!n[Ka],this.allowDefault=n.shiftKey;let r,s;if(e.inside>-1)r=t.state.doc.nodeAt(e.inside),s=e.inside;else{let d=t.state.doc.resolve(e.pos);r=d.parent,s=d.depth?d.before():0}const a=i?null:n.target,l=a?t.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=t.state;(n.button==0&&r.type.spec.draggable&&r.type.spec.selectable!==!1||c instanceof T&&c.from<=s&&c.to>s)&&(this.mightDrag={node:r,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&yt&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),Kt(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>zt(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(zn(t))),this.updateAllowDefault(t),this.allowDefault||!e?Kt(this.view,"pointer"):df(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||Z&&this.mightDrag&&!this.mightDrag.node.isAtom||X&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(Ie(this.view,E.near(this.view.state.doc.resolve(e.pos))),t.preventDefault()):Kt(this.view,"pointer")}move(t){this.updateAllowDefault(t),Kt(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}tt.touchstart=o=>{o.input.lastTouch=Date.now(),Uo(o),Kt(o,"pointer")},tt.touchmove=o=>{o.input.lastTouch=Date.now(),Kt(o,"pointer")},tt.contextmenu=o=>Uo(o);function Ga(o,t){return o.composing?!0:Z&&Math.abs(t.timeStamp-o.input.compositionEndedAt)<500?(o.input.compositionEndedAt=-2e8,!0):!1}const gf=Rt?5e3:-1;et.compositionstart=et.compositionupdate=o=>{if(!o.composing){o.domObserver.flush();let{state:t}=o,e=t.selection.$to;if(t.selection instanceof z&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)))o.markCursor=o.state.storedMarks||e.marks(),Fn(o,!0),o.markCursor=null;else if(Fn(o,!t.selection.empty),yt&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length){let n=o.domSelectionRange();for(let i=n.focusNode,r=n.focusOffset;i&&i.nodeType==1&&r!=0;){let s=r<0?i.lastChild:i.childNodes[r-1];if(!s)break;if(s.nodeType==3){let a=o.domSelection();a&&a.collapse(s,s.nodeValue.length);break}else i=s,r=-1}}o.input.composing=!0}Xa(o,gf)},et.compositionend=(o,t)=>{o.composing&&(o.input.composing=!1,o.input.compositionEndedAt=t.timeStamp,o.input.compositionPendingChanges=o.domObserver.pendingRecords().length?o.input.compositionID:0,o.input.compositionNode=null,o.input.compositionPendingChanges&&Promise.resolve().then(()=>o.domObserver.flush()),o.input.compositionID++,Xa(o,20))};function Xa(o,t){clearTimeout(o.input.composingTimeout),t>-1&&(o.input.composingTimeout=setTimeout(()=>Fn(o),t))}function Qa(o){for(o.composing&&(o.input.composing=!1,o.input.compositionEndedAt=bf());o.input.compositionNodes.length>0;)o.input.compositionNodes.pop().markParentsDirty()}function mf(o){let t=o.domSelectionRange();if(!t.focusNode)return null;let e=ap(t.focusNode,t.focusOffset),n=lp(t.focusNode,t.focusOffset);if(e&&n&&e!=n){let i=n.pmViewDesc,r=o.domObserver.lastChangedTextNode;if(e==r||n==r)return r;if(!i||!i.isText(n.nodeValue))return n;if(o.input.compositionNode==n){let s=e.pmViewDesc;if(!(!s||!s.isText(e.nodeValue)))return n}}return e||n}function bf(){let o=document.createEvent("Event");return o.initEvent("event",!0,!0),o.timeStamp}function Fn(o,t=!1){if(!(Rt&&o.domObserver.flushingSoon>=0)){if(o.domObserver.forceFlush(),Qa(o),t||o.docView&&o.docView.dirty){let e=Po(o);return e&&!e.eq(o.state.selection)?o.dispatch(o.state.tr.setSelection(e)):(o.markCursor||t)&&!o.state.selection.empty?o.dispatch(o.state.tr.deleteSelection()):o.updateState(o.state),!0}return!1}}function _f(o,t){if(!o.dom.parentNode)return;let e=o.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(t),o.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),o.focus()},50)}const Ye=nt&&Jt<15||Oe&&pp<604;tt.copy=et.cut=(o,t)=>{let e=t,n=o.state.selection,i=e.type=="cut";if(n.empty)return;let r=Ye?null:e.clipboardData,s=n.content(),{dom:a,text:l}=Lo(o,s);r?(e.preventDefault(),r.clearData(),r.setData("text/html",a.innerHTML),r.setData("text/plain",l)):_f(o,a),i&&o.dispatch(o.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function yf(o){return o.openStart==0&&o.openEnd==0&&o.content.childCount==1?o.content.firstChild:null}function wf(o,t){if(!o.dom.parentNode)return;let e=o.input.shiftKey||o.state.selection.$from.parent.type.spec.code,n=o.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=o.input.shiftKey&&o.input.lastKeyCode!=45;setTimeout(()=>{o.focus(),n.parentNode&&n.parentNode.removeChild(n),e?Ze(o,n.value,null,i,t):Ze(o,n.textContent,n.innerHTML,i,t)},50)}function Ze(o,t,e,n,i){let r=Va(o,t,e,n,o.state.selection.$from);if(o.someProp("handlePaste",l=>l(o,i,r||M.empty)))return!0;if(!r)return!1;let s=yf(r),a=s?o.state.tr.replaceSelectionWith(s,n):o.state.tr.replaceSelection(r);return o.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Ya(o){let t=o.getData("text/plain")||o.getData("Text");if(t)return t;let e=o.getData("text/uri-list");return e?e.replace(/\r?\n/g," "):""}et.paste=(o,t)=>{let e=t;if(o.composing&&!Rt)return;let n=Ye?null:e.clipboardData,i=o.input.shiftKey&&o.input.lastKeyCode!=45;n&&Ze(o,Ya(n),n.getData("text/html"),i,e)?e.preventDefault():wf(o,e)};class Za{constructor(t,e,n){this.slice=t,this.move=e,this.node=n}}const vf=mt?"altKey":"ctrlKey";function tl(o,t){return o.someProp("dragCopies",n=>!n(t))??!t[vf]}tt.dragstart=(o,t)=>{let e=t,n=o.input.mouseDown;if(n&&n.done(),!e.dataTransfer)return;let i=o.state.selection,r=i.empty?null:o.posAtCoords(zn(e)),s;if(!(r&&r.pos>=i.from&&r.pos<=(i instanceof T?i.to-1:i.to))){if(n&&n.mightDrag)s=T.create(o.state.doc,n.mightDrag.pos);else if(e.target&&e.target.nodeType==1){let h=o.docView.nearestDesc(e.target,!0);h&&h.node.type.spec.draggable&&h!=o.docView&&(s=T.create(o.state.doc,h.posBefore))}}let a=(s||o.state.selection).content(),{dom:l,text:c,slice:d}=Lo(o,a);(!e.dataTransfer.files.length||!X||sa>120)&&e.dataTransfer.clearData(),e.dataTransfer.setData(Ye?"Text":"text/html",l.innerHTML),e.dataTransfer.effectAllowed="copyMove",Ye||e.dataTransfer.setData("text/plain",c),o.dragging=new Za(d,tl(o,e),s)},tt.dragend=o=>{let t=o.dragging;window.setTimeout(()=>{o.dragging==t&&(o.dragging=null)},50)},et.dragover=et.dragenter=(o,t)=>t.preventDefault(),et.drop=(o,t)=>{let e=t,n=o.dragging;if(o.dragging=null,!e.dataTransfer)return;let i=o.posAtCoords(zn(e));if(!i)return;let r=o.state.doc.resolve(i.pos),s=n&&n.slice;s?o.someProp("transformPasted",p=>{s=p(s,o)}):s=Va(o,Ya(e.dataTransfer),Ye?null:e.dataTransfer.getData("text/html"),!1,r);let a=!!(n&&tl(o,e));if(o.someProp("handleDrop",p=>p(o,e,s||M.empty,a))){e.preventDefault();return}if(!s)return;e.preventDefault();let l=s?fu(o.state.doc,r.pos,s):r.pos;l==null&&(l=r.pos);let c=o.state.tr;if(a){let{node:p}=n;p?p.replace(c):c.deleteSelection()}let d=c.mapping.map(l),h=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,f=c.doc;if(h?c.replaceRangeWith(d,d,s.content.firstChild):c.replaceRange(d,d,s),c.doc.eq(f))return;let g=c.doc.resolve(d);if(h&&T.isSelectable(s.content.firstChild)&&g.nodeAfter&&g.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new T(g));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((b,y,k,D)=>p=D),c.setSelection(Fo(o,g,c.doc.resolve(p)))}o.focus(),o.dispatch(c.setMeta("uiEvent","drop"))},tt.focus=o=>{o.input.lastFocus=Date.now(),o.focused||(o.domObserver.stop(),o.dom.classList.add("ProseMirror-focused"),o.domObserver.start(),o.focused=!0,setTimeout(()=>{o.docView&&o.hasFocus()&&!o.domObserver.currentSelection.eq(o.domSelectionRange())&&zt(o)},20))},tt.blur=(o,t)=>{let e=t;o.focused&&(o.domObserver.stop(),o.dom.classList.remove("ProseMirror-focused"),o.domObserver.start(),e.relatedTarget&&o.dom.contains(e.relatedTarget)&&o.domObserver.currentSelection.clear(),o.focused=!1)},tt.beforeinput=(o,t)=>{if(X&&Rt&&t.inputType=="deleteContentBackward"){o.domObserver.flushSoon();let{domChangeCount:e}=o.input;setTimeout(()=>{if(o.input.domChangeCount!=e||(o.dom.blur(),o.focus(),o.someProp("handleKeyDown",i=>i(o,ue(8,"Backspace")))))return;let{$cursor:n}=o.state.selection;n&&n.pos>0&&o.dispatch(o.state.tr.delete(n.pos-1,n.pos).scrollIntoView())},50)}};for(let o in et)tt[o]=et[o];function tn(o,t){if(o==t)return!0;for(let e in o)if(o[e]!==t[e])return!1;for(let e in t)if(!(e in o))return!1;return!0}class $n{constructor(t,e){this.toDOM=t,this.spec=e||me,this.side=this.spec.side||0}map(t,e,n,i){let{pos:r,deleted:s}=t.mapResult(e.from+i,this.side<0?-1:1);return s?null:new wt(r-n,r-n,this)}valid(){return!0}eq(t){return this==t||t instanceof $n&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&tn(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class Gt{constructor(t,e){this.attrs=t,this.spec=e||me}map(t,e,n,i){let r=t.map(e.from+i,this.spec.inclusiveStart?-1:1)-n,s=t.map(e.to+i,this.spec.inclusiveEnd?1:-1)-n;return r>=s?null:new wt(r,s,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof Gt&&tn(this.attrs,t.attrs)&&tn(this.spec,t.spec)}static is(t){return t.type instanceof Gt}destroy(){}}class Ko{constructor(t,e){this.attrs=t,this.spec=e||me}map(t,e,n,i){let r=t.mapResult(e.from+i,1);if(r.deleted)return null;let s=t.mapResult(e.to+i,-1);return s.deleted||s.pos<=r.pos?null:new wt(r.pos-n,s.pos-n,this)}valid(t,e){let{index:n,offset:i}=t.content.findIndex(e.from),r;return i==e.from&&!(r=t.child(n)).isText&&i+r.nodeSize==e.to}eq(t){return this==t||t instanceof Ko&&tn(this.attrs,t.attrs)&&tn(this.spec,t.spec)}destroy(){}}class wt{constructor(t,e,n){this.from=t,this.to=e,this.type=n}copy(t,e){return new wt(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,n){return this.type.map(t,this,e,n)}static widget(t,e,n){return new wt(t,t,new $n(e,n))}static inline(t,e,n,i){return new wt(t,e,new Gt(n,i))}static node(t,e,n,i){return new wt(t,e,new Ko(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Gt}get widget(){return this.type instanceof $n}}const Te=[],me={};class J{constructor(t,e){this.local=t.length?t:Te,this.children=e.length?e:Te}static create(t,e){return e.length?Vn(e,t,0,me):Q}find(t,e,n){let i=[];return this.findInner(t??0,e??1e9,i,0,n),i}findInner(t,e,n,i,r){for(let s=0;s<this.local.length;s++){let a=this.local[s];a.from<=e&&a.to>=t&&(!r||r(a.spec))&&n.push(a.copy(a.from+i,a.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<e&&this.children[s+1]>t){let a=this.children[s]+1;this.children[s+2].findInner(t-a,e-a,n,i+a,r)}}map(t,e,n){return this==Q||t.maps.length==0?this:this.mapInner(t,e,0,0,n||me)}mapInner(t,e,n,i,r){let s;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(t,n,i);l&&l.type.valid(e,l)?(s||(s=[])).push(l):r.onRemove&&r.onRemove(this.local[a].spec)}return this.children.length?kf(this.children,s||[],t,e,n,i,r):s?new J(s.sort(be),Te):Q}add(t,e){return e.length?this==Q?J.create(t,e):this.addInner(t,e,0):this}addInner(t,e,n){let i,r=0;t.forEach((a,l)=>{let c=l+n,d;if(d=nl(e,a,c)){for(i||(i=this.children.slice());r<i.length&&i[r]<l;)r+=3;i[r]==l?i[r+2]=i[r+2].addInner(a,d,c+1):i.splice(r,0,l,l+a.nodeSize,Vn(d,a,c+1,me)),r+=3}});let s=el(r?ol(e):e,-n);for(let a=0;a<s.length;a++)s[a].type.valid(t,s[a])||s.splice(a--,1);return new J(s.length?this.local.concat(s).sort(be):this.local,i||this.children)}remove(t){return t.length==0||this==Q?this:this.removeInner(t,0)}removeInner(t,e){let n=this.children,i=this.local;for(let r=0;r<n.length;r+=3){let s,a=n[r]+e,l=n[r+1]+e;for(let d=0,h;d<t.length;d++)(h=t[d])&&h.from>a&&h.to<l&&(t[d]=null,(s||(s=[])).push(h));if(!s)continue;n==this.children&&(n=this.children.slice());let c=n[r+2].removeInner(s,a+1);c!=Q?n[r+2]=c:(n.splice(r,3),r-=3)}if(i.length){for(let r=0,s;r<t.length;r++)if(s=t[r])for(let a=0;a<i.length;a++)i[a].eq(s,e)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new J(i,n):Q}forChild(t,e){if(this==Q)return this;if(e.isLeaf)return J.empty;let n,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=t){this.children[a]==t&&(n=this.children[a+2]);break}let r=t+1,s=r+e.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<s&&l.to>r&&l.type instanceof Gt){let c=Math.max(r,l.from)-r,d=Math.min(s,l.to)-r;c<d&&(i||(i=[])).push(l.copy(c,d))}}if(i){let a=new J(i.sort(be),Te);return n?new Xt([a,n]):a}return n||Q}eq(t){if(this==t)return!0;if(!(t instanceof J)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return Go(this.localsInner(t))}localsInner(t){if(this==Q)return Te;if(t.inlineContent||!this.local.some(Gt.is))return this.local;let e=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Gt||e.push(this.local[n]);return e}forEachSet(t){t(this)}}J.empty=new J([],[]),J.removeOverlap=Go;const Q=J.empty;class Xt{constructor(t){this.members=t}map(t,e){const n=this.members.map(i=>i.map(t,e,me));return Xt.from(n)}forChild(t,e){if(e.isLeaf)return J.empty;let n=[];for(let i=0;i<this.members.length;i++){let r=this.members[i].forChild(t,e);r!=Q&&(r instanceof Xt?n=n.concat(r.members):n.push(r))}return Xt.from(n)}eq(t){if(!(t instanceof Xt)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,n=!0;for(let i=0;i<this.members.length;i++){let r=this.members[i].localsInner(t);if(r.length)if(!e)e=r;else{n&&(e=e.slice(),n=!1);for(let s=0;s<r.length;s++)e.push(r[s])}}return e?Go(n?e:e.sort(be)):Te}static from(t){switch(t.length){case 0:return Q;case 1:return t[0];default:return new Xt(t.every(e=>e instanceof J)?t:t.reduce((e,n)=>e.concat(n instanceof J?n:n.members),[]))}}forEachSet(t){for(let e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}}function kf(o,t,e,n,i,r,s){let a=o.slice();for(let c=0,d=r;c<e.maps.length;c++){let h=0;e.maps[c].forEach((f,g,p,b)=>{let y=b-p-(g-f);for(let k=0;k<a.length;k+=3){let D=a[k+1];if(D<0||f>D+d-h)continue;let $=a[k]+d-h;g>=$?a[k+1]=f<=$?-2:-1:f>=d&&y&&(a[k]+=y,a[k+1]+=y)}h+=y}),d=e.maps[c].map(d,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let d=e.map(o[c]+r),h=d-i;if(h<0||h>=n.content.size){l=!0;continue}let f=e.map(o[c+1]+r,-1),g=f-i,{index:p,offset:b}=n.content.findIndex(h),y=n.maybeChild(p);if(y&&b==h&&b+y.nodeSize==g){let k=a[c+2].mapInner(e,y,d+1,o[c]+r+1,s);k!=Q?(a[c]=h,a[c+1]=g,a[c+2]=k):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=xf(a,o,t,e,i,r,s),d=Vn(c,n,0,s);t=d.local;for(let h=0;h<a.length;h+=3)a[h+1]<0&&(a.splice(h,3),h-=3);for(let h=0,f=0;h<d.children.length;h+=3){let g=d.children[h];for(;f<a.length&&a[f]<g;)f+=3;a.splice(f,0,d.children[h],d.children[h+1],d.children[h+2])}}return new J(t.sort(be),a)}function el(o,t){if(!t||!o.length)return o;let e=[];for(let n=0;n<o.length;n++){let i=o[n];e.push(new wt(i.from+t,i.to+t,i.type))}return e}function xf(o,t,e,n,i,r,s){function a(l,c){for(let d=0;d<l.local.length;d++){let h=l.local[d].map(n,i,c);h?e.push(h):s.onRemove&&s.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+c+1)}for(let l=0;l<o.length;l+=3)o[l+1]==-1&&a(o[l+2],t[l]+r+1);return e}function nl(o,t,e){if(t.isLeaf)return null;let n=e+t.nodeSize,i=null;for(let r=0,s;r<o.length;r++)(s=o[r])&&s.from>e&&s.to<n&&((i||(i=[])).push(s),o[r]=null);return i}function ol(o){let t=[];for(let e=0;e<o.length;e++)o[e]!=null&&t.push(o[e]);return t}function Vn(o,t,e,n){let i=[],r=!1;t.forEach((a,l)=>{let c=nl(o,a,l+e);if(c){r=!0;let d=Vn(c,a,e+l+1,n);d!=Q&&i.push(l,l+a.nodeSize,d)}});let s=el(r?ol(o):o,-e).sort(be);for(let a=0;a<s.length;a++)s[a].type.valid(t,s[a])||(n.onRemove&&n.onRemove(s[a].spec),s.splice(a--,1));return s.length||i.length?new J(s,i):Q}function be(o,t){return o.from-t.from||o.to-t.to}function Go(o){let t=o;for(let e=0;e<t.length-1;e++){let n=t[e];if(n.from!=n.to)for(let i=e+1;i<t.length;i++){let r=t[i];if(r.from==n.from){r.to!=n.to&&(t==o&&(t=o.slice()),t[i]=r.copy(r.from,n.to),il(t,i+1,r.copy(n.to,r.to)));continue}else{r.from<n.to&&(t==o&&(t=o.slice()),t[e]=n.copy(n.from,r.from),il(t,i,n.copy(r.from,n.to)));break}}}return t}function il(o,t,e){for(;t<o.length&&be(e,o[t])>0;)t++;o.splice(t,0,e)}function Xo(o){let t=[];return o.someProp("decorations",e=>{let n=e(o.state);n&&n!=Q&&t.push(n)}),o.cursorWrapper&&t.push(J.create(o.state.doc,[o.cursorWrapper.deco])),Xt.from(t)}const Sf={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Cf=nt&&Jt<=11;class Mf{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class Of{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Mf,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);nt&&Jt<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),Cf&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Sf)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Aa(this.view)){if(this.suppressingSelectionUpdates)return zt(this.view);if(nt&&Jt<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&he(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e=new Set,n;for(let r=t.focusNode;r;r=Me(r))e.add(r);for(let r=t.anchorNode;r;r=Me(r))if(e.has(r)){n=r;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let n=t.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&Aa(t)&&!this.ignoreSelectionChange(n),r=-1,s=-1,a=!1,l=[];if(t.editable)for(let d=0;d<e.length;d++){let h=this.registerMutation(e[d],l);h&&(r=r<0?h.from:Math.min(h.from,r),s=s<0?h.to:Math.max(h.to,s),h.typeOver&&(a=!0))}if(yt&&l.length){let d=l.filter(h=>h.nodeName=="BR");if(d.length==2){let[h,f]=d;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of d){let g=f.parentNode;g&&g.nodeName=="LI"&&(!h||If(t,h)!=g)&&f.remove()}}}let c=null;r<0&&i&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&En(n)&&(c=Po(t))&&c.eq(E.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,zt(t),this.currentSelection.set(n),t.scrollToSelection()):(r>-1||i)&&(r>-1&&(t.docView.markDirty(r,s),Nf(t)),this.handleDOMChange(r,s,a,l),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||zt(t),this.currentSelection.set(n))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let n=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(n==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!n||n.ignoreMutation(t))return null;if(t.type=="childList"){for(let d=0;d<t.addedNodes.length;d++){let h=t.addedNodes[d];e.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};let i=t.previousSibling,r=t.nextSibling;if(nt&&Jt<=11&&t.addedNodes.length)for(let d=0;d<t.addedNodes.length;d++){let{previousSibling:h,nextSibling:f}=t.addedNodes[d];(!h||Array.prototype.indexOf.call(t.addedNodes,h)<0)&&(i=h),(!f||Array.prototype.indexOf.call(t.addedNodes,f)<0)&&(r=f)}let s=i&&i.parentNode==t.target?U(i)+1:0,a=n.localPosFromDOM(t.target,s,-1),l=r&&r.parentNode==t.target?U(r):t.target.childNodes.length,c=n.localPosFromDOM(t.target,l,1);return{from:a,to:c}}else return t.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=t.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let rl=new WeakMap,sl=!1;function Nf(o){if(!rl.has(o)&&(rl.set(o,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(o.dom).whiteSpace)!==-1)){if(o.requiresGeckoHackNode=yt,sl)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),sl=!0}}function al(o,t){let e=t.startContainer,n=t.startOffset,i=t.endContainer,r=t.endOffset,s=o.domAtPos(o.state.selection.anchor);return he(s.node,s.offset,i,r)&&([e,n,i,r]=[i,r,e,n]),{anchorNode:e,anchorOffset:n,focusNode:i,focusOffset:r}}function Df(o,t){if(t.getComposedRanges){let i=t.getComposedRanges(o.root)[0];if(i)return al(o,i)}let e;function n(i){i.preventDefault(),i.stopImmediatePropagation(),e=i.getTargetRanges()[0]}return o.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),o.dom.removeEventListener("beforeinput",n,!0),e?al(o,e):null}function If(o,t){for(let e=t.parentNode;e&&e!=o.dom;e=e.parentNode){let n=o.docView.nearestDesc(e,!0);if(n&&n.node.isBlock)return e}return null}function Tf(o,t,e){let{node:n,fromOffset:i,toOffset:r,from:s,to:a}=o.docView.parseRange(t,e),l=o.domSelectionRange(),c,d=l.anchorNode;if(d&&o.dom.contains(d.nodeType==1?d:d.parentNode)&&(c=[{node:d,offset:l.anchorOffset}],En(l)||c.push({node:l.focusNode,offset:l.focusOffset})),X&&o.input.lastKeyCode===8)for(let y=r;y>i;y--){let k=n.childNodes[y-1],D=k.pmViewDesc;if(k.nodeName=="BR"&&!D){r=y;break}if(!D||D.size)break}let h=o.state.doc,f=o.someProp("domParser")||Ve.fromSchema(o.state.schema),g=h.resolve(s),p=null,b=f.parse(n,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:i,to:r,preserveWhitespace:g.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:Af,context:g});if(c&&c[0].pos!=null){let y=c[0].pos,k=c[1]&&c[1].pos;k==null&&(k=y),p={anchor:y+s,head:k+s}}return{doc:b,sel:p,from:s,to:a}}function Af(o){let t=o.pmViewDesc;if(t)return t.parseRule();if(o.nodeName=="BR"&&o.parentNode){if(Z&&/^(ul|ol)$/i.test(o.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}else if(o.parentNode.lastChild==o||Z&&/^(tr|table)$/i.test(o.parentNode.nodeName))return{ignore:!0}}else if(o.nodeName=="IMG"&&o.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Ef=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Bf(o,t,e,n,i){let r=o.input.compositionPendingChanges||(o.composing?o.input.compositionID:0);if(o.input.compositionPendingChanges=0,t<0){let A=o.input.lastSelectionTime>Date.now()-50?o.input.lastSelectionOrigin:null,dt=Po(o,A);if(dt&&!o.state.selection.eq(dt)){if(X&&Rt&&o.input.lastKeyCode===13&&Date.now()-100<o.input.lastKeyCodeTime&&o.someProp("handleKeyDown",Un=>Un(o,ue(13,"Enter"))))return;let Zt=o.state.tr.setSelection(dt);A=="pointer"?Zt.setMeta("pointer",!0):A=="key"&&Zt.scrollIntoView(),r&&Zt.setMeta("composition",r),o.dispatch(Zt)}return}let s=o.state.doc.resolve(t),a=s.sharedDepth(e);t=s.before(a+1),e=o.state.doc.resolve(e).after(a+1);let l=o.state.selection,c=Tf(o,t,e),d=o.state.doc,h=d.slice(c.from,c.to),f,g;o.input.lastKeyCode===8&&Date.now()-100<o.input.lastKeyCodeTime?(f=o.state.selection.to,g="end"):(f=o.state.selection.from,g="start"),o.input.lastKeyCode=null;let p=zf(h.content,c.doc.content,c.from,f,g);if(p&&o.input.domChangeCount++,(Oe&&o.input.lastIOSEnter>Date.now()-225||Rt)&&i.some(A=>A.nodeType==1&&!Ef.test(A.nodeName))&&(!p||p.endA>=p.endB)&&o.someProp("handleKeyDown",A=>A(o,ue(13,"Enter")))){o.input.lastIOSEnter=0;return}if(!p)if(n&&l instanceof z&&!l.empty&&l.$head.sameParent(l.$anchor)&&!o.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let A=ll(o,o.state.doc,c.sel);if(A&&!A.eq(o.state.selection)){let dt=o.state.tr.setSelection(A);r&&dt.setMeta("composition",r),o.dispatch(dt)}}return}o.state.selection.from<o.state.selection.to&&p.start==p.endB&&o.state.selection instanceof z&&(p.start>o.state.selection.from&&p.start<=o.state.selection.from+2&&o.state.selection.from>=c.from?p.start=o.state.selection.from:p.endA<o.state.selection.to&&p.endA>=o.state.selection.to-2&&o.state.selection.to<=c.to&&(p.endB+=o.state.selection.to-p.endA,p.endA=o.state.selection.to)),nt&&Jt<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" \xA0"&&(p.start--,p.endA--,p.endB--);let b=c.doc.resolveNoCache(p.start-c.from),y=c.doc.resolveNoCache(p.endB-c.from),k=d.resolve(p.start),D=b.sameParent(y)&&b.parent.inlineContent&&k.end()>=p.endA,$;if((Oe&&o.input.lastIOSEnter>Date.now()-225&&(!D||i.some(A=>A.nodeName=="DIV"||A.nodeName=="P"))||!D&&b.pos<c.doc.content.size&&(!b.sameParent(y)||!b.parent.inlineContent)&&!/\S/.test(c.doc.textBetween(b.pos,y.pos,"",""))&&($=E.findFrom(c.doc.resolve(b.pos+1),1,!0))&&$.head>b.pos)&&o.someProp("handleKeyDown",A=>A(o,ue(13,"Enter")))){o.input.lastIOSEnter=0;return}if(o.state.selection.anchor>p.start&&Pf(d,p.start,p.endA,b,y)&&o.someProp("handleKeyDown",A=>A(o,ue(8,"Backspace")))){Rt&&X&&o.domObserver.suppressSelectionUpdates();return}X&&p.endB==p.start&&(o.input.lastChromeDelete=Date.now()),Rt&&!D&&b.start()!=y.start()&&y.parentOffset==0&&b.depth==y.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,y=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{o.someProp("handleKeyDown",function(A){return A(o,ue(13,"Enter"))})},20));let O=p.start,P=p.endA,V,an,ct;if(D){if(b.pos==y.pos)nt&&Jt<=11&&b.parentOffset==0&&(o.domObserver.suppressSelectionUpdates(),setTimeout(()=>zt(o),20)),V=o.state.tr.delete(O,P),an=d.resolve(p.start).marksAcross(d.resolve(p.endA));else if(p.endA==p.endB&&(ct=Rf(b.parent.content.cut(b.parentOffset,y.parentOffset),k.parent.content.cut(k.parentOffset,p.endA-k.start()))))V=o.state.tr,ct.type=="add"?V.addMark(O,P,ct.mark):V.removeMark(O,P,ct.mark);else if(b.parent.child(b.index()).isText&&b.index()==y.index()-(y.textOffset?0:1)){let A=b.parent.textBetween(b.parentOffset,y.parentOffset);if(o.someProp("handleTextInput",dt=>dt(o,O,P,A)))return;V=o.state.tr.insertText(A,O,P)}}if(V||(V=o.state.tr.replace(O,P,c.doc.slice(p.start-c.from,p.endB-c.from))),c.sel){let A=ll(o,V.doc,c.sel);A&&!(X&&o.composing&&A.empty&&(p.start!=p.endB||o.input.lastChromeDelete<Date.now()-100)&&(A.head==O||A.head==V.mapping.map(P)-1)||nt&&A.empty&&A.head==O)&&V.setSelection(A)}an&&V.ensureMarks(an),r&&V.setMeta("composition",r),o.dispatch(V.scrollIntoView())}function ll(o,t,e){return Math.max(e.anchor,e.head)>t.content.size?null:Fo(o,t.resolve(e.anchor),t.resolve(e.head))}function Rf(o,t){let e=o.firstChild.marks,n=t.firstChild.marks,i=e,r=n,s,a,l;for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);for(let d=0;d<e.length;d++)r=e[d].removeFromSet(r);if(i.length==1&&r.length==0)a=i[0],s="add",l=d=>d.mark(a.addToSet(d.marks));else if(i.length==0&&r.length==1)a=r[0],s="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let c=[];for(let d=0;d<t.childCount;d++)c.push(l(t.child(d)));if(x.from(c).eq(o))return{mark:a,type:s}}function Pf(o,t,e,n,i){if(e-t<=i.pos-n.pos||Qo(n,!0,!1)<i.pos)return!1;let r=o.resolve(t);if(!n.parent.isTextblock){let a=r.nodeAfter;return a!=null&&e==t+a.nodeSize}if(r.parentOffset<r.parent.content.size||!r.parent.isTextblock)return!1;let s=o.resolve(Qo(r,!0,!0));return!s.parent.isTextblock||s.pos>e||Qo(s,!0,!1)<e?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function Qo(o,t,e){let n=o.depth,i=t?o.end():o.pos;for(;n>0&&(t||o.indexAfter(n)==o.node(n).childCount);)n--,i++,t=!1;if(e){let r=o.node(n).maybeChild(o.indexAfter(n));for(;r&&!r.isLeaf;)r=r.firstChild,i++}return i}function zf(o,t,e,n,i){let r=o.findDiffStart(t,e);if(r==null)return null;let{a:s,b:a}=o.findDiffEnd(t,e+o.size,e+t.size);if(i=="end"){let l=Math.max(0,r-Math.min(s,a));n-=s+l-r}if(s<r&&o.size<t.size){let l=n<=r&&n>=s?r-n:0;r-=l,r&&r<t.size&&cl(t.textBetween(r-1,r+1))&&(r+=l?1:-1),a=r+(a-s),s=r}else if(a<r){let l=n<=r&&n>=a?r-n:0;r-=l,r&&r<o.size&&cl(o.textBetween(r-1,r+1))&&(r+=l?1:-1),s=r+(s-a),a=r}return{start:r,endA:s,endB:a}}function cl(o){if(o.length!=2)return!1;let t=o.charCodeAt(0),e=o.charCodeAt(1);return t>=56320&&t<=57343&&e>=55296&&e<=56319}class Ff{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new ef,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(fl),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=ul(this),hl(this),this.nodeViews=pl(this),this.docView=wa(this.state.doc,dl(this),Xo(this),this.dom,this),this.domObserver=new Of(this,(n,i,r,s)=>Bf(this,n,i,r,s)),this.domObserver.start(),nf(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Jo(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(fl),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let n in this._props)e[n]=this._props[n];e.state=this.state;for(let n in t)e[n]=t[n];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){var n;let i=this.state,r=!1,s=!1;t.storedMarks&&this.composing&&(Qa(this),s=!0),this.state=t;let a=i.plugins!=t.plugins||this._props.plugins!=e.plugins;if(a||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let g=pl(this);Vf(g,this.nodeViews)&&(this.nodeViews=g,r=!0)}(a||e.handleDOMEvents!=this._props.handleDOMEvents)&&Jo(this),this.editable=ul(this),hl(this);let l=Xo(this),c=dl(this),d=i.plugins!=t.plugins&&!i.doc.eq(t.doc)?"reset":t.scrollToSelection>i.scrollToSelection?"to selection":"preserve",h=r||!this.docView.matchesNode(t.doc,c,l);(h||!t.selection.eq(i.selection))&&(s=!0);let f=d=="preserve"&&s&&this.dom.style.overflowAnchor==null&&mp(this);if(s){this.domObserver.stop();let g=h&&(nt||X)&&!this.composing&&!i.selection.empty&&!t.selection.empty&&$f(i.selection,t.selection);if(h){let p=X?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=mf(this)),(r||!this.docView.update(t.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=wa(t.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(g=!0)}g||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Vp(this))?zt(this,g):(Ia(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((n=this.dragging)===null||n===void 0)&&n.node&&!i.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,i),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():f&&bp(f)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!(!t||!this.dom.contains(t.nodeType==1?t:t.parentNode))&&!this.someProp("handleScrollToSelection",e=>e(this)))if(this.state.selection instanceof T){let e=this.docView.domAfterPos(this.state.selection.from);e.nodeType==1&&aa(this,e.getBoundingClientRect(),t)}else aa(this,this.coordsAtPos(this.state.selection.head,1),t)}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let n=this.directPlugins[e];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let n=this.state.plugins[e];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let e=0;e<this.pluginViews.length;e++){let n=this.pluginViews[e];n.update&&n.update(this,t)}}updateDraggedNode(t,e){let n=t.node,i=-1;if(this.state.doc.nodeAt(n.from)==n.node)i=n.from;else{let r=n.from+(this.state.doc.content.size-e.doc.content.size);(r>0&&this.state.doc.nodeAt(r))==n.node&&(i=r)}this.dragging=new Za(t.slice,t.move,i<0?void 0:T.create(this.state.doc,i))}someProp(t,e){let n=this._props&&this._props[t],i;if(n!=null&&(i=e?e(n):n))return i;for(let s=0;s<this.directPlugins.length;s++){let a=this.directPlugins[s].props[t];if(a!=null&&(i=e?e(a):a))return i}let r=this.state.plugins;if(r)for(let s=0;s<r.length;s++){let a=r[s].props[t];if(a!=null&&(i=e?e(a):a))return i}}hasFocus(){if(nt){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&_p(this.dom),zt(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return t||document}updateRoot(){this._root=null}posAtCoords(t){return xp(this,t)}coordsAtPos(t,e=1){return pa(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,n=-1){let i=this.docView.posFromDOM(t,e,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(t,e){return Np(this,e||this.state,t)}pasteHTML(t,e){return Ze(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return Ze(this,t,null,!0,e||new ClipboardEvent("paste"))}serializeForClipboard(t){return Lo(this,t)}destroy(){this.docView&&(of(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Xo(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,rp())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return sf(this,t)}dispatch(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))}domSelectionRange(){let t=this.domSelection();return t?Z&&this.root.nodeType===11&&dp(this.dom.ownerDocument)==this.dom&&Df(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function dl(o){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(o.editable),o.someProp("attributes",e=>{if(typeof e=="function"&&(e=e(o.state)),e)for(let n in e)n=="class"?t.class+=" "+e[n]:n=="style"?t.style=(t.style?t.style+";":"")+e[n]:!t[n]&&n!="contenteditable"&&n!="nodeName"&&(t[n]=String(e[n]))}),t.translate||(t.translate="no"),[wt.node(0,o.state.doc.content.size,t)]}function hl(o){if(o.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),o.cursorWrapper={dom:t,deco:wt.widget(o.state.selection.from,t,{raw:!0,marks:o.markCursor})}}else o.cursorWrapper=null}function ul(o){return!o.someProp("editable",t=>t(o.state)===!1)}function $f(o,t){let e=Math.min(o.$anchor.sharedDepth(o.head),t.$anchor.sharedDepth(t.head));return o.$anchor.start(e)!=t.$anchor.start(e)}function pl(o){let t=Object.create(null);function e(n){for(let i in n)Object.prototype.hasOwnProperty.call(t,i)||(t[i]=n[i])}return o.someProp("nodeViews",e),o.someProp("markViews",e),t}function Vf(o,t){let e=0,n=0;for(let i in o){if(o[i]!=t[i])return!0;e++}for(let i in t)n++;return e!=n}function fl(o){if(o.spec.state||o.spec.filterTransaction||o.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}const Lf=te`
	.ProseMirror {
		position: relative;
	}

	.ProseMirror {
		word-wrap: break-word;
		white-space: pre-wrap;
		white-space: break-spaces;
		-webkit-font-variant-ligatures: none;
		font-variant-ligatures: none;
		font-feature-settings: 'liga' 0; /* the above doesn't seem to work in Edge */
	}

	.ProseMirror pre {
		white-space: pre-wrap;
	}

	.ProseMirror li {
		position: relative;
	}

	.ProseMirror-hideselection *::selection {
		background: transparent;
	}
	.ProseMirror-hideselection *::-moz-selection {
		background: transparent;
	}
	.ProseMirror-hideselection {
		caret-color: transparent;
	}

	/* See https://github.com/ProseMirror/prosemirror/issues/1421#issuecomment-1759320191 */
	.ProseMirror [draggable][contenteditable='false'] {
		user-select: text;
	}

	.ProseMirror-selectednode {
		outline: 2px solid #8cf;
	}

	/* Make sure li selections wrap around markers */

	li.ProseMirror-selectednode {
		outline: none;
	}

	li.ProseMirror-selectednode:after {
		content: '';
		position: absolute;
		left: -32px;
		right: -2px;
		top: -2px;
		bottom: -2px;
		border: 2px solid #8cf;
		pointer-events: none;
	}

	/* Protect against generic img rules */

	img.ProseMirror-separator {
		display: inline !important;
		border: none !important;
		margin: 0 !important;
	}
`,jf=te`
	.ProseMirror-textblock-dropdown {
		min-width: 3em;
	}

	.ProseMirror-menu {
		margin: 0 -4px;
		line-height: 1;
	}

	.ProseMirror-tooltip .ProseMirror-menu {
		width: -webkit-fit-content;
		width: fit-content;
		white-space: pre;
	}

	.ProseMirror-menuitem {
		margin-right: 3px;
		display: inline-block;
	}

	.ProseMirror-menuseparator {
		border-right: 1px solid #ddd;
		margin-right: 3px;
	}

	.ProseMirror-menu-dropdown,
	.ProseMirror-menu-dropdown-menu {
		font-size: 90%;
		white-space: nowrap;
	}

	.ProseMirror-menu-dropdown {
		vertical-align: 1px;
		cursor: pointer;
		position: relative;
		padding-right: 15px;
	}

	.ProseMirror-menu-dropdown-wrap {
		padding: 1px 0 1px 4px;
		display: inline-block;
		position: relative;
	}

	.ProseMirror-menu-dropdown:after {
		content: '';
		border-left: 4px solid transparent;
		border-right: 4px solid transparent;
		border-top: 4px solid currentColor;
		opacity: 0.6;
		position: absolute;
		right: 4px;
		top: calc(50% - 2px);
	}

	.ProseMirror-menu-dropdown-menu,
	.ProseMirror-menu-submenu {
		position: absolute;
		background: white;
		color: #666;
		border: 1px solid #aaa;
		padding: 2px;
	}

	.ProseMirror-menu-dropdown-menu {
		z-index: 15;
		min-width: 6em;
	}

	.ProseMirror-menu-dropdown-item {
		cursor: pointer;
		padding: 2px 8px 2px 4px;
	}

	.ProseMirror-menu-dropdown-item:hover {
		background: #f2f2f2;
	}

	.ProseMirror-menu-submenu-wrap {
		position: relative;
		margin-right: -4px;
	}

	.ProseMirror-menu-submenu-label:after {
		content: '';
		border-top: 4px solid transparent;
		border-bottom: 4px solid transparent;
		border-left: 4px solid currentColor;
		opacity: 0.6;
		position: absolute;
		right: 4px;
		top: calc(50% - 4px);
	}

	.ProseMirror-menu-submenu {
		display: none;
		min-width: 4em;
		left: 100%;
		top: -3px;
	}

	.ProseMirror-menu-active {
		background: #eee;
		border-radius: 4px;
	}

	.ProseMirror-menu-disabled {
		opacity: 0.3;
	}

	.ProseMirror-menu-submenu-wrap:hover .ProseMirror-menu-submenu,
	.ProseMirror-menu-submenu-wrap-active .ProseMirror-menu-submenu {
		display: block;
	}

	.ProseMirror-menubar {
		border-top-left-radius: inherit;
		border-top-right-radius: inherit;
		position: relative;
		min-height: 1em;
		color: #666;
		padding: 1px 6px;
		top: 0;
		left: 0;
		right: 0;
		border-bottom: 1px solid silver;
		background: white;
		z-index: 10;
		-moz-box-sizing: border-box;
		box-sizing: border-box;
		overflow: visible;
	}

	.ProseMirror-icon {
		display: inline-block;
		line-height: 0.8;
		vertical-align: -2px; /* Compensate for padding */
		padding: 2px 8px;
		cursor: pointer;
	}

	.ProseMirror-menu-disabled.ProseMirror-icon {
		cursor: default;
	}

	.ProseMirror-icon svg {
		fill: currentColor;
		height: 1em;
	}

	.ProseMirror-icon span {
		vertical-align: text-top;
	}
`;let Nt=class extends Fl(ci){constructor(){super(...arguments),this.plugins=[],this.path=["text"]}firstUpdated(){const o=this.schema?new ps(this.schema):Wh;this.prosemirror=new Ff(this.shadowRoot,{state:Ce.create({doc:so(o,Re(this.document.docSync(),this.path)),plugins:[...this.plugins,tp({adapter:o,handle:this.document,path:this.path})]}),dispatchTransaction:t=>{this.prosemirror.updateState(this.prosemirror.state.apply(t))}})}render(){return ee``}};Nt.styles=[te`
			:host {
			}
			#editor {
				min-height: 100%;
			}
			.ProseMirror {
				min-height: 100%;
			}

			[contenteditable]:active,
			[contenteditable]:focus {
				border: none;
				outline: none;
			}
			p {
				margin: 0;
			}
		`,Lf,jf,Vl],ht([I()],Nt.prototype,"value",void 0),ht([I()],Nt.prototype,"plugins",void 0),ht([I()],Nt.prototype,"schema",void 0),ht([I()],Nt.prototype,"path",void 0),ht([Qn({context:ea})],Nt.prototype,"client",void 0),ht([dn("#editor")],Nt.prototype,"el",void 0),ht([Qn({context:na}),I()],Nt.prototype,"document",void 0),Nt=ht([di("collaborative-prosemirror")],Nt);let _e=class extends ci{constructor(){super(...arguments),this._acceptedCollaborators=new Kn.State(this.acceptedCollaborators)}set acceptedCollaborators(o){this._acceptedCollaborators.set(o)}get acceptedCollaborators(){return this._acceptedCollaborators?this._acceptedCollaborators.get():[]}connectedCallback(){super.connectedCallback(),this.document=new ip(this.collaborativeSessionsClient,this.sessionId,this._acceptedCollaborators,this.initialDocument),this.document.on("change",o=>{this.dispatchEvent(new CustomEvent("document-change",{bubbles:!0,composed:!0,detail:{change:o}}))})}render(){return ee`<slot></slot>`}};_e.styles=te`
		:host {
			display: contents;
		}
	`,ht([Qn({context:ea}),I({type:Object})],_e.prototype,"collaborativeSessionsClient",void 0),ht([I({attribute:"session-id"})],_e.prototype,"sessionId",void 0),ht([rm({context:na})],_e.prototype,"document",void 0),ht([I()],_e.prototype,"initialDocument",void 0),_e=ht([di("collaborative-document-context")],_e);var Wf=o=>{var t;const{activeElement:e}=document;e&&o.contains(e)&&((t=document.activeElement)==null||t.blur())},Jf=te`
  :host {
    display: inline-block;
    color: var(--sl-color-neutral-600);
  }

  .icon-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    background: none;
    border: none;
    border-radius: var(--sl-border-radius-medium);
    font-size: inherit;
    color: inherit;
    padding: var(--sl-spacing-x-small);
    cursor: pointer;
    transition: var(--sl-transition-x-fast) color;
    -webkit-appearance: none;
  }

  .icon-button:hover:not(.icon-button--disabled),
  .icon-button:focus-visible:not(.icon-button--disabled) {
    color: var(--sl-color-primary-600);
  }

  .icon-button:active:not(.icon-button--disabled) {
    color: var(--sl-color-primary-700);
  }

  .icon-button:focus {
    outline: none;
  }

  .icon-button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .icon-button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .icon-button__icon {
    pointer-events: none;
  }
`;const W=o=>o??Gg;var ot=class extends ui{constructor(){super(...arguments),this.hasFocus=!1,this.label="",this.disabled=!1}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleClick(o){this.disabled&&(o.preventDefault(),o.stopPropagation())}click(){this.button.click()}focus(o){this.button.focus(o)}blur(){this.button.blur()}render(){const o=!!this.href,t=o?Gn`a`:Gn`button`;return Xn`
      <${t}
        part="base"
        class=${Zn({"icon-button":!0,"icon-button--disabled":!o&&this.disabled,"icon-button--focused":this.hasFocus})}
        ?disabled=${W(o?void 0:this.disabled)}
        type=${W(o?void 0:"button")}
        href=${W(o?this.href:void 0)}
        target=${W(o?this.target:void 0)}
        download=${W(o?this.download:void 0)}
        rel=${W(o&&this.target?"noreferrer noopener":void 0)}
        role=${W(o?void 0:"button")}
        aria-disabled=${this.disabled?"true":"false"}
        aria-label="${this.label}"
        tabindex=${this.disabled?"-1":"0"}
        @blur=${this.handleBlur}
        @focus=${this.handleFocus}
        @click=${this.handleClick}
      >
        <sl-icon
          class="icon-button__icon"
          name=${W(this.name)}
          library=${W(this.library)}
          src=${W(this.src)}
          aria-hidden="true"
        ></sl-icon>
      </${t}>
    `}};ot.styles=[hi,Jf],ot.dependencies={"sl-icon":jl},N([dn(".icon-button")],ot.prototype,"button",2),N([Yn()],ot.prototype,"hasFocus",2),N([I()],ot.prototype,"name",2),N([I()],ot.prototype,"library",2),N([I()],ot.prototype,"src",2),N([I()],ot.prototype,"href",2),N([I()],ot.prototype,"target",2),N([I()],ot.prototype,"download",2),N([I()],ot.prototype,"label",2),N([I({type:Boolean,reflect:!0})],ot.prototype,"disabled",2);var qf=te`
  :host {
    display: contents;

    /* For better DX, we'll reset the margin here so the base part can inherit it */
    margin: 0;
  }

  .alert {
    position: relative;
    display: flex;
    align-items: stretch;
    background-color: var(--sl-panel-background-color);
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
    border-top-width: calc(var(--sl-panel-border-width) * 3);
    border-radius: var(--sl-border-radius-medium);
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-small);
    font-weight: var(--sl-font-weight-normal);
    line-height: 1.6;
    color: var(--sl-color-neutral-700);
    margin: inherit;
    overflow: hidden;
  }

  .alert:not(.alert--has-icon) .alert__icon,
  .alert:not(.alert--closable) .alert__close-button {
    display: none;
  }

  .alert__icon {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-large);
    padding-inline-start: var(--sl-spacing-large);
  }

  .alert--has-countdown {
    border-bottom: none;
  }

  .alert--primary {
    border-top-color: var(--sl-color-primary-600);
  }

  .alert--primary .alert__icon {
    color: var(--sl-color-primary-600);
  }

  .alert--success {
    border-top-color: var(--sl-color-success-600);
  }

  .alert--success .alert__icon {
    color: var(--sl-color-success-600);
  }

  .alert--neutral {
    border-top-color: var(--sl-color-neutral-600);
  }

  .alert--neutral .alert__icon {
    color: var(--sl-color-neutral-600);
  }

  .alert--warning {
    border-top-color: var(--sl-color-warning-600);
  }

  .alert--warning .alert__icon {
    color: var(--sl-color-warning-600);
  }

  .alert--danger {
    border-top-color: var(--sl-color-danger-600);
  }

  .alert--danger .alert__icon {
    color: var(--sl-color-danger-600);
  }

  .alert__message {
    flex: 1 1 auto;
    display: block;
    padding: var(--sl-spacing-large);
    overflow: hidden;
  }

  .alert__close-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-medium);
    margin-inline-end: var(--sl-spacing-medium);
    align-self: center;
  }

  .alert__countdown {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: calc(var(--sl-panel-border-width) * 3);
    background-color: var(--sl-panel-border-color);
    display: flex;
  }

  .alert__countdown--ltr {
    justify-content: flex-end;
  }

  .alert__countdown .alert__countdown-elapsed {
    height: 100%;
    width: 0;
  }

  .alert--primary .alert__countdown-elapsed {
    background-color: var(--sl-color-primary-600);
  }

  .alert--success .alert__countdown-elapsed {
    background-color: var(--sl-color-success-600);
  }

  .alert--neutral .alert__countdown-elapsed {
    background-color: var(--sl-color-neutral-600);
  }

  .alert--warning .alert__countdown-elapsed {
    background-color: var(--sl-color-warning-600);
  }

  .alert--danger .alert__countdown-elapsed {
    background-color: var(--sl-color-danger-600);
  }

  .alert__timer {
    display: none;
  }
`,at=class ye extends ui{constructor(){super(...arguments),this.hasSlotController=new Jl(this,"icon","suffix"),this.localize=new ql(this),this.open=!1,this.closable=!1,this.variant="primary",this.duration=1/0,this.remainingTime=this.duration}static get toastStack(){return this.currentToastStack||(this.currentToastStack=Object.assign(document.createElement("div"),{className:"sl-toast-stack"})),this.currentToastStack}firstUpdated(){this.base.hidden=!this.open}restartAutoHide(){this.handleCountdownChange(),clearTimeout(this.autoHideTimeout),clearInterval(this.remainingTimeInterval),this.open&&this.duration<1/0&&(this.autoHideTimeout=window.setTimeout(()=>this.hide(),this.duration),this.remainingTime=this.duration,this.remainingTimeInterval=window.setInterval(()=>{this.remainingTime-=100},100))}pauseAutoHide(){var t;(t=this.countdownAnimation)==null||t.pause(),clearTimeout(this.autoHideTimeout),clearInterval(this.remainingTimeInterval)}resumeAutoHide(){var t;this.duration<1/0&&(this.autoHideTimeout=window.setTimeout(()=>this.hide(),this.remainingTime),this.remainingTimeInterval=window.setInterval(()=>{this.remainingTime-=100},100),(t=this.countdownAnimation)==null||t.play())}handleCountdownChange(){if(this.open&&this.duration<1/0&&this.countdown){const{countdownElement:t}=this,e="100%",n="0";this.countdownAnimation=t.animate([{width:e},{width:n}],{duration:this.duration,easing:"linear"})}}handleCloseClick(){this.hide()}async handleOpenChange(){if(this.open){this.emit("sl-show"),this.duration<1/0&&this.restartAutoHide(),await Hl(this.base),this.base.hidden=!1;const{keyframes:t,options:e}=Ul(this,"alert.show",{dir:this.localize.dir()});await Kl(this.base,t,e),this.emit("sl-after-show")}else{Wf(this),this.emit("sl-hide"),clearTimeout(this.autoHideTimeout),clearInterval(this.remainingTimeInterval),await Hl(this.base);const{keyframes:t,options:e}=Ul(this,"alert.hide",{dir:this.localize.dir()});await Kl(this.base,t,e),this.base.hidden=!0,this.emit("sl-after-hide")}}handleDurationChange(){this.restartAutoHide()}async show(){if(!this.open)return this.open=!0,Gl(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,Gl(this,"sl-after-hide")}async toast(){return new Promise(t=>{this.handleCountdownChange(),ye.toastStack.parentElement===null&&document.body.append(ye.toastStack),ye.toastStack.appendChild(this),requestAnimationFrame(()=>{this.clientWidth,this.show()}),this.addEventListener("sl-after-hide",()=>{ye.toastStack.removeChild(this),t(),ye.toastStack.querySelector("sl-alert")===null&&ye.toastStack.remove()},{once:!0})})}render(){return ee`
      <div
        part="base"
        class=${Zn({alert:!0,"alert--open":this.open,"alert--closable":this.closable,"alert--has-countdown":!!this.countdown,"alert--has-icon":this.hasSlotController.test("icon"),"alert--primary":this.variant==="primary","alert--success":this.variant==="success","alert--neutral":this.variant==="neutral","alert--warning":this.variant==="warning","alert--danger":this.variant==="danger"})}
        role="alert"
        aria-hidden=${this.open?"false":"true"}
        @mouseenter=${this.pauseAutoHide}
        @mouseleave=${this.resumeAutoHide}
      >
        <div part="icon" class="alert__icon">
          <slot name="icon"></slot>
        </div>

        <div part="message" class="alert__message" aria-live="polite">
          <slot></slot>
        </div>

        ${this.closable?ee`
              <sl-icon-button
                part="close-button"
                exportparts="base:close-button__base"
                class="alert__close-button"
                name="x-lg"
                library="system"
                label=${this.localize.term("close")}
                @click=${this.handleCloseClick}
              ></sl-icon-button>
            `:""}

        <div role="timer" class="alert__timer">${this.remainingTime}</div>

        ${this.countdown?ee`
              <div
                class=${Zn({alert__countdown:!0,"alert__countdown--ltr":this.countdown==="ltr"})}
              >
                <div class="alert__countdown-elapsed"></div>
              </div>
            `:""}
      </div>
    `}};at.styles=[hi,qf],at.dependencies={"sl-icon-button":ot},N([dn('[part~="base"]')],at.prototype,"base",2),N([dn(".alert__countdown-elapsed")],at.prototype,"countdownElement",2),N([I({type:Boolean,reflect:!0})],at.prototype,"open",2),N([I({type:Boolean,reflect:!0})],at.prototype,"closable",2),N([I({reflect:!0})],at.prototype,"variant",2),N([I({type:Number})],at.prototype,"duration",2),N([I({type:String,reflect:!0})],at.prototype,"countdown",2),N([Yn()],at.prototype,"remainingTime",2),N([pi("open",{waitUntilFirstUpdate:!0})],at.prototype,"handleOpenChange",1),N([pi("duration")],at.prototype,"handleDurationChange",1);var Hf=at;Wl("alert.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:250,easing:"ease"}}),Wl("alert.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:250,easing:"ease"}}),Hf.define("sl-alert");var en=new WeakMap,nn=new WeakMap,on=new WeakMap,Yo=new WeakSet,Ln=new WeakMap,Uf=class{constructor(o,t){this.handleFormData=e=>{const n=this.options.disabled(this.host),i=this.options.name(this.host),r=this.options.value(this.host),s=this.host.tagName.toLowerCase()==="sl-button";this.host.isConnected&&!n&&!s&&typeof i=="string"&&i.length>0&&typeof r<"u"&&(Array.isArray(r)?r.forEach(a=>{e.formData.append(i,a.toString())}):e.formData.append(i,r.toString()))},this.handleFormSubmit=e=>{var n;const i=this.options.disabled(this.host),r=this.options.reportValidity;this.form&&!this.form.noValidate&&((n=en.get(this.form))==null||n.forEach(s=>{this.setUserInteracted(s,!0)})),this.form&&!this.form.noValidate&&!i&&!r(this.host)&&(e.preventDefault(),e.stopImmediatePropagation())},this.handleFormReset=()=>{this.options.setValue(this.host,this.options.defaultValue(this.host)),this.setUserInteracted(this.host,!1),Ln.set(this.host,[])},this.handleInteraction=e=>{const n=Ln.get(this.host);n.includes(e.type)||n.push(e.type),n.length===this.options.assumeInteractionOn.length&&this.setUserInteracted(this.host,!0)},this.checkFormValidity=()=>{if(this.form&&!this.form.noValidate){const e=this.form.querySelectorAll("*");for(const n of e)if(typeof n.checkValidity=="function"&&!n.checkValidity())return!1}return!0},this.reportFormValidity=()=>{if(this.form&&!this.form.noValidate){const e=this.form.querySelectorAll("*");for(const n of e)if(typeof n.reportValidity=="function"&&!n.reportValidity())return!1}return!0},(this.host=o).addController(this),this.options=fi({form:e=>{const n=e.form;if(n){const i=e.getRootNode().querySelector(`#${n}`);if(i)return i}return e.closest("form")},name:e=>e.name,value:e=>e.value,defaultValue:e=>e.defaultValue,disabled:e=>{var n;return(n=e.disabled)!=null?n:!1},reportValidity:e=>typeof e.reportValidity=="function"?e.reportValidity():!0,checkValidity:e=>typeof e.checkValidity=="function"?e.checkValidity():!0,setValue:(e,n)=>e.value=n,assumeInteractionOn:["sl-input"]},t)}hostConnected(){const o=this.options.form(this.host);o&&this.attachForm(o),Ln.set(this.host,[]),this.options.assumeInteractionOn.forEach(t=>{this.host.addEventListener(t,this.handleInteraction)})}hostDisconnected(){this.detachForm(),Ln.delete(this.host),this.options.assumeInteractionOn.forEach(o=>{this.host.removeEventListener(o,this.handleInteraction)})}hostUpdated(){const o=this.options.form(this.host);o||this.detachForm(),o&&this.form!==o&&(this.detachForm(),this.attachForm(o)),this.host.hasUpdated&&this.setValidity(this.host.validity.valid)}attachForm(o){o?(this.form=o,en.has(this.form)?en.get(this.form).add(this.host):en.set(this.form,new Set([this.host])),this.form.addEventListener("formdata",this.handleFormData),this.form.addEventListener("submit",this.handleFormSubmit),this.form.addEventListener("reset",this.handleFormReset),nn.has(this.form)||(nn.set(this.form,this.form.reportValidity),this.form.reportValidity=()=>this.reportFormValidity()),on.has(this.form)||(on.set(this.form,this.form.checkValidity),this.form.checkValidity=()=>this.checkFormValidity())):this.form=void 0}detachForm(){if(!this.form)return;const o=en.get(this.form);o&&(o.delete(this.host),o.size<=0&&(this.form.removeEventListener("formdata",this.handleFormData),this.form.removeEventListener("submit",this.handleFormSubmit),this.form.removeEventListener("reset",this.handleFormReset),nn.has(this.form)&&(this.form.reportValidity=nn.get(this.form),nn.delete(this.form)),on.has(this.form)&&(this.form.checkValidity=on.get(this.form),on.delete(this.form)),this.form=void 0))}setUserInteracted(o,t){t?Yo.add(o):Yo.delete(o),o.requestUpdate()}doAction(o,t){if(this.form){const e=document.createElement("button");e.type=o,e.style.position="absolute",e.style.width="0",e.style.height="0",e.style.clipPath="inset(50%)",e.style.overflow="hidden",e.style.whiteSpace="nowrap",t&&(e.name=t.name,e.value=t.value,["formaction","formenctype","formmethod","formnovalidate","formtarget"].forEach(n=>{t.hasAttribute(n)&&e.setAttribute(n,t.getAttribute(n))})),this.form.append(e),e.click(),e.remove()}}getForm(){var o;return(o=this.form)!=null?o:null}reset(o){this.doAction("reset",o)}submit(o){this.doAction("submit",o)}setValidity(o){const t=this.host,e=!!Yo.has(t),n=!!t.required;t.toggleAttribute("data-required",n),t.toggleAttribute("data-optional",!n),t.toggleAttribute("data-invalid",!o),t.toggleAttribute("data-valid",o),t.toggleAttribute("data-user-invalid",!o&&e),t.toggleAttribute("data-user-valid",o&&e)}updateValidity(){const o=this.host;this.setValidity(o.validity.valid)}emitInvalidEvent(o){const t=new CustomEvent("sl-invalid",{bubbles:!1,composed:!1,cancelable:!0,detail:{}});o||t.preventDefault(),this.host.dispatchEvent(t)||(o==null||o.preventDefault())}},Zo=Object.freeze({badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:!0,valueMissing:!1});Object.freeze(Xl(fi({},Zo),{valid:!1,valueMissing:!0})),Object.freeze(Xl(fi({},Zo),{valid:!1,customError:!0}));var Kf=te`
  :host {
    display: inline-block;
    position: relative;
    width: auto;
    cursor: pointer;
  }

  .button {
    display: inline-flex;
    align-items: stretch;
    justify-content: center;
    width: 100%;
    border-style: solid;
    border-width: var(--sl-input-border-width);
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-font-weight-semibold);
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
    white-space: nowrap;
    vertical-align: middle;
    padding: 0;
    transition:
      var(--sl-transition-x-fast) background-color,
      var(--sl-transition-x-fast) color,
      var(--sl-transition-x-fast) border,
      var(--sl-transition-x-fast) box-shadow;
    cursor: inherit;
  }

  .button::-moz-focus-inner {
    border: 0;
  }

  .button:focus {
    outline: none;
  }

  .button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* When disabled, prevent mouse events from bubbling up from children */
  .button--disabled * {
    pointer-events: none;
  }

  .button__prefix,
  .button__suffix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    pointer-events: none;
  }

  .button__label {
    display: inline-block;
  }

  .button__label::slotted(sl-icon) {
    vertical-align: -2px;
  }

  /*
   * Standard buttons
   */

  /* Default */
  .button--standard.button--default {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-input-border-color);
    color: var(--sl-color-neutral-700);
  }

  .button--standard.button--default:hover:not(.button--disabled) {
    background-color: var(--sl-color-primary-50);
    border-color: var(--sl-color-primary-300);
    color: var(--sl-color-primary-700);
  }

  .button--standard.button--default:active:not(.button--disabled) {
    background-color: var(--sl-color-primary-100);
    border-color: var(--sl-color-primary-400);
    color: var(--sl-color-primary-700);
  }

  /* Primary */
  .button--standard.button--primary {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--primary:hover:not(.button--disabled) {
    background-color: var(--sl-color-primary-500);
    border-color: var(--sl-color-primary-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--primary:active:not(.button--disabled) {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  /* Success */
  .button--standard.button--success {
    background-color: var(--sl-color-success-600);
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--success:hover:not(.button--disabled) {
    background-color: var(--sl-color-success-500);
    border-color: var(--sl-color-success-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--success:active:not(.button--disabled) {
    background-color: var(--sl-color-success-600);
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  /* Neutral */
  .button--standard.button--neutral {
    background-color: var(--sl-color-neutral-600);
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--neutral:hover:not(.button--disabled) {
    background-color: var(--sl-color-neutral-500);
    border-color: var(--sl-color-neutral-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--neutral:active:not(.button--disabled) {
    background-color: var(--sl-color-neutral-600);
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  /* Warning */
  .button--standard.button--warning {
    background-color: var(--sl-color-warning-600);
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }
  .button--standard.button--warning:hover:not(.button--disabled) {
    background-color: var(--sl-color-warning-500);
    border-color: var(--sl-color-warning-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--warning:active:not(.button--disabled) {
    background-color: var(--sl-color-warning-600);
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  /* Danger */
  .button--standard.button--danger {
    background-color: var(--sl-color-danger-600);
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--danger:hover:not(.button--disabled) {
    background-color: var(--sl-color-danger-500);
    border-color: var(--sl-color-danger-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--danger:active:not(.button--disabled) {
    background-color: var(--sl-color-danger-600);
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  /*
   * Outline buttons
   */

  .button--outline {
    background: none;
    border: solid 1px;
  }

  /* Default */
  .button--outline.button--default {
    border-color: var(--sl-input-border-color);
    color: var(--sl-color-neutral-700);
  }

  .button--outline.button--default:hover:not(.button--disabled),
  .button--outline.button--default.button--checked:not(.button--disabled) {
    border-color: var(--sl-color-primary-600);
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--default:active:not(.button--disabled) {
    border-color: var(--sl-color-primary-700);
    background-color: var(--sl-color-primary-700);
    color: var(--sl-color-neutral-0);
  }

  /* Primary */
  .button--outline.button--primary {
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-primary-600);
  }

  .button--outline.button--primary:hover:not(.button--disabled),
  .button--outline.button--primary.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--primary:active:not(.button--disabled) {
    border-color: var(--sl-color-primary-700);
    background-color: var(--sl-color-primary-700);
    color: var(--sl-color-neutral-0);
  }

  /* Success */
  .button--outline.button--success {
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-success-600);
  }

  .button--outline.button--success:hover:not(.button--disabled),
  .button--outline.button--success.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--success:active:not(.button--disabled) {
    border-color: var(--sl-color-success-700);
    background-color: var(--sl-color-success-700);
    color: var(--sl-color-neutral-0);
  }

  /* Neutral */
  .button--outline.button--neutral {
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-600);
  }

  .button--outline.button--neutral:hover:not(.button--disabled),
  .button--outline.button--neutral.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--neutral:active:not(.button--disabled) {
    border-color: var(--sl-color-neutral-700);
    background-color: var(--sl-color-neutral-700);
    color: var(--sl-color-neutral-0);
  }

  /* Warning */
  .button--outline.button--warning {
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-warning-600);
  }

  .button--outline.button--warning:hover:not(.button--disabled),
  .button--outline.button--warning.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--warning:active:not(.button--disabled) {
    border-color: var(--sl-color-warning-700);
    background-color: var(--sl-color-warning-700);
    color: var(--sl-color-neutral-0);
  }

  /* Danger */
  .button--outline.button--danger {
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-danger-600);
  }

  .button--outline.button--danger:hover:not(.button--disabled),
  .button--outline.button--danger.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--danger:active:not(.button--disabled) {
    border-color: var(--sl-color-danger-700);
    background-color: var(--sl-color-danger-700);
    color: var(--sl-color-neutral-0);
  }

  @media (forced-colors: active) {
    .button.button--outline.button--checked:not(.button--disabled) {
      outline: solid 2px transparent;
    }
  }

  /*
   * Text buttons
   */

  .button--text {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-600);
  }

  .button--text:hover:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-500);
  }

  .button--text:focus-visible:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-500);
  }

  .button--text:active:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-700);
  }

  /*
   * Size modifiers
   */

  .button--small {
    height: auto;
    min-height: var(--sl-input-height-small);
    font-size: var(--sl-button-font-size-small);
    line-height: calc(var(--sl-input-height-small) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-small);
  }

  .button--medium {
    height: auto;
    min-height: var(--sl-input-height-medium);
    font-size: var(--sl-button-font-size-medium);
    line-height: calc(var(--sl-input-height-medium) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-medium);
  }

  .button--large {
    height: auto;
    min-height: var(--sl-input-height-large);
    font-size: var(--sl-button-font-size-large);
    line-height: calc(var(--sl-input-height-large) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-large);
  }

  /*
   * Pill modifier
   */

  .button--pill.button--small {
    border-radius: var(--sl-input-height-small);
  }

  .button--pill.button--medium {
    border-radius: var(--sl-input-height-medium);
  }

  .button--pill.button--large {
    border-radius: var(--sl-input-height-large);
  }

  /*
   * Circle modifier
   */

  .button--circle {
    padding-left: 0;
    padding-right: 0;
  }

  .button--circle.button--small {
    width: var(--sl-input-height-small);
    border-radius: 50%;
  }

  .button--circle.button--medium {
    width: var(--sl-input-height-medium);
    border-radius: 50%;
  }

  .button--circle.button--large {
    width: var(--sl-input-height-large);
    border-radius: 50%;
  }

  .button--circle .button__prefix,
  .button--circle .button__suffix,
  .button--circle .button__caret {
    display: none;
  }

  /*
   * Caret modifier
   */

  .button--caret .button__suffix {
    display: none;
  }

  .button--caret .button__caret {
    height: auto;
  }

  /*
   * Loading modifier
   */

  .button--loading {
    position: relative;
    cursor: wait;
  }

  .button--loading .button__prefix,
  .button--loading .button__label,
  .button--loading .button__suffix,
  .button--loading .button__caret {
    visibility: hidden;
  }

  .button--loading sl-spinner {
    --indicator-color: currentColor;
    position: absolute;
    font-size: 1em;
    height: 1em;
    width: 1em;
    top: calc(50% - 0.5em);
    left: calc(50% - 0.5em);
  }

  /*
   * Badges
   */

  .button ::slotted(sl-badge) {
    position: absolute;
    top: 0;
    right: 0;
    translate: 50% -50%;
    pointer-events: none;
  }

  .button--rtl ::slotted(sl-badge) {
    right: auto;
    left: 0;
    translate: -50% -50%;
  }

  /*
   * Button spacing
   */

  .button--has-label.button--small .button__label {
    padding: 0 var(--sl-spacing-small);
  }

  .button--has-label.button--medium .button__label {
    padding: 0 var(--sl-spacing-medium);
  }

  .button--has-label.button--large .button__label {
    padding: 0 var(--sl-spacing-large);
  }

  .button--has-prefix.button--small {
    padding-inline-start: var(--sl-spacing-x-small);
  }

  .button--has-prefix.button--small .button__label {
    padding-inline-start: var(--sl-spacing-x-small);
  }

  .button--has-prefix.button--medium {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--medium .button__label {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--large {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--large .button__label {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-suffix.button--small,
  .button--caret.button--small {
    padding-inline-end: var(--sl-spacing-x-small);
  }

  .button--has-suffix.button--small .button__label,
  .button--caret.button--small .button__label {
    padding-inline-end: var(--sl-spacing-x-small);
  }

  .button--has-suffix.button--medium,
  .button--caret.button--medium {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--medium .button__label,
  .button--caret.button--medium .button__label {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--large,
  .button--caret.button--large {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--large .button__label,
  .button--caret.button--large .button__label {
    padding-inline-end: var(--sl-spacing-small);
  }

  /*
   * Button groups support a variety of button types (e.g. buttons with tooltips, buttons as dropdown triggers, etc.).
   * This means buttons aren't always direct descendants of the button group, thus we can't target them with the
   * ::slotted selector. To work around this, the button group component does some magic to add these special classes to
   * buttons and we style them here instead.
   */

  :host([data-sl-button-group__button--first]:not([data-sl-button-group__button--last])) .button {
    border-start-end-radius: 0;
    border-end-end-radius: 0;
  }

  :host([data-sl-button-group__button--inner]) .button {
    border-radius: 0;
  }

  :host([data-sl-button-group__button--last]:not([data-sl-button-group__button--first])) .button {
    border-start-start-radius: 0;
    border-end-start-radius: 0;
  }

  /* All except the first */
  :host([data-sl-button-group__button]:not([data-sl-button-group__button--first])) {
    margin-inline-start: calc(-1 * var(--sl-input-border-width));
  }

  /* Add a visual separator between solid buttons */
  :host(
      [data-sl-button-group__button]:not(
          [data-sl-button-group__button--first],
          [data-sl-button-group__button--radio],
          [variant='default']
        ):not(:hover)
    )
    .button:after {
    content: '';
    position: absolute;
    top: 0;
    inset-inline-start: 0;
    bottom: 0;
    border-left: solid 1px rgb(128 128 128 / 33%);
    mix-blend-mode: multiply;
  }

  /* Bump hovered, focused, and checked buttons up so their focus ring isn't clipped */
  :host([data-sl-button-group__button--hover]) {
    z-index: 1;
  }

  /* Focus and checked are always on top */
  :host([data-sl-button-group__button--focus]),
  :host([data-sl-button-group__button][checked]) {
    z-index: 2;
  }
`,R=class extends ui{constructor(){super(...arguments),this.formControlController=new Uf(this,{assumeInteractionOn:["click"]}),this.hasSlotController=new Jl(this,"[default]","prefix","suffix"),this.localize=new ql(this),this.hasFocus=!1,this.invalid=!1,this.title="",this.variant="default",this.size="medium",this.caret=!1,this.disabled=!1,this.loading=!1,this.outline=!1,this.pill=!1,this.circle=!1,this.type="button",this.name="",this.value="",this.href="",this.rel="noreferrer noopener"}get validity(){return this.isButton()?this.button.validity:Zo}get validationMessage(){return this.isButton()?this.button.validationMessage:""}firstUpdated(){this.isButton()&&this.formControlController.updateValidity()}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleClick(){this.type==="submit"&&this.formControlController.submit(this),this.type==="reset"&&this.formControlController.reset(this)}handleInvalid(o){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(o)}isButton(){return!this.href}isLink(){return!!this.href}handleDisabledChange(){this.isButton()&&this.formControlController.setValidity(this.disabled)}click(){this.button.click()}focus(o){this.button.focus(o)}blur(){this.button.blur()}checkValidity(){return this.isButton()?this.button.checkValidity():!0}getForm(){return this.formControlController.getForm()}reportValidity(){return this.isButton()?this.button.reportValidity():!0}setCustomValidity(o){this.isButton()&&(this.button.setCustomValidity(o),this.formControlController.updateValidity())}render(){const o=this.isLink(),t=o?Gn`a`:Gn`button`;return Xn`
      <${t}
        part="base"
        class=${Zn({button:!0,"button--default":this.variant==="default","button--primary":this.variant==="primary","button--success":this.variant==="success","button--neutral":this.variant==="neutral","button--warning":this.variant==="warning","button--danger":this.variant==="danger","button--text":this.variant==="text","button--small":this.size==="small","button--medium":this.size==="medium","button--large":this.size==="large","button--caret":this.caret,"button--circle":this.circle,"button--disabled":this.disabled,"button--focused":this.hasFocus,"button--loading":this.loading,"button--standard":!this.outline,"button--outline":this.outline,"button--pill":this.pill,"button--rtl":this.localize.dir()==="rtl","button--has-label":this.hasSlotController.test("[default]"),"button--has-prefix":this.hasSlotController.test("prefix"),"button--has-suffix":this.hasSlotController.test("suffix")})}
        ?disabled=${W(o?void 0:this.disabled)}
        type=${W(o?void 0:this.type)}
        title=${this.title}
        name=${W(o?void 0:this.name)}
        value=${W(o?void 0:this.value)}
        href=${W(o&&!this.disabled?this.href:void 0)}
        target=${W(o?this.target:void 0)}
        download=${W(o?this.download:void 0)}
        rel=${W(o?this.rel:void 0)}
        role=${W(o?void 0:"button")}
        aria-disabled=${this.disabled?"true":"false"}
        tabindex=${this.disabled?"-1":"0"}
        @blur=${this.handleBlur}
        @focus=${this.handleFocus}
        @invalid=${this.isButton()?this.handleInvalid:null}
        @click=${this.handleClick}
      >
        <slot name="prefix" part="prefix" class="button__prefix"></slot>
        <slot part="label" class="button__label"></slot>
        <slot name="suffix" part="suffix" class="button__suffix"></slot>
        ${this.caret?Xn` <sl-icon part="caret" class="button__caret" library="system" name="caret"></sl-icon> `:""}
        ${this.loading?Xn`<sl-spinner part="spinner"></sl-spinner>`:""}
      </${t}>
    `}};R.styles=[hi,Kf],R.dependencies={"sl-icon":jl,"sl-spinner":em},N([dn(".button")],R.prototype,"button",2),N([Yn()],R.prototype,"hasFocus",2),N([Yn()],R.prototype,"invalid",2),N([I()],R.prototype,"title",2),N([I({reflect:!0})],R.prototype,"variant",2),N([I({reflect:!0})],R.prototype,"size",2),N([I({type:Boolean,reflect:!0})],R.prototype,"caret",2),N([I({type:Boolean,reflect:!0})],R.prototype,"disabled",2),N([I({type:Boolean,reflect:!0})],R.prototype,"loading",2),N([I({type:Boolean,reflect:!0})],R.prototype,"outline",2),N([I({type:Boolean,reflect:!0})],R.prototype,"pill",2),N([I({type:Boolean,reflect:!0})],R.prototype,"circle",2),N([I()],R.prototype,"type",2),N([I()],R.prototype,"name",2),N([I()],R.prototype,"value",2),N([I()],R.prototype,"href",2),N([I()],R.prototype,"target",2),N([I()],R.prototype,"rel",2),N([I()],R.prototype,"download",2),N([I()],R.prototype,"form",2),N([I({attribute:"formaction"})],R.prototype,"formAction",2),N([I({attribute:"formenctype"})],R.prototype,"formEnctype",2),N([I({attribute:"formmethod"})],R.prototype,"formMethod",2),N([I({attribute:"formnovalidate",type:Boolean})],R.prototype,"formNoValidate",2),N([I({attribute:"formtarget"})],R.prototype,"formTarget",2),N([pi("disabled",{waitUntilFirstUpdate:!0})],R.prototype,"handleDisabledChange",1),R.define("sl-button"),ot.define("sl-icon-button");function Gf(o,t,e,n){if(typeof t=="function"?o!==t||!0:!t.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(o):n?n.value:t.get(o)}function Xf(o,t,e,n,i){if(typeof t=="function"?o!==t||!0:!t.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(o,e),e}var jn;const _t="__TAURI_TO_IPC_KEY__";function Qf(o,t=!1){return window.__TAURI_INTERNALS__.transformCallback(o,t)}async function S(o,t={},e){return window.__TAURI_INTERNALS__.invoke(o,t,e)}class Yf{get rid(){return Gf(this,jn,"f")}constructor(t){jn.set(this,void 0),Xf(this,jn,t)}async close(){return S("plugin:resources|close",{rid:this.rid})}}jn=new WeakMap;class gl{constructor(...t){this.type="Logical",t.length===1?"Logical"in t[0]?(this.width=t[0].Logical.width,this.height=t[0].Logical.height):(this.width=t[0].width,this.height=t[0].height):(this.width=t[0],this.height=t[1])}toPhysical(t){return new rn(this.width*t,this.height*t)}[_t](){return{width:this.width,height:this.height}}toJSON(){return this[_t]()}}class rn{constructor(...t){this.type="Physical",t.length===1?"Physical"in t[0]?(this.width=t[0].Physical.width,this.height=t[0].Physical.height):(this.width=t[0].width,this.height=t[0].height):(this.width=t[0],this.height=t[1])}toLogical(t){return new gl(this.width/t,this.height/t)}[_t](){return{width:this.width,height:this.height}}toJSON(){return this[_t]()}}class Ae{constructor(t){this.size=t}toLogical(t){return this.size instanceof gl?this.size:this.size.toLogical(t)}toPhysical(t){return this.size instanceof rn?this.size:this.size.toPhysical(t)}[_t](){return{[`${this.size.type}`]:{width:this.size.width,height:this.size.height}}}toJSON(){return this[_t]()}}class ml{constructor(...t){this.type="Logical",t.length===1?"Logical"in t[0]?(this.x=t[0].Logical.x,this.y=t[0].Logical.y):(this.x=t[0].x,this.y=t[0].y):(this.x=t[0],this.y=t[1])}toPhysical(t){return new Qt(this.x*t,this.y*t)}[_t](){return{x:this.x,y:this.y}}toJSON(){return this[_t]()}}class Qt{constructor(...t){this.type="Physical",t.length===1?"Physical"in t[0]?(this.x=t[0].Physical.x,this.y=t[0].Physical.y):(this.x=t[0].x,this.y=t[0].y):(this.x=t[0],this.y=t[1])}toLogical(t){return new ml(this.x/t,this.y/t)}[_t](){return{x:this.x,y:this.y}}toJSON(){return this[_t]()}}class Wn{constructor(t){this.position=t}toLogical(t){return this.position instanceof ml?this.position:this.position.toLogical(t)}toPhysical(t){return this.position instanceof Qt?this.position:this.position.toPhysical(t)}[_t](){return{[`${this.position.type}`]:{x:this.position.x,y:this.position.y}}}toJSON(){return this[_t]()}}var lt;(function(o){o.WINDOW_RESIZED="tauri://resize",o.WINDOW_MOVED="tauri://move",o.WINDOW_CLOSE_REQUESTED="tauri://close-requested",o.WINDOW_DESTROYED="tauri://destroyed",o.WINDOW_FOCUS="tauri://focus",o.WINDOW_BLUR="tauri://blur",o.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",o.WINDOW_THEME_CHANGED="tauri://theme-changed",o.WINDOW_CREATED="tauri://window-created",o.WEBVIEW_CREATED="tauri://webview-created",o.DRAG_ENTER="tauri://drag-enter",o.DRAG_OVER="tauri://drag-over",o.DRAG_DROP="tauri://drag-drop",o.DRAG_LEAVE="tauri://drag-leave"})(lt||(lt={}));async function bl(o,t){await S("plugin:event|unlisten",{event:o,eventId:t})}async function _l(o,t,e){var n;const i=typeof(e==null?void 0:e.target)=="string"?{kind:"AnyLabel",label:e.target}:(n=e==null?void 0:e.target)!==null&&n!==void 0?n:{kind:"Any"};return S("plugin:event|listen",{event:o,target:i,handler:Qf(t)}).then(r=>async()=>bl(o,r))}async function Zf(o,t,e){return _l(o,n=>{bl(o,n.id),t(n)},e)}async function tg(o,t){await S("plugin:event|emit",{event:o,payload:t})}async function eg(o,t,e){await S("plugin:event|emit_to",{target:typeof o=="string"?{kind:"AnyLabel",label:o}:o,event:t,payload:e})}class sn extends Yf{constructor(t){super(t)}static async new(t,e,n){return S("plugin:image|new",{rgba:Jn(t),width:e,height:n}).then(i=>new sn(i))}static async fromBytes(t){return S("plugin:image|from_bytes",{bytes:Jn(t)}).then(e=>new sn(e))}static async fromPath(t){return S("plugin:image|from_path",{path:t}).then(e=>new sn(e))}async rgba(){return S("plugin:image|rgba",{rid:this.rid}).then(t=>new Uint8Array(t))}async size(){return S("plugin:image|size",{rid:this.rid})}}function Jn(o){return o==null?null:typeof o=="string"?o:o instanceof sn?o.rid:o}var ti;(function(o){o[o.Critical=1]="Critical",o[o.Informational=2]="Informational"})(ti||(ti={}));class ng{constructor(t){this._preventDefault=!1,this.event=t.event,this.id=t.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}var yl;(function(o){o.None="none",o.Normal="normal",o.Indeterminate="indeterminate",o.Paused="paused",o.Error="error"})(yl||(yl={}));function wl(){return new vl(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function ei(){return S("plugin:window|get_all_windows").then(o=>o.map(t=>new vl(t,{skip:!0})))}const ni=["tauri://created","tauri://error"];class vl{constructor(t,e={}){var n;this.label=t,this.listeners=Object.create(null),e!=null&&e.skip||S("plugin:window|create",{options:{...e,parent:typeof e.parent=="string"?e.parent:(n=e.parent)===null||n===void 0?void 0:n.label,label:t}}).then(async()=>this.emit("tauri://created")).catch(async i=>this.emit("tauri://error",i))}static async getByLabel(t){var e;return(e=(await ei()).find(n=>n.label===t))!==null&&e!==void 0?e:null}static getCurrent(){return wl()}static async getAll(){return ei()}static async getFocusedWindow(){for(const t of await ei())if(await t.isFocused())return t;return null}async listen(t,e){return this._handleTauriEvent(t,e)?()=>{const n=this.listeners[t];n.splice(n.indexOf(e),1)}:_l(t,e,{target:{kind:"Window",label:this.label}})}async once(t,e){return this._handleTauriEvent(t,e)?()=>{const n=this.listeners[t];n.splice(n.indexOf(e),1)}:Zf(t,e,{target:{kind:"Window",label:this.label}})}async emit(t,e){if(ni.includes(t)){for(const n of this.listeners[t]||[])n({event:t,id:-1,payload:e});return}return tg(t,e)}async emitTo(t,e,n){if(ni.includes(e)){for(const i of this.listeners[e]||[])i({event:e,id:-1,payload:n});return}return eg(t,e,n)}_handleTauriEvent(t,e){return ni.includes(t)?(t in this.listeners?this.listeners[t].push(e):this.listeners[t]=[e],!0):!1}async scaleFactor(){return S("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return S("plugin:window|inner_position",{label:this.label}).then(t=>new Qt(t))}async outerPosition(){return S("plugin:window|outer_position",{label:this.label}).then(t=>new Qt(t))}async innerSize(){return S("plugin:window|inner_size",{label:this.label}).then(t=>new rn(t))}async outerSize(){return S("plugin:window|outer_size",{label:this.label}).then(t=>new rn(t))}async isFullscreen(){return S("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return S("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return S("plugin:window|is_maximized",{label:this.label})}async isFocused(){return S("plugin:window|is_focused",{label:this.label})}async isDecorated(){return S("plugin:window|is_decorated",{label:this.label})}async isResizable(){return S("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return S("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return S("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return S("plugin:window|is_closable",{label:this.label})}async isVisible(){return S("plugin:window|is_visible",{label:this.label})}async title(){return S("plugin:window|title",{label:this.label})}async theme(){return S("plugin:window|theme",{label:this.label})}async isAlwaysOnTop(){return S("plugin:window|is_always_on_top",{label:this.label})}async center(){return S("plugin:window|center",{label:this.label})}async requestUserAttention(t){let e=null;return t&&(t===ti.Critical?e={type:"Critical"}:e={type:"Informational"}),S("plugin:window|request_user_attention",{label:this.label,value:e})}async setResizable(t){return S("plugin:window|set_resizable",{label:this.label,value:t})}async setEnabled(t){return S("plugin:window|set_enabled",{label:this.label,value:t})}async isEnabled(){return S("plugin:window|is_enabled",{label:this.label})}async setMaximizable(t){return S("plugin:window|set_maximizable",{label:this.label,value:t})}async setMinimizable(t){return S("plugin:window|set_minimizable",{label:this.label,value:t})}async setClosable(t){return S("plugin:window|set_closable",{label:this.label,value:t})}async setTitle(t){return S("plugin:window|set_title",{label:this.label,value:t})}async maximize(){return S("plugin:window|maximize",{label:this.label})}async unmaximize(){return S("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return S("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return S("plugin:window|minimize",{label:this.label})}async unminimize(){return S("plugin:window|unminimize",{label:this.label})}async show(){return S("plugin:window|show",{label:this.label})}async hide(){return S("plugin:window|hide",{label:this.label})}async close(){return S("plugin:window|close",{label:this.label})}async destroy(){return S("plugin:window|destroy",{label:this.label})}async setDecorations(t){return S("plugin:window|set_decorations",{label:this.label,value:t})}async setShadow(t){return S("plugin:window|set_shadow",{label:this.label,value:t})}async setEffects(t){return S("plugin:window|set_effects",{label:this.label,value:t})}async clearEffects(){return S("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(t){return S("plugin:window|set_always_on_top",{label:this.label,value:t})}async setAlwaysOnBottom(t){return S("plugin:window|set_always_on_bottom",{label:this.label,value:t})}async setContentProtected(t){return S("plugin:window|set_content_protected",{label:this.label,value:t})}async setSize(t){return S("plugin:window|set_size",{label:this.label,value:t instanceof Ae?t:new Ae(t)})}async setMinSize(t){return S("plugin:window|set_min_size",{label:this.label,value:t instanceof Ae?t:t?new Ae(t):null})}async setMaxSize(t){return S("plugin:window|set_max_size",{label:this.label,value:t instanceof Ae?t:t?new Ae(t):null})}async setSizeConstraints(t){function e(n){return n?{Logical:n}:null}return S("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:e(t==null?void 0:t.minWidth),minHeight:e(t==null?void 0:t.minHeight),maxWidth:e(t==null?void 0:t.maxWidth),maxHeight:e(t==null?void 0:t.maxHeight)}})}async setPosition(t){return S("plugin:window|set_position",{label:this.label,value:t instanceof Wn?t:new Wn(t)})}async setFullscreen(t){return S("plugin:window|set_fullscreen",{label:this.label,value:t})}async setFocus(){return S("plugin:window|set_focus",{label:this.label})}async setIcon(t){return S("plugin:window|set_icon",{label:this.label,value:Jn(t)})}async setSkipTaskbar(t){return S("plugin:window|set_skip_taskbar",{label:this.label,value:t})}async setCursorGrab(t){return S("plugin:window|set_cursor_grab",{label:this.label,value:t})}async setCursorVisible(t){return S("plugin:window|set_cursor_visible",{label:this.label,value:t})}async setCursorIcon(t){return S("plugin:window|set_cursor_icon",{label:this.label,value:t})}async setBackgroundColor(t){return S("plugin:window|set_background_color",{color:t})}async setCursorPosition(t){return S("plugin:window|set_cursor_position",{label:this.label,value:t instanceof Wn?t:new Wn(t)})}async setIgnoreCursorEvents(t){return S("plugin:window|set_ignore_cursor_events",{label:this.label,value:t})}async startDragging(){return S("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(t){return S("plugin:window|start_resize_dragging",{label:this.label,value:t})}async setBadgeCount(t){return S("plugin:window|set_badge_count",{label:this.label,value:t})}async setBadgeLabel(t){return S("plugin:window|set_badge_label",{label:this.label,value:t})}async setOverlayIcon(t){return S("plugin:window|set_overlay_icon",{label:this.label,value:t?Jn(t):void 0})}async setProgressBar(t){return S("plugin:window|set_progress_bar",{label:this.label,value:t})}async setVisibleOnAllWorkspaces(t){return S("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:t})}async setTitleBarStyle(t){return S("plugin:window|set_title_bar_style",{label:this.label,value:t})}async setTheme(t){return S("plugin:window|set_theme",{label:this.label,value:t})}async onResized(t){return this.listen(lt.WINDOW_RESIZED,e=>{e.payload=new rn(e.payload),t(e)})}async onMoved(t){return this.listen(lt.WINDOW_MOVED,e=>{e.payload=new Qt(e.payload),t(e)})}async onCloseRequested(t){return this.listen(lt.WINDOW_CLOSE_REQUESTED,async e=>{const n=new ng(e);await t(n),n.isPreventDefault()||await this.destroy()})}async onDragDropEvent(t){const e=await this.listen(lt.DRAG_ENTER,s=>{t({...s,payload:{type:"enter",paths:s.payload.paths,position:new Qt(s.payload.position)}})}),n=await this.listen(lt.DRAG_OVER,s=>{t({...s,payload:{type:"over",position:new Qt(s.payload.position)}})}),i=await this.listen(lt.DRAG_DROP,s=>{t({...s,payload:{type:"drop",paths:s.payload.paths,position:new Qt(s.payload.position)}})}),r=await this.listen(lt.DRAG_LEAVE,s=>{t({...s,payload:{type:"leave"}})});return()=>{e(),i(),n(),r()}}async onFocusChanged(t){const e=await this.listen(lt.WINDOW_FOCUS,i=>{t({...i,payload:!0})}),n=await this.listen(lt.WINDOW_BLUR,i=>{t({...i,payload:!1})});return()=>{e(),n()}}async onScaleChanged(t){return this.listen(lt.WINDOW_SCALE_FACTOR_CHANGED,t)}async onThemeChanged(t){return this.listen(lt.WINDOW_THEME_CHANGED,t)}}var kl;(function(o){o.Disabled="disabled",o.Throttle="throttle",o.Suspend="suspend"})(kl||(kl={}));var xl;(function(o){o.AppearanceBased="appearanceBased",o.Light="light",o.Dark="dark",o.MediumLight="mediumLight",o.UltraDark="ultraDark",o.Titlebar="titlebar",o.Selection="selection",o.Menu="menu",o.Popover="popover",o.Sidebar="sidebar",o.HeaderView="headerView",o.Sheet="sheet",o.WindowBackground="windowBackground",o.HudWindow="hudWindow",o.FullScreenUI="fullScreenUI",o.Tooltip="tooltip",o.ContentBackground="contentBackground",o.UnderWindowBackground="underWindowBackground",o.UnderPageBackground="underPageBackground",o.Mica="mica",o.Blur="blur",o.Acrylic="acrylic",o.Tabbed="tabbed",o.TabbedDark="tabbedDark",o.TabbedLight="tabbedLight"})(xl||(xl={}));var Sl;(function(o){o.FollowsWindowActiveState="followsWindowActiveState",o.Active="active",o.Inactive="inactive"})(Sl||(Sl={}));const Cl=(o,t)=>o.selection.empty?!1:(t&&t(o.tr.deleteSelection().scrollIntoView()),!0);function og(o,t){let{$cursor:e}=o.selection;return!e||(t?!t.endOfTextblock("backward",o):e.parentOffset>0)?null:e}const ig=(o,t,e)=>{let n=og(o,e);if(!n)return!1;let i=Ml(n);if(!i){let s=n.blockRange(),a=s&&bo(s);return a==null?!1:(t&&t(o.tr.lift(s,a).scrollIntoView()),!0)}let r=i.nodeBefore;if(Nl(o,i,t,-1))return!0;if(n.parent.content.size==0&&(Ee(r,"end")||T.isSelectable(r)))for(let s=n.depth;;s--){let a=_o(o.doc,n.before(s),n.after(s),M.empty);if(a&&a.slice.size<a.to-a.from){if(t){let l=o.tr.step(a);l.setSelection(Ee(r,"end")?E.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):T.create(l.doc,i.pos-r.nodeSize)),t(l.scrollIntoView())}return!0}if(s==1||n.node(s-1).childCount>1)break}return r.isAtom&&i.depth==n.depth-1?(t&&t(o.tr.delete(i.pos-r.nodeSize,i.pos).scrollIntoView()),!0):!1};function Ee(o,t,e=!1){for(let n=o;n;n=t=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(e&&n.childCount!=1)return!1}return!1}const rg=(o,t,e)=>{let{$head:n,empty:i}=o.selection,r=n;if(!i)return!1;if(n.parent.isTextblock){if(e?!e.endOfTextblock("backward",o):n.parentOffset>0)return!1;r=Ml(n)}let s=r&&r.nodeBefore;return!s||!T.isSelectable(s)?!1:(t&&t(o.tr.setSelection(T.create(o.doc,r.pos-s.nodeSize)).scrollIntoView()),!0)};function Ml(o){if(!o.parent.type.spec.isolating)for(let t=o.depth-1;t>=0;t--){if(o.index(t)>0)return o.doc.resolve(o.before(t+1));if(o.node(t).type.spec.isolating)break}return null}function sg(o,t){let{$cursor:e}=o.selection;return!e||(t?!t.endOfTextblock("forward",o):e.parentOffset<e.parent.content.size)?null:e}const ag=(o,t,e)=>{let n=sg(o,e);if(!n)return!1;let i=Ol(n);if(!i)return!1;let r=i.nodeAfter;if(Nl(o,i,t,1))return!0;if(n.parent.content.size==0&&(Ee(r,"start")||T.isSelectable(r))){let s=_o(o.doc,n.before(),n.after(),M.empty);if(s&&s.slice.size<s.to-s.from){if(t){let a=o.tr.step(s);a.setSelection(Ee(r,"start")?E.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):T.create(a.doc,a.mapping.map(i.pos))),t(a.scrollIntoView())}return!0}}return r.isAtom&&i.depth==n.depth-1?(t&&t(o.tr.delete(i.pos,i.pos+r.nodeSize).scrollIntoView()),!0):!1},lg=(o,t,e)=>{let{$head:n,empty:i}=o.selection,r=n;if(!i)return!1;if(n.parent.isTextblock){if(e?!e.endOfTextblock("forward",o):n.parentOffset<n.parent.content.size)return!1;r=Ol(n)}let s=r&&r.nodeAfter;return!s||!T.isSelectable(s)?!1:(t&&t(o.tr.setSelection(T.create(o.doc,r.pos)).scrollIntoView()),!0)};function Ol(o){if(!o.parent.type.spec.isolating)for(let t=o.depth-1;t>=0;t--){let e=o.node(t);if(o.index(t)+1<e.childCount)return o.doc.resolve(o.after(t+1));if(e.type.spec.isolating)break}return null}const cg=(o,t)=>{let{$head:e,$anchor:n}=o.selection;return!e.parent.type.spec.code||!e.sameParent(n)?!1:(t&&t(o.tr.insertText(`
`).scrollIntoView()),!0)};function oi(o){for(let t=0;t<o.edgeCount;t++){let{type:e}=o.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}const dg=(o,t)=>{let{$head:e,$anchor:n}=o.selection;if(!e.parent.type.spec.code||!e.sameParent(n))return!1;let i=e.node(-1),r=e.indexAfter(-1),s=oi(i.contentMatchAt(r));if(!s||!i.canReplaceWith(r,r,s))return!1;if(t){let a=e.after(),l=o.tr.replaceWith(a,a,s.createAndFill());l.setSelection(E.near(l.doc.resolve(a),1)),t(l.scrollIntoView())}return!0},hg=(o,t)=>{let e=o.selection,{$from:n,$to:i}=e;if(e instanceof st||n.parent.inlineContent||i.parent.inlineContent)return!1;let r=oi(i.parent.contentMatchAt(i.indexAfter()));if(!r||!r.isTextblock)return!1;if(t){let s=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,a=o.tr.insert(s,r.createAndFill());a.setSelection(z.create(a.doc,s+1)),t(a.scrollIntoView())}return!0},ug=(o,t)=>{let{$cursor:e}=o.selection;if(!e||e.parent.content.size)return!1;if(e.depth>1&&e.after()!=e.end(-1)){let r=e.before();if(On(o.doc,r))return t&&t(o.tr.split(r).scrollIntoView()),!0}let n=e.blockRange(),i=n&&bo(n);return i==null?!1:(t&&t(o.tr.lift(n,i).scrollIntoView()),!0)};function pg(o){return(t,e)=>{let{$from:n,$to:i}=t.selection;if(t.selection instanceof T&&t.selection.node.isBlock)return!n.parentOffset||!On(t.doc,n.pos)?!1:(e&&e(t.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let r=[],s,a,l=!1,c=!1;for(let g=n.depth;;g--)if(n.node(g).isBlock){l=n.end(g)==n.pos+(n.depth-g),c=n.start(g)==n.pos-(n.depth-g),a=oi(n.node(g-1).contentMatchAt(n.indexAfter(g-1))),r.unshift(l&&a?{type:a}:null),s=g;break}else{if(g==1)return!1;r.unshift(null)}let d=t.tr;(t.selection instanceof z||t.selection instanceof st)&&d.deleteSelection();let h=d.mapping.map(n.pos),f=On(d.doc,h,r.length,r);if(f||(r[0]=a?{type:a}:null,f=On(d.doc,h,r.length,r)),!f)return!1;if(d.split(h,r.length,r),!l&&c&&n.node(s).type!=a){let g=d.mapping.map(n.before(s)),p=d.doc.resolve(g);a&&n.node(s-1).canReplaceWith(p.index(),p.index()+1,a)&&d.setNodeMarkup(d.mapping.map(n.before(s)),a)}return e&&e(d.scrollIntoView()),!0}}const fg=pg(),gg=(o,t)=>(t&&t(o.tr.setSelection(new st(o.doc))),!0);function mg(o,t,e){let n=t.nodeBefore,i=t.nodeAfter,r=t.index();return!n||!i||!n.type.compatibleContent(i.type)?!1:!n.content.size&&t.parent.canReplace(r-1,r)?(e&&e(o.tr.delete(t.pos-n.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(r,r+1)||!(i.isTextblock||Os(o.doc,t.pos))?!1:(e&&e(o.tr.join(t.pos).scrollIntoView()),!0)}function Nl(o,t,e,n){let i=t.nodeBefore,r=t.nodeAfter,s,a,l=i.type.spec.isolating||r.type.spec.isolating;if(!l&&mg(o,t,e))return!0;let c=!l&&t.parent.canReplace(t.index(),t.index()+1);if(c&&(s=(a=i.contentMatchAt(i.childCount)).findWrapping(r.type))&&a.matchType(s[0]||r.type).validEnd){if(e){let g=t.pos+r.nodeSize,p=x.empty;for(let k=s.length-1;k>=0;k--)p=x.from(s[k].create(null,p));p=x.from(i.copy(p));let b=o.tr.step(new rt(t.pos-1,g,t.pos,g,new M(p,1,0),s.length,!0)),y=b.doc.resolve(g+2*s.length);y.nodeAfter&&y.nodeAfter.type==i.type&&Os(b.doc,y.pos)&&b.join(y.pos),e(b.scrollIntoView())}return!0}let d=r.type.spec.isolating||n>0&&l?null:E.findFrom(t,1),h=d&&d.$from.blockRange(d.$to),f=h&&bo(h);if(f!=null&&f>=t.depth)return e&&e(o.tr.lift(h,f).scrollIntoView()),!0;if(c&&Ee(r,"start",!0)&&Ee(i,"end")){let g=i,p=[];for(;p.push(g),!g.isTextblock;)g=g.lastChild;let b=r,y=1;for(;!b.isTextblock;b=b.firstChild)y++;if(g.canReplace(g.childCount,g.childCount,b.content)){if(e){let k=x.empty;for(let $=p.length-1;$>=0;$--)k=x.from(p[$].copy(k));let D=o.tr.step(new rt(t.pos-p.length,t.pos+r.nodeSize,t.pos+y,t.pos+r.nodeSize-y,new M(k,p.length,0),0,!0));e(D.scrollIntoView())}return!0}}return!1}function Dl(o){return function(t,e){let n=t.selection,i=o<0?n.$from:n.$to,r=i.depth;for(;i.node(r).isInline;){if(!r)return!1;r--}return i.node(r).isTextblock?(e&&e(t.tr.setSelection(z.create(t.doc,o<0?i.start(r):i.end(r)))),!0):!1}}const bg=Dl(-1),_g=Dl(1);function ii(...o){return function(t,e,n){for(let i=0;i<o.length;i++)if(o[i](t,e,n))return!0;return!1}}let ri=ii(Cl,ig,rg),Il=ii(Cl,ag,lg);const Ft={Enter:ii(cg,hg,ug,fg),"Mod-Enter":dg,Backspace:ri,"Mod-Backspace":ri,"Shift-Backspace":ri,Delete:Il,"Mod-Delete":Il,"Mod-a":gg},Tl={"Ctrl-h":Ft.Backspace,"Alt-Backspace":Ft["Mod-Backspace"],"Ctrl-d":Ft.Delete,"Ctrl-Alt-Backspace":Ft["Mod-Delete"],"Alt-Delete":Ft["Mod-Delete"],"Alt-d":Ft["Mod-Delete"],"Ctrl-a":bg,"Ctrl-e":_g};for(let o in Ft)Tl[o]=Ft[o];const yg=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,wg=yg?Tl:Ft;for(var Yt={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},qn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},vg=typeof navigator<"u"&&/Mac/.test(navigator.platform),kg=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),K=0;K<10;K++)Yt[48+K]=Yt[96+K]=String(K);for(var K=1;K<=24;K++)Yt[K+111]="F"+K;for(var K=65;K<=90;K++)Yt[K]=String.fromCharCode(K+32),qn[K]=String.fromCharCode(K);for(var si in Yt)qn.hasOwnProperty(si)||(qn[si]=Yt[si]);function xg(o){var t=vg&&o.metaKey&&o.shiftKey&&!o.ctrlKey&&!o.altKey||kg&&o.shiftKey&&o.key&&o.key.length==1||o.key=="Unidentified",e=!t&&o.key||(o.shiftKey?qn:Yt)[o.keyCode]||o.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}const Sg=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Cg=typeof navigator<"u"&&/Win/.test(navigator.platform);function Mg(o){let t=o.split(/-(?!$)/),e=t[t.length-1];e=="Space"&&(e=" ");let n,i,r,s;for(let a=0;a<t.length-1;a++){let l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))r=!0;else if(/^mod$/i.test(l))Sg?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(e="Alt-"+e),i&&(e="Ctrl-"+e),s&&(e="Meta-"+e),r&&(e="Shift-"+e),e}function Og(o){let t=Object.create(null);for(let e in o)t[Mg(e)]=o[e];return t}function ai(o,t,e=!0){return t.altKey&&(o="Alt-"+o),t.ctrlKey&&(o="Ctrl-"+o),t.metaKey&&(o="Meta-"+o),e&&t.shiftKey&&(o="Shift-"+o),o}function Ng(o){return new Vs({props:{handleKeyDown:Dg(o)}})}function Dg(o){let t=Og(o);return function(e,n){let i=xg(n),r,s=t[ai(i,n)];if(s&&s(e.state,e.dispatch,e))return!0;if(i.length==1&&i!=" "){if(n.shiftKey){let a=t[ai(i,n,!1)];if(a&&a(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Cg&&n.ctrlKey&&n.altKey)&&(r=Yt[n.keyCode])&&r!=i){let a=t[ai(r,n)];if(a&&a(e.state,e.dispatch,e))return!0}}return!1}}const Ig=["p",0],Al={nodes:{doc:{content:"block+"},paragraph:{automerge:{block:"paragraph"},content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return Ig}},unknownBlock:{automerge:{unknownBlock:!0},group:"block",content:"block+",parseDOM:[{tag:"div",attrs:{"data-unknown-block":"true"}}],toDOM(){return["div",{"data-unknown-block":"true"},0]}},text:{group:"inline"}},marks:{}};var Tg=Object.defineProperty,Ag=Object.getOwnPropertyDescriptor,Hn=(o,t,e,n)=>{for(var i=n>1?void 0:n?Ag(t,e):t,r=o.length-1,s;r>=0;r--)(s=o[r])&&(i=(n?s(t,e,i):s(i))||i);return n&&i&&Tg(t,e,i),i};ne=class extends Fl(ci){constructor(){super(...arguments),this.acceptedCollaborators=[],this.onbeforeunload=o=>hn("Are you sure you want to leave?"),this.unloadSetup=!1}async deleteNote(){try{await this.notesStore.client.deleteNote(this.noteHash),this.dispatchEvent(new CustomEvent("note-deleted",{bubbles:!0,composed:!0,detail:{noteHash:this.noteHash}}))}catch(o){console.error(o),Vt(hn("Error deleting the note"))}}async setupUnload(){if(!this.unloadSetup){this.unloadSetup=!0,window.addEventListener("beforeunload",this.onbeforeunload);try{this.unlisten=await wl().onCloseRequested(async o=>{try{await this.updateNote()}catch{Vt(hn("Failed to save note.")),o.preventDefault()}})}catch(o){console.log("Not in a tauri context",o)}}}disconnectedCallback(){super.disconnectedCallback(),this.updateNote(),window.removeEventListener("beforeunload",this.onbeforeunload),this.unlisten&&this.unlisten()}async updateNote(){const o=this.shadowRoot.querySelector("collaborative-document-context").document.docSync(),t=await Xg(this.notesStore.notes.get(this.noteHash).latestVersion),e=Qg(o);try{const n=await this.notesStore.client.updateNote(this.noteHash,t.previousHashes,e);this.dispatchEvent(new CustomEvent("note-updated",{composed:!0,bubbles:!0,detail:{originalNoteHash:this.noteHash,updatedNoteHash:n.actionHash}}))}catch(n){console.error(n),Vt(hn("Error updating the note"))}}renderDetail(o){return ee`
			<sl-card style="flex: 1">
				<div class="column" style="gap: 16px; flex: 1; width: 558px">
					<collaborative-document-context
						.sessionId="${Y(this.noteHash)}}"
						.acceptedCollaborators=${this.acceptedCollaborators}
						.initialDocument=${o}
						@document-changed=${()=>this.setupUnload()}
					>
						<collaborative-prosemirror
							style="font-size: 24px; overflow: auto"
							.schema=${Al}
							.path=${["title"]}
						>
						</collaborative-prosemirror>

						<collaborative-prosemirror
							.schema=${Al}
							style="flex: 1"
							.plugins=${[Ng(wg)]}
							.path=${["body"]}
						>
						</collaborative-prosemirror>
					</collaborative-document-context>

					<div class="row" style="max-height: 200px">
						<sl-icon-button
							style="font-size: 24px"
							.src=${Ll(nm)}
						>
						</sl-icon-button>
					</div>
				</div>
			</sl-card>
		`}render(){const o=this.notesStore.notes.get(this.noteHash).latestVersion.get();switch(o.status){case"pending":return ee`<div
					style="display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1;"
				>
					<sl-spinner style="font-size: 2rem;"></sl-spinner>
				</div>`;case"error":return ee`<display-error
					.headline=${hn("Error fetching the note")}
					.error=${o.error}
				></display-error>`;case"completed":return this.renderDetail(o.value.doc)}}},ne.styles=[Vl,te`
			:host {
				display: flex;
			}
		`],Hn([I(om("note-hash"))],ne.prototype,"noteHash",2),Hn([Qn({context:sm,subscribe:!0})],ne.prototype,"notesStore",2),Hn([I()],ne.prototype,"acceptedCollaborators",2),ne=Hn([im(),di("note-detail")],ne)})();export{ne as NoteDetail,am as __tla};
